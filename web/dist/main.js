(()=>{var __webpack_modules__={155:module=>{class HelperString{static ltrim(string,char=null){char=char||"[ \t\n\r\0\v]";var exp=new RegExp("^"+char+"+");return string.replace(exp,"")}static rtrim(string,char=null){char=char||"[ \t\n\r\0\v]";var exp=new RegExp(char+"+$");return string.replace(exp,"")}static trim(string,char=" "){return string=HelperString.ltrim(string,char),string=HelperString.rtrim(string,char)}}module.exports=HelperString},237:(module,__unused_webpack_exports,__webpack_require__)=>{const HelperString=__webpack_require__(155);class HelperUrl{static getBaseHref(){return HelperUrl.getDocumentBaseHref()??HelperUrl.getWindowLocationBaseHref()}static getWindowLocationBaseHref(){const location=window.location;var href;if("/"==location.pathname.slice(-1))href=location.protocol+"//"+location.host+location.pathname;else{href=location.pathname.match(/\.[\w]{2,4}$/)?location.protocol+"//"+location.host+location.pathname.replace(/\/[^\/]+$/,""):location.protocol+"//"+location.host+location.pathname}return HelperString.rtrim(href,"/")+"/"}static getDocumentBaseHref(){const base=document.querySelector("base");if(!base)return null;const href=base.getAttribute("href");return href?HelperString.rtrim(href,"/")+"/":null}static isAbsolute(uri){return uri instanceof URL||"http"==uri.substr(0,4)}static isRelative(uri){return!HelperUrl.isAbsolute(uri)}}module.exports=HelperUrl},349:(module,__unused_webpack_exports,__webpack_require__)=>{const Convert=__webpack_require__(539);class CastDown{static toObject(data){var formData,url,searchParams;return"Object"==data.constructor.name?data:data instanceof FormData?Convert.formDataToObject(data):data instanceof HTMLFormElement?(formData=new FormData(data),Convert.formDataToObject(formData)):data instanceof URL?Convert.queryStringToObject(data.search):data instanceof URLSearchParams?Convert.searchParamsToObject(data):Convert.isValidJson(data)?JSON.parse(data):(searchParams=(url=Convert.stringToUrl(data))&&url.search?new URLSearchParams(url.search):new URLSearchParams(data),CastDown.emptySearchParams(searchParams)?null:Convert.searchParamsToObject(searchParams))}static toJson(data){var obj;return Convert.isValidJson(data)?data:(obj=CastDown.toObject(data),JSON.stringify(obj))}static toFormData(data){var obj;return data instanceof FormData?data:data instanceof HTMLFormElement?new FormData(data):(obj=CastDown.toObject(data),Convert.objectToFormData(obj))}static emptySearchParams(searchParams){for(var value of searchParams.values())if(value)return!1;return!0}}module.exports=CastDown},539:(module,__unused_webpack_exports,__webpack_require__)=>{const HelperString=__webpack_require__(155),HelperUrl=__webpack_require__(237);class Convert{static stringToUrl(uri){if(HelperUrl.isAbsolute(uri))return new URL(uri);var url;const isRootPath="/"==uri.slice(0,1),baseHref=HelperUrl.getBaseHref();return isRootPath?((url=new URL(baseHref)).pathname=uri,url.placeholder=url.toString().replace(uri,"")):(url=new URL(baseHref+HelperString.ltrim(uri,"/"))).placeholder=baseHref,url}static urlToString(url){var string=url.toString();return url.placeholder&&(string=string.replace(url.placeholder,"")),string}static searchParamsToObject(searchParams){var obj={};for(var[paramName,value]of searchParams.entries()){var keys=-1==paramName.indexOf("[")?[paramName]:HelperString.rtrim(paramName,"]").split(/\]?\[/);Convert.addPropertyToObject(obj,keys,value)}return obj}static addPropertyToObject(object,propertiesNames,value){var last=propertiesNames.pop();for(var property of propertiesNames)void 0===object[property]&&(object[property]=isNaN(property)?{}:[]),object=object[property];object[last]=value}static objectToSearchParams(object){var searchParams=new URLSearchParams;for(var propertyName in object)Convert.addToSearchparam(searchParams,propertyName,object[propertyName]);return searchParams}static addToSearchparam(searchParams,paramName,value){if(Array.isArray(value)||"object"==typeof value)for(var propertyName in value)Convert.addToSearchparam(searchParams,paramName+"["+propertyName+"]",value[propertyName]);else searchParams.set(paramName,value)}static objectToFormData(object){var formData=new FormData;for(var propertyName in object)Convert.addToSearchparam(formData,propertyName,object[propertyName]);return formData}static formDataToObject(formData){return Convert.searchParamsToObject(formData)}static objectToQueryString(object){return Convert.objectToSearchParams(object).toString()}static queryStringToObject(queryString){var searchParams=new URLSearchParams(queryString);return Convert.searchParamsToObject(searchParams)}static isValidJson(data){if("string"!=typeof data)return!1;try{JSON.parse(data)}catch(error){return!1}return!0}}module.exports=Convert},757:(module,__unused_webpack_exports,__webpack_require__)=>{module.exports=__webpack_require__(834)},834:(module,__unused_webpack_exports,__webpack_require__)=>{const Convert=__webpack_require__(539),CastDown=__webpack_require__(349),HelperUrl=__webpack_require__(237),HelperString=__webpack_require__(155);class Http{defaultOptions={};constructor(defaultOptions={}){null!=defaultOptions.baseHref&&(defaultOptions.baseHref=HelperString.rtrim(defaultOptions.baseHref,"/")+"/"),this.defaultOptions=defaultOptions}async fetch(url,options={}){return options.method||(options.method="get"),this.request(url,options)}async get(url,options={}){return options.method="get",this.request(url,options)}async post(url,options={}){return options.method="post",this.request(url,options)}async put(url,options={}){return options.method="put",this.request(url,options)}async delete(url,options={}){return options.method="delete",this.request(url,options)}async options(url,options={}){return options.method="options",this.request(url,options)}async patch(url,options={}){return options.method="patch",this.request(url,options)}static createRequest(url,options){return"string"==typeof url&&(url=HelperUrl.isRelative(url)?new URL(url,options.baseHref||HelperUrl.getBaseHref()):new URL(url)),null==options.headers&&(options.headers={}),options.queryParams&&(url=Http.addToQueryString(url,options.queryParams),options.queryParams=void 0),"get"==options.method&&options.body?(url=Http.addToQueryString(url,options.body),options.body=void 0):options.body&&(options.body="application/json"==Http.getHeader(options.headers,"Content-Type")?CastDown.toJson(options.body):CastDown.toFormData(options.body)),Http.clearUpOptions(options),new Request(url,options)}static clearUpOptions(options){for(var property in options)void 0===options[property]&&delete options[property];if(options.headers)for(var header in options.headers)void 0===options.headers[header]&&delete options.headers[header]}async request(url,options={}){options={...this.defaultOptions,...options};var request=Http.createRequest(url,options);return fetch(request)}static addToQueryString(url,data){var searchParams;data=CastDown.toObject(data);var isObject=url instanceof URL;for(var propertyName in searchParams=(url=isObject?url:Convert.stringToUrl(url)).search?new URLSearchParams(url.search):new URLSearchParams,data)Convert.addToSearchparam(searchParams,propertyName,data[propertyName]);return url.search=searchParams.toString(),isObject?url:Convert.urlToString(url)}static getHeader(headers,headerName){headerName=headerName.toLowerCase();for(let prp in headers)if(prp.toLocaleLowerCase()==headerName)return headers[prp];return null}}module.exports=Http},901:module=>{module.exports=class Instantiator{constructor(classe,dependencies){this.classe=classe,this.dependencies=dependencies}instantiate(){var values=this.compileValues();return new this.classe(...values)}compileValues(){var parametersString=this.getConstructorParemetersString(),constructorParameters=this.getConstructorParameters(parametersString),values=[];for(var parameter of constructorParameters){if(this.dependencies.hasOwnProperty(parameter.name))var value=this.dependencies[parameter.name];else{if(parameter.noDefault)throw`Could not instantiate ${this.classe.name}`;value=parameter.default}values.push(value)}return values}getConstructorParemetersString(){return this.classe.toString().match(/constructor\(([^)]+)\)/)[1]}getConstructorParameters(parametersString){var constuctorParameters=[],parameterStrings=parametersString.split(",");for(var ps of parameterStrings)constuctorParameters.push(this.parseParemeter(ps));return constuctorParameters}parseParemeter(string){if((string=this.trim(string)).indexOf("=")<0)return{name:string.trim(),noDefault:!0};var parts=string.split(/ *= */);return{name:parts[0].trim(),default:this.parseDefaultValue(parts[1]),noDefault:!1}}parseDefaultValue(string){var value=this.trim(string);return"null"==string?null:"false"!=string&&"!1"!=string&&("true"==string||("{}"==string?{}:isNaN(string)?value:parseInt(string)))}trim(string){return string.replace(/^['"]|['"]$/g,"")}}}},__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(void 0!==cachedModule)return cachedModule.exports;var module=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId](module,module.exports,__webpack_require__),module.exports}__webpack_require__.n=module=>{var getter=module&&module.__esModule?()=>module.default:()=>module;return __webpack_require__.d(getter,{a:getter}),getter},__webpack_require__.d=(exports,definition)=>{for(var key in definition)__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)&&Object.defineProperty(exports,key,{enumerable:!0,get:definition[key]})},__webpack_require__.o=(obj,prop)=>Object.prototype.hasOwnProperty.call(obj,prop),(()=>{"use strict";const Api_Base=class Base{constructor(httpClient){this.httpClient=httpClient}async apiCall(method,endpoint,body=void 0,queryParams=void 0,otherOptions=void 0){return new Promise((resolve,reject)=>{this.request(method,endpoint,body,queryParams,otherOptions).then(response=>response.json().then(json=>{response.status<400?resolve(json):reject(json)}))})}async download(endpoint,queryParams,accept){return this.request("get",endpoint,void 0,queryParams,{headers:{Accept:accept}}).then(response=>response.blob()).then(blob=>{const file=URL.createObjectURL(blob);window.location.assign(file)})}request(method,endpoint,body=void 0,queryParams=void 0,otherOptions=void 0){var options={method,body,queryParams};return otherOptions&&(options={...options,...otherOptions}),this.httpClient.request(endpoint,options)}};const Api_Artists=class Artists extends Api_Base{list(){return this.apiCall("get","api/v1/collection/artists")}};const Api_Playlist=class Playlist extends Api_Base{constructor(httpClient,playlistId){super(httpClient),this.playlistId=playlistId}async read(){return this.apiCall("get","api/v1/collection/playlists/"+this.playlistId)}download(){this.download("api/v1/collection/playlists/"+this.playlistId,void 0,"application/jsonl")}async getItems(params=null){return this.apiCall("get","api/v1/collection/playlists/"+this.playlistId+"/items",null,params)}async update(data){return this.apiCall("put","api/v1/collection/playlists/"+this.playlistId,data,null,{headers:{"Content-Type":void 0}})}async delete(){return this.apiCall("delete","api/v1/collection/playlists/"+this.playlistId)}};const Api_Playlists=class Playlists extends Api_Base{list(){return this.apiCall("get","api/v1/collection/playlists")}downloadAll(){this.download("api/v1/collection/playlists",void 0,"application/zip")}create(data){return this.apiCall("post","api/v1/collection/playlists",data,null,{headers:{"Content-Type":void 0}})}get(playlistId){return new Api_Playlist(this.httpClient,playlistId)}};const Api_PlaylistItem=class PlaylistItem extends Api_Base{constructor(httpClient,uuid){super(httpClient),this.uuid=uuid}async read(){return this.apiCall("get","api/v1/collection/items/"+this.uuid)}async update(data){return this.apiCall("put","api/v1/collection/items/"+this.uuid,data,null,{headers:{"Content-Type":void 0}})}async delete(){return this.apiCall("delete","api/v1/collection/items/"+this.uuid)}};const Api_PlaylistsItems=class PlaylistsItems extends Api_Base{search(params){return this.apiCall("get","api/v1/collection/items",null,params)}create(data){return this.apiCall("post","api/v1/collection/items",data,null,{headers:{"Content-Type":void 0}})}addMultiple(items,playlistId){var promise,i,promises=[];for(var item of items)item.uuid?promise=this.create({playlist:playlistId,uuid:item.uuid}):(i={playlist:playlistId,artist:item.artist},item.title&&(i.title=item.title),item.album&&(i.album=item.album),promise=this.create(i)),promises.push(promise);return Promise.all(promises)}get(uuid){return new Api_PlaylistItem(this.httpClient,uuid)}};const Api_Collection=class Collection{constructor(httpClient){this.artists=new Api_Artists(httpClient),this.playlists=new Api_Playlists(httpClient),this.playlistItems=new Api_PlaylistsItems(httpClient)}};const Api_Album=class Album extends Api_Base{constructor(httpClient,artist,title){super(httpClient),this.artist=artist,this.title=title}async fetchItems(){return this.read().then(response=>{var album=response.data,items=[];for(var t of album.tracks)items.push({title:t,artist:this.artist,album:this.title});return items})}read(){return this.apiCall("get","api/v1/discover/album",null,{artist:this.artist,title:this.title})}};const Api_DiscoverAlbums=class DiscoverAlbums extends Api_Base{search(params){return this.apiCall("get","api/v1/discover/albums",null,params)}get(artist,title){return new Api_Album(this.httpClient,artist,title)}};const Api_DiscoverArtists=class DiscoverArtists extends Api_Base{search(params){return this.apiCall("get","api/v1/discover/artists",null,params)}};const Api_Discover=class Discover extends Api_Base{constructor(httpClient){super(httpClient),this.albums=new Api_DiscoverAlbums(httpClient),this.artists=new Api_DiscoverArtists(httpClient)}resources(musicDescription){return this.apiCall("get","api/v1/discover/resources",null,musicDescription)}};var http=__webpack_require__(757),http_default=__webpack_require__.n(http);const Api_Api=class Api{constructor(baseHref){var defaultOptions={baseHref,headers:{"Content-Type":"application/json"}},httpClient=new(http_default())(defaultOptions);this.collection=new Api_Collection(httpClient),this.discover=new Api_Discover(httpClient)}};class CustomElement extends HTMLElement{__construct(dependencies=null,goHere=null){this.attached=!1,this.$refs={}}connectedCallback(){this.attached||(this.attached=!0,this.renderLifeCycle())}refresh(){this.clear(),this.renderLifeCycle()}beforeRender(){}render(){this.innerHTML="inner html"}afterRender(){}renderLifeCycle(){this.beforeRender(),this.render(),this.afterRender()}static elementName="base-element";static register(){customElements.get(this.elementName)||customElements.define(this.elementName,this)}static instantiate(...args){if(!customElements.get(this.elementName))throw`Register this garbage <${this.elementName}> damn you, you forgot to register it! Call .register() !!`;var el=document.createElement(this.elementName);return el.__construct(...args),el}fireEvent(eventName,detail=null,bubbles=!0){var options={bubbles};null!=detail&&(options.detail=detail);var event=new CustomEvent(eventName,options);return this.dispatchEvent(event)}constructor(){super()}}const Element_CustomElement=CustomElement;class NavigationItem extends Element_CustomElement{static elementName="navigation-item";__construct(label,icon,href){super.__construct(),this.label=label,this.icon=icon,this.href=href}render(){this.classList.add("app-navigation__item");var attrs={title:this.label};this.href&&(attrs.href=this.href),this.$refs.a=this.createAndAttach("a",attrs);var icon=this.icon?this.create("span",{class:"fa "+this.icon}):null,label=this.create("span",{class:"label ellipsis"},this.label);this.$refs.a.attach([icon,label])}}NavigationItem.register();const Navigation_NavigationItem=NavigationItem;class AppNavigationMain extends Element_CustomElement{static elementName="app-navigation-main";render(){this.clear(),this.attach(Navigation_NavigationItem.instantiate("Home","fa-home","#home")),this.attach(Navigation_NavigationItem.instantiate("Search","fa-search","#search")),this.attach(Navigation_NavigationItem.instantiate("Discover","fa fa-search-plus","#discover:artist"))}}AppNavigationMain.register();const Navigation_AppNavigationMain=AppNavigationMain;class NavigationItemPlaylist extends Navigation_NavigationItem{static elementName="navigation-item-playlist";__construct(label,icon,href,playlistId,api){super.__construct(label,icon,href),this.playlistId=playlistId,this.api=api}render(){super.render(),this.addEventListener("drop",this.onDrop.bind(this)),this.addEventListener("dragover",this.onDragOver.bind(this))}onDragOver(evt){evt.preventDefault()}onDrop(evt){var json=evt.dataTransfer.getData("text"),data=JSON.parse(json);this.api.collection.playlistItems.addMultiple(data,this.playlistId).then(()=>{alert("Item(s) added!!")})}}NavigationItemPlaylist.register();const Navigation_NavigationItemPlaylist=NavigationItemPlaylist;class AppNavigationPlaylists extends Element_CustomElement{static elementName="app-navigation-playlist";__construct(api){super.__construct(),this.api=api}render(){this.clear(),this.classList.add("app-navigation__playlists"),this.api.collection.playlists.list().then(response=>{this.subRenderPlaylists(response),this.subRenderCreateAndDownload()})}subRenderPlaylists(response){var data=response.data||[];for(var playlist of data)Navigation_NavigationItemPlaylist.instantiate(playlist.title,null,`#playlist:${playlist.id}`,playlist.id,this.api).attachTo(this)}subRenderCreateAndDownload(){this.createAndAttach("div",{class:"input-group input-group-horizontal"},[this.$refs.createPlaylist=this.create("button",{title:"Create playlist"},this.create("span",{class:"fa fa-plus-circle"})),this.$refs.downloadPlaylists=this.create("button",{title:"Download playlist"},this.create("span",{class:"fa fa-download"}))]),this.$refs.createPlaylist.addEventListener("click",()=>{this.fireEvent("collection:intention:compose-new-playlist")}),this.$refs.downloadPlaylists.addEventListener("click",()=>{this.fireEvent("collection:intention:download")})}}AppNavigationPlaylists.register();const Navigation_AppNavigationPlaylists=AppNavigationPlaylists;class NavigationItemArtist extends Navigation_NavigationItem{static elementName="navigation-item-artist";__construct(label,icon,href,count){super.__construct(label,icon,href),this.count=count}render(){super.render(),this.$refs.a.createAndAttach("span",{class:"badge"},this.count)}}NavigationItemArtist.register();const Navigation_NavigationItemArtist=NavigationItemArtist;class AppNavigationArtists extends Element_CustomElement{static elementName="app-navigation-artists";__construct(api){super.__construct(),this.api=api}render(){this.clear(),this.classList.add("app-navigation__artists"),this.api.collection.artists.list().then(response=>{for(var artist in response.data)this.addArtistNavItem(artist,response.data[artist])})}addArtistNavItem(artistName,count){Navigation_NavigationItemArtist.instantiate(artistName,null,"#search?artist="+artistName,count).attachTo(this)}}AppNavigationArtists.register();const Navigation_AppNavigationArtists=AppNavigationArtists;class AppNavigation extends Element_CustomElement{static elementName="app-navigation";__construct(api){super.__construct(),this.api=api}render(){this.clear(),this.classList.add("app-navigation"),this.$refs.main=Navigation_AppNavigationMain.instantiate().attachTo(this),this.createAndAttach("hr"),this.$refs.playlists=Navigation_AppNavigationPlaylists.instantiate(this.api).attachTo(this),this.createAndAttach("hr"),this.$refs.artists=Navigation_AppNavigationArtists.instantiate(this.api).attachTo(this)}}AppNavigation.register();const Navigation_AppNavigation=AppNavigation;class Playable extends HTMLElement{constructor(){super(),this.state={isPaused:!1,isPlaying:!1,isReproducing:!1,isBuffering:!1,isWaiting:!1,isEnded:!1,volume:100}}appendTo(parentElement){return parentElement.append(this),new Promise(async(success,fail)=>success())}prependTo(parentElement){return parentElement.prepend(this),new Promise(async(success,fail)=>success())}appendAfter(siblingElement){return siblingElement.after(this),new Promise(async(success,fail)=>success())}get isPaused(){return this.state.isPaused}get isPlaying(){return this.state.isPlaying}get isReproducing(){return this.state.isReproducing}get isWaiting(){return this.state.isWaiting}get isBuffering(){return this.state.isBuffering}get isEnded(){return this.state.isEnded}get volume(){return this.state.volume}get currentTime(){}get currentTimeFormatted(){return Playable.secondsToStringRepresentation(this.currentTime)}get currentTimePercentage(){var time,duration;return time=Math.round(this.currentTime),duration=Math.round(this.duration),isNaN(time)||isNaN(duration)||0==time||0==duration?0:time/duration*100}get remainingTime(){return this.duration-this.currentTime}get remainingTimeFormatted(){return Playable.secondsToStringRepresentation(this.remainingTime)}get remainingTimePercentage(){return 100-this.currentTimePercentage}get duration(){}get durationFormatted(){return Playable.secondsToStringRepresentation(this.duration)}getTime(percentage){return Math.round(this.duration/100*percentage)}getTimeFormatted(percentage){return Playable.secondsToStringRepresentation(this.getTime(percentage))}getPercentage(time){return("string"==typeof time&&time.indexOf(":")>=0?Playable.stringRepresentationToSeconds(time):parseFloat(time))/this.duration*100}seek(time){}play(time=null){}pause(){}toggle(){this.isPlaying?this.pause():this.play()}sanitizeGetSeconds(time){var seconds;return seconds="string"==typeof time&&time.indexOf(":")>=0?Playable.stringRepresentationToSeconds(time):"string"==typeof time&&time.indexOf("%")>=0?this.getTime(parseInt(time)):"string"==typeof time?parseInt(time):time,isNaN(seconds)&&(seconds=0),seconds}fireEvent(eventName,detail,bubbles=!0){var options={bubbles};null!=detail&&(options.detail=detail);var event=new CustomEvent(eventName,options);return this.dispatchEvent(event)}log(msg){console.log(msg)}static secondsToStringRepresentation(seconds){return isNaN(seconds)?"00:00":(seconds=Math.round(seconds),string=(min=(min=(minutes=Math.floor(seconds/60))-60*(hours=Math.floor(minutes/60)))<10?"0"+min:min)+":"+(sec=(sec=seconds-60*minutes)<10?"0"+sec:sec),string=(hor=hours)>0?hor+":"+string:string);var hours,minutes,hor,min,sec,string}static stringRepresentationToSeconds(string){var matches,min,sec;return!((matches=string.match(/[0-9]+/g)).length>3)&&(sec=parseInt(matches[matches.length-1]),min=parseInt(matches[matches.length-2]||0),3600*parseInt(matches[matches.length-3]||0)+60*min+sec)}}const src_Playable=Playable;class Loader{constructor(src,propertyToCheck,appendTo=nul){this.src=src,this.propertyToCheck=propertyToCheck,this.appendTo=appendTo||document.body,this.loading=!1,this.loaded=!1}async load(){return new Promise(async(success,fail)=>{var script;(script=document.createElement("script")).async=!0,script.type="text/javascript",script.onload=e=>{this.checkOnProperty(success)},script.onerror=e=>{fail(this.src+" failed to load")},script.src=this.src,this.appendTo.appendChild(script)})}checkOnProperty(success){this.waiter=setInterval(()=>{if(Loader.isPropertyDefined(this.propertyToCheck))return this.loaded=!0,this.loading=!1,clearInterval(this.waiter),success(this.src+" ready")},100)}static isPropertyDefined(path,onObject=window){var properties=path.split("."),subject=onObject;for(var prp of properties)if(void 0===(subject=subject[prp]))return!1;return!0}}const src_Loader=Loader;const src_Helpers=class Helpers{static async loadExternalJs(src,propertyToCheck,appendTo=null){return new src_Loader(src,propertyToCheck,appendTo).load()}},playable=src_Playable;class PlayableYouTube extends playable{static sdkLoaded=!1;static sdkLoading=!1;static sdkPromise=null;static defaultSettings={width:640,height:"auto",autoplay:!1};constructor(){super(),this.state.currentTime=0,this.state.playerInitialized=!1,this.settings=PlayableYouTube.defaultSettings,this.settings.embbedId="youtube-embbed-"+Math.floor(1e4*Math.random()),this.settings.id=null,this.html={},this.follower=null}connectedCallback(){var src,videoId,width,height,autoplay;if(!this.html.embed)return this.html.embed=this.createDiv(this.settings.embbedId,this),(src=this.getAttribute("src"))&&(this.src=src),(videoId=this.getAttribute("video-id"))&&(this.videoId=videoId),(width=this.getAttribute("width"))&&(this.width=width),(height=this.getAttribute("height"))&&(this.height=height),(autoplay=this.getAttribute("autoplay"))&&(this.autoplay=["true","1"].includes(autoplay)),this.readyToPlayPromise=PlayableYouTube.loadSdk().then(()=>this.initializePlayer())}remove(){this.html.ytWidget&&this.html.ytWidget.destroy(),super.remove()}appendTo(parentElement){return parentElement.append(this),this.readyToPlayPromise}prependTo(parentElement){return parentElement.prepend(this),this.readyToPlayPromise}appendAfter(siblingElement){return siblingElement.after(this),this.readyToPlayPromise}set src(src){this.settings.id=PlayableYouTube.getIdFromUrl(src)}set videoId(videoId){this.settings.id=videoId}set width(width){this.settings.width=width,this.updateDimensions()}set height(height){this.settings.height=height,this.updateDimensions()}set autoplay(autoplay){this.settings.autoplay=autoplay}calculateDimensions(){var actualWidth,actualHeight,width=this.settings.width,height=this.settings.height;return"auto"==width?actualWidth=this.parentNode.offsetWidth>400?400:this.parentNode.offsetWidth:"string"==typeof width&&width.indexOf("%")>-1?(actualWidth=parseInt(width),actualWidth=parseInt(this.parentNode.offsetWidth/100*actualWidth)):actualWidth=width,"auto"==height?actualHeight=parseInt(actualWidth/1.77):"string"==typeof height&&height.indexOf("%")>-1?(actualHeight=parseInt(height),actualHeight=parseInt(this.parentNode.offsetHeight/100*actualHeight)):actualHeight=height,{actualWidth,actualHeight}}updateDimensions(){if(this.html.ytWidget){var iframe=this.html.ytWidget.getIframe(),{actualWidth,actualHeight}=this.calculateDimensions();iframe.style.width=actualWidth+"px",iframe.style.height=actualHeight+"px"}}get currentTime(){return this.state.currentTime}get duration(){return this.html.ytWidget&&this.html.ytWidget.getDuration?this.html.ytWidget.getDuration():0}seek(time){if(!this.state.playerInitialized)return!1;var seconds=this.sanitizeGetSeconds(time);this.html.ytWidget.seekTo(seconds,!0)}play(time=null){return time&&this.seek(time),new Promise((success,fail)=>this.state.playerInitialized?(this.html.ytWidget.playVideo(),success()):fail("Player has not been initialized"))}pause(){if(!this.state.playerInitialized)return!1;this.html.ytWidget.pauseVideo()}setVolume(vol){this.state.volume=vol,this.state.playerInitialized&&this.html.ytWidget.setVolume(vol)}async initializePlayer(){return new Promise(async(success,fail)=>{var{actualWidth,actualHeight}=this.calculateDimensions();this.html.ytWidget=new YT.Player(this.settings.embbedId,{width:actualWidth,height:actualHeight,videoId:this.settings.id,startSeconds:0,playerVars:{autoplay:this.settings.autoplay,controls:0},events:{onReady:event=>{success(this),this.setVolume(this.volume),this.state.playerInitialized=!0},onError:error=>{var message=PlayableYouTube.getErrorDescription(error.data);fail(message),this.fireEvent("playable:error",{errorCode:error.data,errorMessage:message})},onStateChange:this.callBackOnStateChange.bind(this)}})})}callBackOnStateChange(e){switch(e.data){case-1:this.state.isReproducing=!1,this.state.isPlaying=!1,this.state.isPaused=!1;break;case 0:this.state.isReproducing=!1,this.state.isPlaying=!1,this.state.isPaused=!0,this.state.isWaiting=!1,this.state.isEnded=!0,this.stopFollowing(),this.fireEvent("playable:ended");break;case 1:var waiting=this.state.isWaiting;this.state.isReproducing=!0,this.state.isPlaying=!0,this.state.isPaused=!1,this.state.isBuffering=!1,this.state.isWaiting=!1,this.state.isEnded=!1,this.startFollowing(),waiting?this.fireEvent("playable:playing"):this.fireEvent("playable:play");break;case 2:this.state.isReproducing=!1,this.state.isPlaying=!1,this.state.isPaused=!0,this.state.isWaiting=!1,this.fireEvent("playable:pause");break;case 3:this.state.isReproducing=!1,this.state.isPlaying=!0,this.state.isPaused=!1,this.state.isBuffering=!0,this.state.isWaiting=!0,this.fireEvent("playable:waiting");break;case 5:this.play(0),this.fireEvent("playable:play")}}startFollowing(){this.follower=setInterval(this.following.bind(this),1e3)}stopFollowing(){clearInterval(this.follower)}following(){var t=this.html.ytWidget&&this.html.ytWidget.getCurrentTime?this.html.ytWidget.getCurrentTime():0;t!=this.currentTime&&(this.state.currentTime=t,this.fireEvent("playable:timeupdate"))}static getErrorDescription(errorCode){switch(errorCode){case"2":return"Error 2: invalid parameters.";case"5":return"Error 5: An error related to the HTML5 player occurred.";case"100":return"Error 100: Video not found.";case"101":case"150":return"Error 101: The video's owner won't allow it on embbed players."}return"Error "+errorCode+": Unknown error"}static getIdFromUrl(url){var m;return(m=url.match(/v=([A-Za-z0-9-_]+)/))||(m=url.match(/\.be\/([A-Za-z0-9-_]+)/))||(m=url.match(/embed\/([A-Za-z0-9-_]+)/))?m[1]:null}static async loadSdk(){return PlayableYouTube.sdkLoaded?new Promise(async(success,fail)=>{success()}):PlayableYouTube.sdkLoading?PlayableYouTube.sdkPromise:(PlayableYouTube.sdkLoading=!0,PlayableYouTube.sdkPromise=new Promise(async(success,fail)=>{src_Helpers.loadExternalJs("https://www.youtube.com/iframe_api","YT.Player").then(()=>(PlayableYouTube.sdkLoaded=!0,PlayableYouTube.sdkLoading=!1,success("YouTube SDK ready")),()=>(PlayableYouTube.sdkLoading=!1,fail("Error loading SDK")))}))}createDiv(id,parent){var div=document.createElement("div");return div.id=id,parent.append(div),div}}const playable_youtube_wrapper=PlayableYouTube;const src_PlayableAudio=class PlayableAudio_PlayableAudio extends playable{constructor(){super(),this.settings={src:null}}connectedCallback(){this.mediaP||(this.mediaP=this.createMedia(),this.mediaP.src=this.settings.src,this.append(this.mediaP),this.mediaP.addEventListener("play",evt=>{this.state.isPaused=!1,this.state.isPlaying=!0,this.state.isWaiting=!1,this.fireEvent("playable:play")}),this.mediaP.addEventListener("pause",evt=>{this.state.isPlaying=!1,this.state.isPaused=!0,this.state.isReproducing=!1,this.fireEvent("playable:pause")}),this.mediaP.addEventListener("timeupdate",evt=>{this.state.isReproducing=!0,this.state.isEnded=!1,this.fireEvent("playable:timeupdate")}),this.mediaP.addEventListener("ended",evt=>{this.state.isPlaying=!1,this.state.isPaused=!0,this.state.isReproducing=!1,this.state.isWaiting=!1,this.state.isEnded=!0,this.fireEvent("playable:ended")}),this.mediaP.addEventListener("error",evt=>{this.fireEvent("playable:error",{errorCode:0,errorMessage:"Resource could not be loaded"})}),this.mediaP.addEventListener("loadstart",evt=>{this.state.isBuffering=!0}),this.mediaP.addEventListener("progress",evt=>{this.state.isBuffering=!0}),this.mediaP.addEventListener("waiting",evt=>{this.state.isReproducing=!1,this.state.isBuffering=!0,this.state.isWaiting=!0,this.fireEvent("playable:waiting")}),this.mediaP.addEventListener("playing",evt=>{this.state.isWaiting=!1,this.fireEvent("playable:playing")}),this.mediaP.addEventListener("canplaythrough",evt=>{this.state.isBuffering=!1,this.state.isWaiting=!1}),this.mediaP.addEventListener("canplay",evt=>{this.state.isBuffering=!1,this.state.isWaiting=!1}),this.mediaP.addEventListener("suspend",evt=>{this.state.isBuffering=!1}),this.mediaP.addEventListener("abort",evt=>{this.state.isBuffering=!1}),this.mediaP.addEventListener("stalled",evt=>{this.state.isBuffering=!1}))}set src(src){this.settings.src=src}get currentTime(){return this.mediaP.currentTime}get duration(){return this.mediaP.duration}play(time=this.currentTime){return this.seek(time),this.mediaP.play()}pause(){this.mediaP.pause()}seek(time){var seconds=this.sanitizeGetSeconds(time);this.mediaP.currentTime=seconds}setVolume(volume){this.state.volume=volume;var vol=volume>0?volume/100:volume;this.mediaP.volume=vol}createMedia(){return new Audio}};const playable_html_wrapper=src_PlayableAudio;class FloatMenuItem extends Element_CustomElement{static elementName="float-menu-item";__construct(title,helpText,icon,onClick){super.__construct(),this.title=title,this.helpText=helpText,this.icon=icon,this.onClick=onClick}render(){this.classList.add("float-menu__item"),this.$refs.body=this.createAndAttach("div",{title:this.helpText},this.title),this.addEventListener("click",evt=>{evt.stopPropagation(),this.onClick(evt),this.fireEvent("float-menu-item:selected")}),this.addEventListener("mousedown",evt=>{evt.stopPropagation()}),this.addEventListener("mouseup",evt=>{evt.stopPropagation()})}}FloatMenuItem.register();const FloatMenu_FloatMenuItem=FloatMenuItem;class FloatMenu extends Element_CustomElement{static elementName="float-menu";__construct(menuActions={}){super.__construct(),this.menuActions=menuActions,this.opened=!1,this.addEventListener("float-menu-item:selected",this.close.bind(this)),window.document.addEventListener("float-menu:opened",this.closeAndRemove.bind(this)),window.document.addEventListener("click",this.closeAndRemove.bind(this))}closeAndRemove(e){e.detail.menu&&e.detail.menu==this||this.close().remove()}render(){this.classList.add("float-menu"),this.$refs.list=this.createAndAttach("div",{class:"float-menu__list"}),this.opened&&this.subRenderItems()}subRenderItems(){for(var p in this.menuActions){var i=this.menuActions[p];this.$refs.list.append(FloatMenu_FloatMenuItem.instantiate(i.title,i.helpText,i.icon,i.onClick))}}open(evt,originX=0,originY=0){var x,y,thisWidth,thisHeight;return evt.menuOpened=this,this.opened=!0,this.refresh(),thisWidth=this.$refs.list.offsetWidth,thisHeight=this.$refs.list.offsetHeight,x=originX+thisWidth>window.innerWidth?window.innerWidth-thisWidth:originX,y=originY+thisHeight>window.innerHeight?window.innerHeight-thisHeight:originY,this.style.left=x+"px",this.style.top=y+"px",this.fireEvent("float-menu:opened",{menu:this}),this}close(){return this.opened=!0,this.clear(),this.fireEvent("float-menu:closed"),this}addMenuItem(id,title,helpText,icon,onClick){return this.menuItems[id]={title,helpText,icon,onClick},this}}FloatMenu.register();const FloatMenu_FloatMenu=FloatMenu;const Component_ContextualElement=class ContextualElement extends Element_CustomElement{static elementName="contextual-element";render(){this.$refs.footer=this.createAndAttach("div",{class:"playlist-item__footer"}),this.addEventListener("contextmenu",evt=>{evt.preventDefault(),this.openContextMenu(evt)})}getDefaultContextActions(){return{helloWorld:{title:"Hello world",helpText:"says hello",icon:"fa-plus",onClick:()=>{alert("Hello World")}}}}getContextActions(){var actions=this.getDefaultContextActions();return this.fireEvent("context-menu:actions:invite-alter",{actions}),actions}openContextMenu(contextMenuEvent){this.actions=this.getContextActions();var menu=FloatMenu_FloatMenu.instantiate(this.actions);this.append(menu),menu.open(contextMenuEvent,contextMenuEvent.clientX,contextMenuEvent.clientY)}};class PlaylistItem_PlaylistItem extends Component_ContextualElement{static elementName="playlist-item";__construct(item={},options={}){super.__construct(),PlaylistItem_PlaylistItem.sanitizeItem(item),this.item=item,this.options=options}render(){super.render(),this.innerHTML="",this.classList.add("playlist-item"),this.subRenderHeader(),this.subRenderBody(),this.subRenderFooter()}subRenderHeader(){this.options.disablePlayButton||(this.$refs.header=this.createAndAttach("div",{class:"playlist-item__header"},[this.$refs.playButton=this.create("button",null,this.createAndAttach("span",{class:"fa fa-play"}))]),this.$refs.playButton.addEventListener("click",()=>{this.fireEvent("queue:item-selected",{item:this.item})}))}subRenderBody(){for(var artist of(this.$refs.body=this.createAndAttach("div",{class:"playlist-item__body"}),(this.item.title||this.item.album)&&(this.$refs.title=this.$refs.body.createAndAttach("span",{class:"playlist-item__title"},[this.item.title||this.item.album])),this.item.artist))this.$refs.body.createAndAttach("span",{class:"playlist-item__artist playlist-item__info"},[this.create("a",{href:`#search?artist=${artist}`,title:artist},artist)," ",this.create("a",{href:`#discover:albums?artist=${artist}`,title:`${artist}`},this.createAndAttach("span",{class:"fa fa-search"}))]);for(var soundtrack of this.item.soundtrack)this.$refs.body.createAndAttach("span",{class:"playlist-item__soundtrack playlist-item__info"},[this.create("a",{href:`#search?soundtrack=${soundtrack}`,title:soundtrack},soundtrack)])}subRenderFooter(){this.$refs.footer=this.createAndAttach("div",{class:"playlist-item__footer"}),this.$refs.popupButton=this.$refs.footer.createAndAttach("button",null,this.create("span",{class:"fa fa-ellipsis-v"})),this.$refs.popupButton.addEventListener("click",evt=>{evt.stopPropagation(),this.openContextMenu(evt)})}getDefaultContextActions(){var actions={addToPlaylist:{title:"Save to collection",helpText:"Add item to a playlist",icon:"fa-plus",onClick:()=>{this.fireEvent("item:intention:add-to-collection",{items:[this.item]})}}};return actions.playNext={title:"Play next",helpText:"Play once the current song is finished",icon:"fa-minus",onClick:()=>{this.fireEvent("queue:intention:play-it-next",{item:this.item})}},this.item.uuid?(actions.editItem={title:"Edit it",helpText:"Edit item in your collection",icon:"fa-pencil",onClick:()=>{this.fireEvent("item:intention:edit",{uuid:this.item.uuid})}},actions.removeItem={title:"Delete item",helpText:"Delete item from your collection",icon:"fa-times",onClick:()=>{this.fireEvent("item:intention:delete",{uuid:this.item.uuid})}},actions):actions}static sanitizeItem(item){item.artist?item.artist=Array.isArray(item.artist)?item.artist:[item.artist]:item.artist=[],item.soundtrack?item.soundtrack=Array.isArray(item.soundtrack)?item.soundtrack:[item.soundtrack]:item.soundtrack=[]}}PlaylistItem_PlaylistItem.register();const Component_PlaylistItem=PlaylistItem_PlaylistItem;const State_State=class State{constructor(name,data=null){this.name=name,this.data=data||this.retrieve()}get(variable,defaultValue=null){return null==this.data[variable]?defaultValue:this.data[variable]}getInt(variable,defaultValue=0){return parseInt(this.get(variable,defaultValue))}set(variable,value){this.data[variable]=value,this.save()}save(){var json=JSON.stringify(this.data);localStorage.setItem(this.name,json)}retrieve(){var json=localStorage.getItem(this.name);return json?JSON.parse(json):{}}};customElements.define("player-youtube",playable_youtube_wrapper),customElements.define("player-audio",playable_html_wrapper);class ReproductionControls extends Element_CustomElement{static elementName="reproduction-controls";__construct(api,item=null,resources=null,autoPlay=!0,shuffleOn=!1){super.__construct(),this.api=api,this.item=item,this.resources=resources,this.index=0,this.player=null,this.state=new State_State("controls.state"),this.autoPlay=autoPlay,this.shuffleOn=shuffleOn}render(){this.classList.add("reproduction-controls"),this.subRenderItem(),this.subRenderClock(),this.subRenderButtons(),this.subRenderVolume(),this.subRenderQueueButton(),this.subRenderProgressBar(),this.$refs.playerFrame=this.createAndAttach("div",{class:"player-frame intangible"}),this.shuffleOn?this.turnShuffleOn():this.turnShuffleOff(),this.resources&&(this.addEventListener("playable:timeupdate",this.onTimeUpdate.bind(this)),this.addEventListener("playable:ended",()=>{console.log("Reproduction: ended")}),this.addEventListener("playable:pause",()=>{console.log("Reproduction: paused")}),this.addEventListener("playable:error",evt=>{console.error(evt.detail),this.notIt()}),this.setupResource(0,this.autoPlay))}subRenderItem(){this.item&&(this.$refs.playlistItem=this.attach(Component_PlaylistItem.instantiate(this.item,{disablePlayButton:!0}))),this.resources&&this.resources.length&&(this.$refs.buttonNotIt=this.createAndAttach("button",{class:"reproduction-controls__not-it",title:"not it"},this.create("span",{class:"fa fa-refresh"})),this.$refs.buttonNotIt.addEventListener("click",this.notIt.bind(this)))}subRenderClock(){this.$refs.timer=this.createAndAttach("span",{class:"reproduction-controls__timer"},"--:--")}subRenderButtons(){this.createAndAttach("div",{class:"reproduction-controls__buttons button-group"},[this.$refs.buttonBackward=this.create("button",{class:"reproduction-controls__button-next"},this.create("span",{class:"fa fa-backward"})),this.$refs.buttonPlay=this.create("button",{class:"reproduction-controls__button-play"},this.create("span",{class:"fa fa-play"})),this.$refs.buttonNext=this.create("button",{class:"reproduction-controls__button-next"},this.create("span",{class:"fa fa-forward"}))]),this.$refs.buttonShuffle=this.createAndAttach("button",{class:"reproduction-controls__shuffle",title:"toggle shuffle"},this.create("span",{class:"fa fa-random"})),this.$refs.buttonPlay.addEventListener("click",this.toggle.bind(this)),this.$refs.buttonBackward.addEventListener("click",()=>{this.fireEvent("queue:intention:backward")}),this.$refs.buttonNext.addEventListener("click",()=>{this.fireEvent("queue:intention:forward")}),this.$refs.buttonShuffle.addEventListener("click",()=>{this.fireEvent("player:intention:toggle-shuffle")})}subRenderVolume(){this.$refs.volumeControl=this.createAndAttach("input",{type:"range",min:0,max:100,step:1,class:"reproduction-controls__volume"}),this.$refs.volumeControl.value=this.state.getInt("volume",15),this.$refs.volumeControl.addEventListener("change",this.dialVolume.bind(this))}subRenderQueueButton(){this.$refs.buttonQueue=this.createAndAttach("button",{class:"reproduction-controls__button-queue",title:"Queue"},this.create("span",{class:"fa fa-list"})),this.$refs.buttonQueue.addEventListener("click",()=>{this.fireEvent("gui:summon-queue")})}subRenderProgressBar(){this.$refs.progress=this.createAndAttach("progress",{max:100,class:"reproduction-controls__progress"}),this.$refs.progress.addEventListener("click",this.seek.bind(this))}remove(){return this.destroyPlayer(),super.remove()}notIt(){this.resources[this.index+1]?(this.index++,this.destroyPlayer(),this.playResource(this.index)):alert("no more alternatives")}playResource(index=0){this.setupResource(index,!0)}setupResource(index=0,play=!0){console.log("Reproduction: booting player"),window.player=this.player=this.createPlayer(this.resources[index]),this.player?this.player.appendTo(this.$refs.playerFrame).then(()=>{this.setMediaSession(this.resources[index]),play&&this.player.play(),this.player.setVolume(this.state.getInt("volume",15)),console.log("Reproduction: reproducing audio")}):console.error("Could not instantiate a player")}setMediaSession(resource){if(!(!1 in navigator)){var{title,artist,album}=this.item;artist=Array.isArray(artist)?artist.join(", "):artist;var mediaMetadata=new MediaMetadata({title,artist,album});resource.thumbnail&&(mediaMetadata.artwork=[{src:resource.thumbnail,sizes:"120x90",type:"image/jpeg"}]),navigator.mediaSession.metadata=mediaMetadata}}destroyPlayer(){return this.player&&(this.player.pause(),this.player.remove()),this}createPlayer(resource){switch(resource.source){case"youtube":case"youtubeLax":return this.createPlayerYouTube(resource);case"sliderkz":case"localFiles":return this.createPlayerSliderKz(resource)}}createPlayerYouTube(resource){var player=document.createElement("player-youtube");return player.videoId=resource.id,player.width=390,player}createPlayerSliderKz(resource){var player=document.createElement("player-audio");return player.src=resource.src,player}toggle(){this.player&&this.player.toggle()}onTimeUpdate(){this.$refs.timer.innerHTML=this.player.currentTimeFormatted,this.$refs.progress.value=this.player.currentTimePercentage}dialVolume(evt){var volume=evt.target.value;this.state.set("volume",volume),this.player&&this.player.setVolume(volume)}seek(evt){var x,width,perc;this.player&&(x=evt.clientX-this.$refs.progress.offsetLeft,width=this.$refs.progress.offsetWidth,perc=Math.ceil(x/width*100)+"%",this.player.seek(perc))}turnShuffleOff(){this.$refs.buttonShuffle.setAttribute("title","turn shuffle on")}turnShuffleOn(){this.$refs.buttonShuffle.setAttribute("title","turn shuffle off")}}ReproductionControls.register();const Component_ReproductionControls=ReproductionControls;const BaseView=class ViewElement extends Element_CustomElement{static elementName="view-base";__construct(hashRequest,api){super.__construct(),this.hashRequest=hashRequest,this.api=api}afterRender(){this.classList.add("view")}};class ViewWelcome extends BaseView{static elementName="view-welcome";render(){var p=document.createElement("p");p.innerHTML="Welcome back",this.append(p)}}ViewWelcome.register();const View_ViewWelcome=ViewWelcome;const View_MusicPlayingView=class MusicPlayingView extends BaseView{getPlayableItems(beginningWith=null){var initialBatch=this.$refs.playlist.getItems();for(var key in initialBatch)if(initialBatch[key]==beginningWith){initialBatch=initialBatch.slice(key);break}return initialBatch}};class ListOfItems extends Element_CustomElement{static elementName="list-of-items";__construct(descriptions=[]){super.__construct(),this.descriptions=descriptions,this.selectionStart=null,this.draggingElement=null}render(){for(var item of(this.$refs.list=this.createAndAttach("ol"),this.classList.add(ListOfItems.elementName),this.descriptions))item?this.addElement(item):console.error("falsy item");this.addEventListenerOnce("mousedown","mousedown",this.onMouseDown.bind(this)),this.addEventListenerOnce("mouseup","mouseup",this.onMouseUp.bind(this)),this.addEventListenerOnce("dragstart","dragstart",this.onDragStart.bind(this)),this.addEventListenerOnce("dragend","dragend",this.onDragEnd.bind(this)),this.addEventListenerOnce("item-add-to-collection","item:intention:add-to-collection",this.onAddToCollection.bind(this)),"true"==this.getAttribute("reordable")&&(this.addEventListenerOnce("dragover","dragover",this.onDragOver.bind(this)),this.addEventListenerOnce("drop","drop",this.onDrop.bind(this)))}addElement(item){return this.$refs.list.createAndAttach("li",{draggable:"true"},Component_PlaylistItem.instantiate(item))}onDragStart(evt){this.draggingElement=evt.target;var json=JSON.stringify(this.getSelectedItems());evt.dataTransfer.setData("text/plain",json)}onDragEnd(evt){}onAddToCollection(evt){evt.detail.items=evt.detail.items.concat(this.getSelectedItems())}onMouseDown(evt){if(1===evt.which){var li=evt.target.getAncestor("li");if(li){var liIndex=li.index();this.getSelectedElements().length&&0==evt.shiftKey&&0==evt.ctrlKey&&this.isElementSelected(li)||(evt.ctrlKey||this.deselectAllElements(),null!==this.selectionStart&&0!=evt.shiftKey||(this.selectionStart=liIndex),evt.ctrlKey?this.isElementSelected(li)?this.deselectElement(li):this.selectElement(li):(this.selectElement(li),evt.shiftKey&&this.selectRange(this.selectionStart,liIndex)))}}}onMouseUp(evt){if(1===evt.which){var li=evt.target.getAncestor("li");if(li){var liIndex=li.index();0==evt.shiftKey&&0==evt.ctrlKey&&(this.deselectAllElements(),this.selectElement(li),this.selectionStart=liIndex)}}}onDragOver(evt){evt.preventDefault()}onDrop(evt){this.dropIsValid(evt)&&(this.draggingElement?this.onDropLocal(evt):this.onDropForeign(evt))}onDropLocal(evt){var droppedOnLi=evt.target.getAncestor("li"),selectedElements=this.getSelectedElements(),oldIndexes=this.extractIndexes(selectedElements);droppedOnLi.before(...selectedElements),selectedElements=this.getSelectedElements();var newIndexes=this.extractIndexes(selectedElements),changes=[];for(var n in newIndexes)oldIndexes[n]!=newIndexes[n]&&changes.push({from:oldIndexes[n],item:selectedElements[n].firstChild.item,to:newIndexes[n]});this.fireEvent("list-of-items:reordered",{changes})}dropIsValid(dropEvt){return!0}onDropForeign(evt){}selectElement(element){element.classList.add("selected")}deselectElement(element){element.classList.remove("selected")}isElementSelected(element){return element.classList.contains("selected")}select(index){var n=index+1;this.selectElement(this.querySelector(`li:nth-child(${n})`))}selectRange(indexStart,indexEnd){var begin,end;indexEnd>indexStart?(begin=indexStart,end=indexEnd):(begin=indexEnd,end=indexStart);for(var n=begin;n<=end;n++)this.select(n)}deselectAllElements(){this.querySelectorAll("li.selected").forEach(el=>{this.deselectElement(el)})}getSelectedElements(){return this.querySelectorAll("li.selected")}getSelectedItems(){return this.extractItems(this.getSelectedElements())}getItems(){return this.extractItems(this.getElements())}getElements(){return this.querySelectorAll("li")}extractItems(nodeList){var items=[];return nodeList.forEach(el=>{items.push(el.querySelector(Component_PlaylistItem.elementName).item)}),items}extractIndexes(nodeList){var indexes=[];return nodeList.forEach(el=>{indexes.push(el.index())}),indexes}setItems(descriptions){if(this.descriptions=descriptions,this.attached){var previouslySelectedItems=this.getSelectedItems();this.refresh(),previouslySelectedItems.length&&setTimeout(()=>{for(var li of this.$refs.list.children)previouslySelectedItems.includes(li.firstChild.item)&&this.selectElement(li)},100)}}}ListOfItems.register();const Component_ListOfItems=ListOfItems;class SearchHeader extends Element_CustomElement{static elementName="view-search-header";__construct(request,title,fields){super.__construct(),this.request=request,this.title=title,this.fields=fields}render(){var input;for(var field of(this.classList.add("search-header"),this.$refs.form=this.createAndAttach("form",{action:"#"+this.request.path,title:this.title,class:"input-group input-group-horizontal"}),this.fields))field.value=this.request.queryParams.get(field.name)||"",input=this.$refs.form.createAndAttach("input",field),field.value.length&&(input.focus(),input.selectionStart=input.selectionEnd=input.value.length);this.$refs.form.createAndAttach("button",null,[this.create("span",{class:"fa fa-search"})])}}SearchHeader.register();const Component_SearchHeader=SearchHeader;class Pagination extends Element_CustomElement{static elementName="view-pagination";__construct(request,response){super.__construct(),this.request=request,this.response=response,this.response.meta&&this.response.meta.pages&&(this.max=10,this.halfMax=this.max/2,this.response.meta.pages<=this.max?(this.first=1,this.last=this.response.meta.pages):this.response.meta.page+this.halfMax>this.response.meta.pages?(this.last=this.response.meta.pages,this.first=this.last-this.max):this.response.meta.page>this.halfMax?(this.first=this.response.meta.page-this.halfMax,this.last=this.response.meta.page+this.halfMax):(this.first=1,this.last=this.first+this.max),this.between=this.last-this.first+1)}render(){this.classList.add("button-group"),this.classList.add("view-nav"),this.response.meta&&this.response.meta.pages&&(this.subRenderAnchorToBeginning(),this.subRenderAnchorToPreviousPage(),this.subRenderAnchorBetweenExtremes(),this.subRenderAnchorToNextPage(),this.subRenderAnchorToLast())}subRenderAnchorToBeginning(){if(1!=this.first){var queryParams=this.request.queryParams.without("page");queryParams.set("page",1),this.createAndAttach("a",{href:this.request.path.replace("/","#")+"?"+queryParams.toString(),"data-page":1,class:"btn view-nav-first",title:this.request.meta.title},["first"])}}subRenderAnchorToPreviousPage(){if(!(1==this.response.meta.page||this.between<=3)){var queryParams=this.request.queryParams.without("page");queryParams.set("page",this.response.meta.page-1),this.createAndAttach("a",{href:this.request.path.replace("/","#")+"?"+queryParams.toString(),"data-page":this.response.meta.page-1,class:"btn view-nav-previous",title:this.request.meta.title},["prev"])}}subRenderAnchorBetweenExtremes(){if(!(this.response.meta.pages<=1))for(var p=this.first;p<=this.last;p++){var queryParams=this.request.queryParams.without("page");queryParams.set("page",p);var current=this.response.meta.page==p;this.createAndAttach("a",{href:this.request.path.replace("/","#")+"?"+queryParams.toString(),"data-page":p,class:current?"btn view-nav-current":"btn",title:this.request.meta.title},[p])}}subRenderAnchorToNextPage(){if(!(this.response.meta.page==this.response.meta.pages||this.between<=3)){var queryParams=this.request.queryParams.without("page");queryParams.set("page",this.response.meta.page+1),this.createAndAttach("a",{href:this.request.path.replace("/","#")+"?"+queryParams.toString(),"data-page":this.response.meta.page+1,class:"btn view-nav-next",title:this.request.meta.title},["next"])}}subRenderAnchorToLast(){if(this.last!=this.response.meta.pages){var queryParams=this.request.queryParams.without("page");queryParams.set("page",this.response.meta.pages),this.createAndAttach("a",{href:this.request.path.replace("/","#")+"?"+queryParams.toString(),"data-page":this.response.meta.pages,class:"btn view-nav-last",title:this.request.meta.title},["last"])}}}Pagination.register();const Component_Pagination=Pagination;class Events{static enableBottomReached(element){element.addEventListener("scroll",Events.onScroll.bind(element))}static onScroll(evt){this.scrollTop+this.offsetHeight>=this.scrollHeight&&this.dispatchEvent(new CustomEvent("scroll:bottom-reached",{bubbles:!1}))}}const Helper_Events=Events;class Queue extends Array{static instantiate(items=[],queueContext){var queue=new Queue;return queue.enqueue(items),queue.context=queueContext,queue.fetchingPromise=null,queue}enqueue(item){Array.isArray(item)?this.enqueueMultiple(item):this.enqueueSingle(item)}dequeue(){return this.removeIndex(0)}removeIndex(index){var removedItem=this[index]||null;return this.splice(index,1),this.updatedCallback(),removedItem}dropIn(item){this.jump(item,0)}jump(item,index=1){if(Array.isArray(item))for(var i=0;i<item.length;i++)this.jump(item[i],i);else this.splice(index,0,item);this.updatedCallback()}move(fromIndex,intoIndex=0){console.log(`movin queue item from ${fromIndex} to position ${intoIndex}`);var target=this.splice(fromIndex,1)[0];return this.splice(intoIndex,0,target),this.updatedCallback(),target}getPosition(item){for(var i=0;i<this.length;i++)if(item==this[i]||item.uuid&&this[i].uuid&&item.uuid==this[i].uuid)return i;return-1}clear(){this.splice(0,this.length),this.updatedCallback()}get front(){return this[0]?this[0]:(console.log("Queue: end reached"),null)}get back(){return this.length?this[this.length-1]:null}async getNextInLine(){return this.length>=2?new Promise((success,fail)=>success(this[1])):this.fetchMore().then(response=>this[1]||null)}async fetchMore(){return console.log("Queue: Searching for more content"),this.fetchingPromise?this.fetchingPromise:this.context?this.fetchingPromise=this.context.fetchMore(this).then(response=>(this.fetchingPromise=null,response.data&&response.data.length?this.enqueue(response.data):console.log("Queue: nothig more to add to the queue"),response)):new Promise((success,fail)=>{success([])})}isShuffled(){return!!this.context&&(!!this.context.queryParams&&"1"==this.context.queryParams.get("shuffle"))}shuffle(reset=!1){if(this.context&&this.context.queryParams){var seed=this.generateRandomSeed();reset&&this.splice(1),this.context.queryParams.set("page",0),this.context.queryParams.set("orderBy",`RAND(${seed})`),this.context.queryParams.set("shuffle","1")}}unshuffle(){this.context&&this.context.queryParams&&(this.context.queryParams.set("page",0),this.context.queryParams.delete("orderBy"),this.context.queryParams.delete("shuffle"))}generateRandomSeed(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,c=>(+c^crypto.getRandomValues(new Uint8Array(1))[0]&15>>+c/4).toString(16))}enqueueMultiple(items){this.push(...items),console.log("Queue: multiple items added"),this.updatedCallback()}enqueueSingle(item){this.push(item),console.log("Queue: single item added"),this.updatedCallback()}updatedCallback(){console.log("queue updated")}}const Line_Queue=Queue;const Line_ContextBase=class ContextBase{constructor(api,noMore=!1){this.api=api,this.noMore=noMore}static id(){return"base"}serialize(){return{id:this.constructor.id(),noMore:this.noMore}}async fetchMore(queue){return this.noMore?new Promise((success,fail)=>success({data:[]})):(this.progress(),this.request(queue).then(response=>(response.data&&0!=response.data.length||(this.noMore=!0),response)))}progress(){}async request(queue){}};class ContextSearch extends Line_ContextBase{constructor(api,noMore=!1,queryParams){super(api,noMore),this.queryParams="string"==typeof queryParams?new URLSearchParams(queryParams):queryParams}static id(){return"search"}serialize(){return{id:ContextSearch.id(),noMore:this.noMore,queryParams:this.queryParams?this.queryParams.toString():""}}progress(){var page=parseInt(this.queryParams.get("page")||1)+1;this.queryParams.set("page",page)}async request(queue){return this.api.collection.playlistItems.search(this.queryParams)}}const Line_ContextSearch=ContextSearch;class ContextPlaylist extends Line_ContextSearch{constructor(api,noMore=!1,queryParams,playlistId){super(api,noMore,queryParams),this.playlistId=playlistId}static id(){return"playlist"}serialize(){return{id:ContextPlaylist.id(),noMore:this.noMore,queryParams:this.queryParams?this.queryParams.toString():"",playlistId:this.playlistId}}async request(queue){return this.api.collection.playlists.get(this.playlistId).getItems(this.queryParams)}}const Line_ContextPlaylist=ContextPlaylist;class ViewPlaylist extends View_MusicPlayingView{static elementName="view-playlist";async render(){this.classList.add(ViewPlaylist.elementName),await this.fetchPlaylist().then(response=>this.subRenderHeader(response)),this.fetchItems().then(response=>{this.response=response,this.subRenderItems(response),this.subRenderNavigation(response)}),Helper_Events.enableBottomReached(this),this.addEventListener("scroll:bottom-reached",this.bottomReached.bind(this)),this.addEventListener("queue:item-selected",this.onItemSelected.bind(this)),this.addEventListener("list-of-items:reordered",this.onItemsReordered.bind(this))}bottomReached(evt){console.log("Bottom of the page reached")}fetchPlaylist(){return this.api.collection.playlists.get(this.hashRequest.attributes.playlistId).read()}fetchItems(){return this.api.collection.playlists.get(this.hashRequest.attributes.playlistId).getItems(this.hashRequest.queryParams)}subRenderHeader(response){this.$refs.header=this.createAndAttach("header",{class:"header"},[this.$refs.headerH=this.create("div",{class:"header__header"}),this.$refs.headerB=this.create("div",{class:"header__body"}),this.$refs.headerF=this.create("div",{class:"header__footer"})]),this.$refs.headerH.createAndAttach("h1",null,response.data.title),response.data.description&&this.$refs.headerH.createAndAttach("h3",null,response.data.description),this.$refs.buttons=this.$refs.headerF.createAndAttach("div",{class:"button-group"},[this.$refs.buttonAdd=this.create("button",{title:"Add new item to playlist"},this.create("span",{class:"fa fa-plus"})),this.$refs.buttonEdit=this.create("button",{title:"Edit playlist"},this.create("span",{class:"fa fa-pencil"})),this.$refs.buttonDelete=this.create("button",{title:"Delete entire playlist",class:"btn-danger"},this.create("span",{class:"fa fa-close"}))]),this.$refs.buttonAdd.addEventListener("click",()=>{this.fireEvent("playlist:intention:compose-new-item",{playlistId:this.hashRequest.attributes.playlistId})}),this.$refs.buttonEdit.addEventListener("click",()=>{this.fireEvent("playlist:intention:edit",{playlistId:this.hashRequest.attributes.playlistId})}),this.$refs.buttonDelete.addEventListener("click",()=>{this.fireEvent("playlist:intention:delete",{playlistId:this.hashRequest.attributes.playlistId})}),this.$refs.headerB.append(Component_SearchHeader.instantiate(this.hashRequest,response.data.title,[{type:"search",name:"title",placeholder:"Title",class:"main"},{type:"search",name:"artist",placeholder:"Artist",title:"Artist"},{type:"search",name:"genre",placeholder:"Genre",title:"Genre"},{type:"search",name:"soundtrack",placeholder:"Soundtrack",title:"Soundtrack"}]))}async subRenderItems(response){response.data&&(this.$refs.playlist=Component_ListOfItems.instantiate(response.data),this.$refs.playlist.classList.add("playlist"),this.filtering()||this.$refs.playlist.setAttribute("reordable","true"),this.append(this.$refs.playlist))}filtering(){return!this.hashRequest.queryParams.without("page").isEmpty()}subRenderNavigation(response){this.$refs.pagination=Component_Pagination.instantiate(this.hashRequest,response),this.append(this.$refs.pagination),this.filtering()||this.$refs.pagination.querySelectorAll(".btn").forEach(el=>{el.addEventListener("dragover",evt=>{evt.preventDefault()}),el.addEventListener("drop",evt=>{var toPage=parseInt(el.getAttribute("data-page"));if(!isNaN(toPage)&&this.hashRequest.queryParams.get("page")!=toPage){var json=evt.dataTransfer.getData("text"),data=JSON.parse(json),offset=(toPage-1)*this.response.meta.itemsPerPage,n=0,promises=[];for(var item of data)item.position=n+offset,promises.push(this.api.collection.playlistItems.get(item.uuid).update(item)),n++;Promise.all(promises).then(()=>{console.log("playlist: reordered"),this.refresh()})}})})}onItemSelected(evt){var context=new Line_ContextPlaylist(this.api,!1,this.hashRequest.queryParams,this.hashRequest.attributes.playlistId),initialBatch=this.getPlayableItems(evt.detail.item),queue=Line_Queue.instantiate(initialBatch,context);evt.detail.queue=queue}onItemsReordered(evt){var changes=evt.detail.changes,offset=(this.response.meta.page-1)*this.response.meta.itemsPerPage,promises=[];for(var c of changes)c.from+=offset,c.to+=offset,c.item.position=c.to,promises.push(this.api.collection.playlistItems.get(c.item.uuid).update(c.item));Promise.all(promises).then(()=>{console.log("playlist: reordered items")})}}ViewPlaylist.register();const View_ViewPlaylist=ViewPlaylist;class DiscographyItem extends Component_ContextualElement{static elementName="discography-item";__construct(album){super.__construct(),this.album=album}render(){super.render(),this.classList.add("card"),this.classList.add("discography-item");var attributes={title:this.album.artist+" - "+this.album.title};this.album.single?this.subRenderSingle(attributes):this.subRenderAlbum(attributes)}subRenderSingle(attributes){this.subRenderCore("span",attributes),this.$refs.title.createAndAttach("span",{class:"fa fa-hand-pointer-o"}),this.subRenderPlayButton().addEventListener("click",()=>{this.fireEvent("queue:item-selected",{item:{title:this.album.title,artist:this.album.artist}})})}subRenderAlbum(attributes){attributes.href=`#discover:albums?artist=${this.album.artist}&title=${this.album.title}`,this.subRenderCore("a",attributes),this.subRenderPlayButton().addEventListener("click",()=>{this.fireEvent("queue:item-selected",{item:{album:this.album.title,artist:this.album.artist}})})}subRenderPlayButton(){return this.$refs.playButton=this.createAndAttach("button",{},this.create("span",{class:"fa fa-play"}))}subRenderCore(coreElement,attributes){var picture=this.create("picture"),thumbnail=this.create("span",{class:"thumbnail"},picture);return picture.createAndAttach("source",{srcset:this.album.thumbnail||"dist/img/missing-cover-art.webp"}),picture.createAndAttach("img",{src:"dist/img/missing-cover-art.webp",onerror:"this.onerror = null;this.parentNode.children[0].srcset = this.src;"}),this.createAndAttach(coreElement,attributes,[thumbnail,this.$refs.title=this.create("h4",null,[this.album.title])])}getDefaultContextActions(){var item={artist:this.album.artist,album:this.album.title};return{addToPlaylist:{title:"Add to playlist",helpText:"choose a playlist",icon:"fa-plus",onClick:()=>{this.fireEvent("item:intention:add-to-collection",{items:[item]})}},playNext:{title:"Play next",helpText:"play next",icon:"fa-minus",onClick:()=>{this.fireEvent("queue:intention:play-it-next",{item})}}}}}DiscographyItem.register();const Component_DiscographyItem=DiscographyItem;class Album_Album extends Element_CustomElement{static elementName="album-container";__construct(artist,title,api){super.__construct(),this.artist=artist,this.title=title,this.api=api}async render(){this.classList.add(Album_Album.elementName),this.api.discover.albums.get(this.artist,this.title).read().then(response=>{this.subRenderHeader(response),this.subRenderTracks(response)}),this.addEventListener("queue:item-selected",this.onItemSelected.bind(this))}subRenderHeader(response){this.$refs.header=this.createAndAttach("header",null,this.create("h2",null,response.data.title)),this.$refs.buttons=this.$refs.header.createAndAttach("div",{class:"input-group input-group-horizontal"},[this.$refs.playButton=this.create("button",{title:"Play album"},this.create("span",{class:"fa fa-play"})),this.$refs.addButton=this.create("button",{title:"Add all tracks to your collection"},this.create("span",{class:"fa fa-plus"}))]),this.$refs.playButton.addEventListener("click",this.playEntireAlbum.bind(this)),this.$refs.addButton.addEventListener("click",this.addEntireAlbumToCollection.bind(this))}subRenderTracks(response){if(response.data.tracks){var tracks=[];for(var t of response.data.tracks)tracks.push({title:t,artist:response.data.artist,album:response.data.title});this.$refs.playlist=Component_ListOfItems.instantiate(tracks),this.$refs.playlist.classList.add("playlist"),this.append(this.$refs.playlist)}}addEntireAlbumToCollection(){var items=this.getPlayableItems();this.fireEvent("item:intention:add-to-collection",{items})}playEntireAlbum(){var items=this.getPlayableItems();this.fireEvent("queue:item-selected",{item:items})}onItemSelected(evt){var items=this.getPlayableItems(evt.detail.item);evt.detail.item=items}getPlayableItems(beginningWith=null){var initialBatch=this.$refs.playlist.getItems();for(var key in initialBatch)if(initialBatch[key]==beginningWith){initialBatch=initialBatch.slice(key);break}return initialBatch}}Album_Album.register();const Component_Album=Album_Album;class ViewDiscoverAlbums extends BaseView{static elementName="view-discography";async render(){this.classList.add("view-discography");var artist=this.hashRequest.queryParams.get("artist"),title=this.hashRequest.queryParams.get("title");this.api.discover.albums.search(this.hashRequest.queryParams).then(response=>{this.subRenderHeader(),this.subRenderBody(title),this.subRenderDiscographyItems(response,title)}).then(()=>{if(this.$refs.album){var a=Component_Album.instantiate(artist,title,this.api);this.$refs.album.append(a)}})}subRenderHeader(){this.$refs.header=this.createAndAttach("header",{class:"header view-discography__header"},[this.$refs.headerH=this.create("div",{class:"header__header"}),this.$refs.headerB=this.create("div",{class:"header__body"}),this.$refs.headerF=this.create("div",{class:"header__footer"})]),this.$refs.headerH.createAndAttach("h1",null,"Discover albums"),this.$refs.headerB.append(Component_SearchHeader.instantiate(this.hashRequest,"",[{type:"search",name:"artist",placeholder:"Artist",title:"Artist",class:"main"}])),this.$refs.playButton=this.$refs.headerF.createAndAttach("button",{title:"Play all"},this.create("span",{class:"fa fa-play"})),this.$refs.playButton.addEventListener("click",this.playAllAlbuns.bind(this))}subRenderBody(title){this.$refs.body=this.createAndAttach("main",{class:"view-discography__body flexy"}),this.$refs.grid=this.$refs.body.createAndAttach("div",{class:"grid view-discography__releases"}),title&&(this.$refs.album=this.$refs.body.createAndAttach("div",{class:"view-discography__tracks"}))}subRenderDiscographyItems(response,title){var cssClass=title?"col-12 col-sm-6 col-md-4 col-lg-3":"col-6 col-sm-4 col-md-3 col-lg-2";for(var album of response.data)this.$refs.grid.createAndAttach("div",{class:cssClass},Component_DiscographyItem.instantiate(album))}playAllAlbuns(){var items=this.getPlayableItems();this.fireEvent("queue:item-selected",{item:items[0],queue:Line_Queue.instantiate(items,null)})}getPlayableItems(){var items=[];for(var element of this.querySelectorAll(Component_DiscographyItem.elementName))items.push({album:element.album.title,artist:element.album.artist});return items}}ViewDiscoverAlbums.register();const View_ViewDiscoverAlbums=ViewDiscoverAlbums;class ViewSearch extends View_ViewPlaylist{static elementName="view-search";async render(){this.classList.add(ViewSearch.elementName),this.fetch().then(response=>{this.subRenderHeader(response),this.subRenderItems(response),this.subRenderNavigation(response)}),this.addEventListener("queue:item-selected",this.onItemSelected.bind(this))}fetch(){return this.hashRequest.queryParams.isEmpty()?new Promise((r,f)=>r({})):this.api.collection.playlistItems.search(this.hashRequest.queryParams)}subRenderHeader(response){this.$refs.header=this.createAndAttach("header",{class:"header"},[this.$refs.headerH=this.create("div",{class:"header__header"}),this.$refs.headerB=this.create("div",{class:"header__body"}),this.$refs.headerF=this.create("div",{class:"header__footer"})]),this.$refs.headerH.createAndAttach("h1",null,"Search"),this.$refs.headerB.append(Component_SearchHeader.instantiate(this.hashRequest,"",[{type:"search",name:"title",placeholder:"Title",class:"main"},{type:"search",name:"artist",placeholder:"Artist",title:"Artist"},{type:"search",name:"genre",placeholder:"Genre",title:"Genre"},{type:"search",name:"soundtrack",placeholder:"Soundtrack",title:"Soundtrack"}]))}subRenderButtonGroup(){}onItemSelected(evt){var context=new Line_ContextSearch(this.api,!1,this.hashRequest.queryParams),initialBatch=this.getPlayableItems(evt.detail.item),queue=Line_Queue.instantiate(initialBatch,context);evt.detail.queue=queue}}ViewSearch.register();const View_ViewSearch=ViewSearch;class ViewDiscoverArtists extends BaseView{static elementName="view-discover";async render(){this.classList.add(ViewDiscoverArtists.elementName),this.fetch().then(response=>{this.renderHeader(response),this.renderArtists(response)})}fetch(){return this.hashRequest.queryParams.isEmpty()?new Promise((r,f)=>r({data:[]})):this.api.discover.artists.search(this.hashRequest.queryParams)}renderHeader(response){this.$refs.header=this.createAndAttach("header",{class:"header"},[this.$refs.headerH=this.create("div",{class:"header__header"}),this.$refs.headerB=this.create("div",{class:"header__body"}),this.$refs.headerF=this.create("div",{class:"header__footer"})]),this.$refs.headerH.createAndAttach("h1",null,"Discover artist"),this.$refs.headerB.append(Component_SearchHeader.instantiate(this.hashRequest,"Discover artist",[{type:"search",name:"name",placeholder:"Artist",title:"Artist",class:"main"}]))}renderArtists(response){var grid=this.createAndAttach("div",{class:"grid artists"});for(var ar of response.data)grid.createAndAttach("a",{href:`#discover:albums?artist=${ar.name}`,title:ar.name,class:"col-6 col-sm-4 col-md-3 col-lg-2"},[this.create("span",{class:"card"},[ar.thumbnail?this.create("img",{src:ar.thumbnail}):null,this.create("h4",null,[ar.name])])])}}ViewDiscoverArtists.register();const View_ViewDiscoverArtists=ViewDiscoverArtists;class QueueDisplay extends Element_CustomElement{static elementName="queue-display";get isOpen(){return this.classList.contains("is-open")}constructor(){super()}open(){this.classList.add("is-open")}close(){this.classList.remove("is-open")}toggle(){this.isOpen?this.close():this.open()}render(){this.classList.add("queue-display"),this.createAndAttach("div",{class:"queue-display__drawer"},this.$refs.content=this.create("div",{class:"queue-display__content"},[this.$refs.hr=this.create("hr")])),this.addEventListener("list-of-items:reordered",this.onEqueueReordered.bind(this)),this.subRenderHistory(),this.subRenderQueue()}subRenderHistory(){this.$refs.history=Component_ListOfItems.instantiate([]),this.$refs.hr.before(this.$refs.history)}subRenderQueue(){this.$refs.queued=Component_ListOfItems.instantiate([]),this.$refs.queued.setAttribute("reordable",!0),this.$refs.queued.dropIsValid=function(dropEvt){if(!this.draggingElement)return!0;if(0==dropEvt.target.getAncestor("li").index())return!1;var selectedElements=this.getSelectedElements();return!this.extractIndexes(selectedElements).includes(0)},this.$refs.queued.addEventListener("context-menu:actions:invite-alter",this.onContextMenuInviteAlter.bind(this)),this.$refs.queued.addEventListener("queue:item-selected",this.onQueueItemSelected.bind(this)),this.$refs.hr.after(this.$refs.queued)}onContextMenuInviteAlter(evt){var index=evt.target.parentNode.index();evt.detail.actions.removeFromQueue={title:"De-queue",helpText:"Remove from queue",icon:"fa-minus",onClick:()=>{this.queue.removeIndex(index)}},index>1?evt.detail.actions.playNext={title:"Play next",helpText:"Play once current song is finished",icon:"fa-minus",onClick:()=>{this.queue.move(index,1)}}:delete evt.detail.actions.playNext}refresh(queue,history){this.queue=queue,this.history=history,this.refreshQueue(queue),this.refreshHistory(history)}refreshHistory(ar){this.$refs.history.setItems(ar.slice().reverse())}refreshQueue(ar){this.$refs.queued.setItems(ar)}onEqueueReordered(evt){var changes=evt.detail.changes;for(var change of changes)this.queue.move(change.from,change.to)}onQueueItemSelected(evt){var index=evt.target.parentNode.index();0!=index?this.queue.removeIndex(index):evt.stopPropagation()}}QueueDisplay.register();const Element_QueueDisplay=QueueDisplay;class Modal extends Element_CustomElement{static elementName="modal-window";__construct(api){super.__construct(),this.api=api}render(){this.subRenderModal()}subRenderModal(){this.classList.add("modal"),this.createAndAttach("div",{class:"modal-dialog"},[this.create("div",{class:"modal-content"},[this.$refs.header=this.create("div",{class:"modal-header"},["header"]),this.$refs.body=this.create("div",{class:"modal-body"}),this.$refs.footer=this.create("div",{class:"modal-footer"},[this.$refs.closeButton=this.create("button",{class:"btn-danger"},"Close")])])]),this.$refs.closeButton.addEventListener("click",()=>{this.remove()})}}Modal.register();const Modal_Modal=Modal;class ModalAddToPlaylist extends Modal_Modal{static elementName="modal-window-add-to-playlist";__construct(api,items){super.__construct(api),this.items=items}render(){super.render(),this.$refs.header.innerHTML="Add to playlist",this.api.collection.playlists.list().then(response=>{if(response.data)for(var playlist of(this.$refs.body.clear(),this.$refs.buttonGroup=this.$refs.body.createAndAttach("div",{class:"input-group input-group-vertical"}),response.data))this.$refs.buttonGroup.createAndAttach("button",{"data-playlist":playlist.id},playlist.title).addEventListener("click",this.onPlaylistChoosen.bind(this))})}onPlaylistChoosen(evt){var playlist=evt.target.getAttribute("data-playlist");this.api.collection.playlistItems.addMultiple(this.items,playlist).then(()=>{alert("Item(s) added!!"),this.remove()})}}ModalAddToPlaylist.register();const Modal_ModalAddToPlaylist=ModalAddToPlaylist;class Messages extends Element_CustomElement{static elementName="messages-container";render(){this.classList.add("messages"),this.successes=this.createAndAttach("ul",{class:"successes hidden"}),this.warnings=this.createAndAttach("ul",{class:"warnings hidden"}),this.errors=this.createAndAttach("ul",{class:"errors hidden"})}messages(messages){if(this.successes.clear().classList.add("hidden"),this.warnings.clear().classList.add("hidden"),this.errors.clear().classList.add("hidden"),messages.successes)for(var m of(this.successes.classList.remove("hidden"),messages.successes))this.successes.createAndAttach("li",null,m.title);if(messages.errors)for(var m of(this.errors.classList.remove("hidden"),messages.errors))this.errors.createAndAttach("li",null,m.title);if(messages.warnings)for(var m of(this.warnings.classList.remove("hidden"),messages.warnings))this.warnings.createAndAttach("li",null,m.title)}}Messages.register();const Component_Messages=Messages;class TextField extends Element_CustomElement{static elementName="text-field";__construct(name,label,value,placeholder=""){super.__construct(),this.name=name,this.label=label,this.value=value,this.placeholder=placeholder}render(){var id=Math.floor(1e4*Math.random());this.classList.add("form-group"),this.createAndAttach("label",{class:"label col-sm-2",for:id},this.label),this.$refs.input=this.createAndAttach("input",{type:"text",class:"col-sm-10",id,name:this.name,value:this.value,placeholder:this.placeholder})}setValue(value){this.$refs.input.value=value}}TextField.register();const Form_TextField=TextField;class TextArea extends Element_CustomElement{static elementName="text-area-field";__construct(name,label,value,placeholder=""){super.__construct(),this.name=name,this.label=label,this.value=value,this.placeholder=placeholder}render(){var id=Math.floor(1e4*Math.random());this.classList.add("form-group"),this.createAndAttach("label",{class:"label col-sm-2",for:id},this.label),this.$refs.input=this.createAndAttach("textarea",{class:"col-sm-10",id,name:this.name,placeholder:this.placeholder}),this.$refs.input.value=this.value}setValue(value){this.$refs.input.value=value}}TextArea.register();const Form_TextArea=TextArea;class MultipleTextField extends Element_CustomElement{static elementName="multiple-text-field";__construct(name,label,value,placeholder="",addButton="Add +"){super.__construct(),this.name=name,this.label=label,this.value=value,this.placeholder=placeholder,this.addButton=addButton}render(){this.classList.add("form-group"),this.createAndAttach("span",{class:"label col-sm-2"},this.label),this.createAndAttach("div",{class:"col-sm-10"},[this.$refs.body=this.create("div",{class:"input-group input-group-vertical"}),this.$refs.plusButton=this.create("small",{},this.addButton)]),this.$refs.plusButton.addEventListener("click",this.addBlank.bind(this)),this.setValue(this.value)}setValue(value){this.$refs.body.clear(),this.addValues(value)}addValues(value){for(var v of value=Array.isArray(value)?value:[value])this.add(v)}add(value=""){this.$refs.body.createAndAttach("input",{type:"text",placeholder:this.placeholder,class:"col-sm-12",name:this.name,value})}addBlank(){this.add("")}}MultipleTextField.register();const Form_MultipleTextField=MultipleTextField;class FormElent extends Element_CustomElement{static elementName="form-element";render(){this.$refs.form=this.createAndAttach("form",{class:"vertical",method:"post",enctype:"multipart/form-data"})}setValue(name,value){return this.$refs[name]||console.error("No input named "+name),this.$refs[name].setValue(value),this}getForm(){return this.$refs.form}addHidden(name,value){return this.$refs[name]=this.$refs.form.createAndAttach("input",{type:"hidden",name,value})}addTextField(name,label,value,placeholder=""){return this.$refs[name]=this.$refs.form.attach(Form_TextField.instantiate(name,label,value,placeholder))}addTextArea(name,label,value,placeholder=""){return this.$refs[name]=this.$refs.form.attach(Form_TextArea.instantiate(name,label,value,placeholder))}addMultiTextField(name,label,value,placeholder="",addButton="Add +"){return this.$refs[name]=this.$refs.form.attach(Form_MultipleTextField.instantiate(name,label,value,placeholder,addButton))}addSubmitButton(name="submit",label="Submit"){return this.$refs[name]=this.$refs.form.createAndAttach("div",{class:"form-group"},[this.create("input",{type:"submit",name,value:label,class:"col-12 btn-main"})])}}FormElent.register();const Form_FormElent=FormElent;class ModalForm extends Modal_Modal{static elementName="modal-form";render(){super.subRenderModal(),this.subRenderHeader(),this.subRenderForm(),this.subRenderSubmitListener()}subRenderHeader(){this.$refs.messages=this.$refs.body.attach(Component_Messages.instantiate())}subRenderForm(){this.$refs.form=this.$refs.body.attach(Form_FormElent.instantiate()),this.$refs.form.addTextField("title","Title",""),this.$refs.form.addSubmitButton("save","Save")}subRenderSubmitListener(){this.$refs.form.addEventListener("submit",evt=>{console.log("FORM SUBMITTED")})}onResponse(response){this.$refs.messages.messages(response),response.successes&&response.successes.length&&(alert("FINISHED!"),this.remove())}}ModalForm.register();const Modal_ModalForm=ModalForm;class ModalItemAdd extends Modal_ModalForm{static elementName="modal-add-item";__construct(api,playlistId){super.__construct(api),this.playlistId=playlistId}subRenderHeader(){super.subRenderHeader(),this.$refs.header.innerHTML="Add item"}subRenderForm(){this.$refs.form=this.$refs.body.attach(Form_FormElent.instantiate()),this.$refs.form.addTextField("title","Title",""),this.$refs.form.addTextField("album","Album",""),this.$refs.form.addMultiTextField("artist[]","Artist",[""],"Artist","Add artist"),this.$refs.form.addMultiTextField("featuring[]","Artist",[""],"Featuring","Add featured artist"),this.$refs.form.addTextField("cover","Cover",""),this.$refs.form.addMultiTextField("soundtrack[]","Soundtrack",[""],"Soundtrack","Add soundtrack"),this.$refs.form.addMultiTextField("genre[]","Genre",[""],"Genre","Add genre"),this.playlistId&&this.$refs.form.addHidden("playlist",this.playlistId||""),this.$refs.form.addSubmitButton("save","Save")}subRenderSubmitListener(){this.$refs.form.addEventListener("submit",evt=>{evt.preventDefault(),this.api.collection.playlistItems.create(this.$refs.form.getForm()).then(this.onResponse.bind(this),this.onResponse.bind(this))})}onResponse(response){this.$refs.messages.messages(response),response.successes&&response.successes.length&&(alert("Added!"),this.fireEvent("item:added"),this.remove())}}ModalItemAdd.register();const Modal_ModalItemAdd=ModalItemAdd;class ModalItemEdit extends Modal_ModalItemAdd{static elementName="modal-edit-item";__construct(api,uuid){super.__construct(api),this.uuid=uuid}render(){super.subRenderModal(),this.api.collection.playlistItems.get(this.uuid).read().then(response=>{this.subRenderHeader(),this.subRenderForm(response),this.subRenderSubmitListener()})}subRenderHeader(){super.subRenderHeader(),this.$refs.header.innerHTML="Edit item"}subRenderForm(response){super.subRenderForm(),this.$refs.form.setValue("title",response.data.title||"").setValue("artist[]",response.data.artist||[""]).setValue("featuring[]",response.data.featuring||[""]).setValue("cover",response.data.cover||"").setValue("album",response.data.album||"").setValue("soundtrack[]",response.data.soundtrack||[""]).setValue("genre[]",response.data.genre||[""])}subRenderSubmitListener(){this.$refs.form.addEventListener("submit",evt=>{evt.preventDefault(),this.api.collection.playlistItems.get(this.uuid).update(this.$refs.form.getForm()).then(this.onResponse.bind(this),this.onResponse.bind(this))})}onResponse(response){this.$refs.messages.messages(response),response.successes&&response.successes.length&&(alert("Edited!"),this.fireEvent("item:updated"),this.remove())}}ModalItemEdit.register();const Modal_ModalItemEdit=ModalItemEdit;class ModalPlaylistAdd extends Modal_ModalItemAdd{static elementName="modal-add-playlist";subRenderHeader(){super.subRenderHeader(),this.$refs.header.innerHTML="Edit playlist"}subRenderForm(){this.$refs.form=this.$refs.body.attach(Form_FormElent.instantiate()),this.$refs.form.addTextField("title","Title",""),this.$refs.form.addTextArea("description","Descrio",""),this.$refs.form.addSubmitButton("save","Save")}subRenderSubmitListener(){this.$refs.form.addEventListener("submit",evt=>{evt.preventDefault(),this.api.collection.playlists.create(this.$refs.form.getForm()).then(this.onResponse.bind(this),this.onResponse.bind(this))})}onResponse(response){this.$refs.messages.messages(response),response.successes&&response.successes.length&&(alert("Added!"),this.fireEvent("playlist:added"),this.remove())}}ModalPlaylistAdd.register();const Modal_ModalPlaylistAdd=ModalPlaylistAdd;class ModalPlaylistEdit extends Modal_ModalPlaylistAdd{static elementName="modal-edit-playlist";__construct(api,playlistId){super.__construct(api),this.playlistId=playlistId}subRenderHeader(){super.subRenderHeader(),this.$refs.header.innerHTML="Edit playlist"}render(){super.subRenderModal(),this.api.collection.playlists.get(this.playlistId).read().then(response=>{this.subRenderHeader(),this.subRenderForm(response),this.subRenderSubmitListener()})}subRenderForm(response){super.subRenderForm(),this.$refs.form.setValue("title",response.data.title||"").setValue("description",response.data.description||"")}subRenderSubmitListener(){this.$refs.form.addEventListener("submit",evt=>{evt.preventDefault(),this.api.collection.playlists.get(this.playlistId).update(this.$refs.form.getForm()).then(this.onResponse.bind(this),this.onResponse.bind(this))})}onResponse(response){this.$refs.messages.messages(response),response.successes&&response.successes.length&&(alert("Edited!"),this.fireEvent("playlist:updated"),this.remove())}}ModalPlaylistEdit.register();const Modal_ModalPlaylistEdit=ModalPlaylistEdit;const Line_History=class History extends Array{add(item){Array.isArray(item)?this.addMultiple(item):this.addSingle(item)}get theMostRecent(){return this.length?this[0]:null}get theOldest(){return this.length?this[this.length-1]:null}rewind(length=1){var first=this.splice(0,length);return this.updatedCallback(),first}addMultiple(items){this.splice(0,0,...items),console.log("History: multiple items added"),this.updatedCallback()}addSingle(item){this.splice(0,0,item),console.log("History: single item added"),this.updatedCallback()}clear(){this.splice(0,this.length),this.updatedCallback()}updatedCallback(){console.log("history updated")}};var Instantiator=__webpack_require__(901),Instantiator_default=__webpack_require__.n(Instantiator);const Line_ContextFactory=class ContextFactory{constructor(api){this.api=api}instantiate(dependencies){if(null==dependencies)return null;dependencies.api=this.api;var classe=null;switch(dependencies.id){case Line_ContextPlaylist.id():classe=Line_ContextPlaylist;break;case Line_ContextSearch.id():classe=Line_ContextSearch}return classe?new(Instantiator_default())(classe,dependencies).instantiate():null}};class HashRequest{constructor(path,queryParams,attributes={},meta={}){this.path=path,this.queryParams="string"==typeof queryParams?new URLSearchParams(queryParams):queryParams,this.attributes=attributes,this.meta=meta}setAttributes(attributes){return this.attributes=attributes,this}setAttribute(attrName,value){return this.attributes[attrName]=value,this}getAttribute(attrName,defaultValue=null){return this.attributes[attrName]||defaultValue}matchesHtmlElement(){var selector=this.path.replace(/^\//,"#"),selected=!1;try{selected=document.querySelector(selector)}catch{selected=!1}return!!selected}static createFromAnchor(a){var href=a.getAttribute("href"),title=a.getAttribute("title")||null,request=HashRequest.createFromUrl(href);return request?(request.meta.title=title,request):null}static createFromForm(form){var action=form.getAttribute("action"),title=form.getAttribute("title")||null,request=HashRequest.createFromUrl(action);if(!request)return null;request.meta.title=title;var formData=new FormData(form),submitedData=new URLSearchParams(formData);return HashRequest.mergeUrlSearchParams(request.queryParams,submitedData),request}static mergeUrlSearchParams(original,additions){for(let[key,val]of additions.entries())key.indexOf("[]")>=0&&original.has(key)?original.append(key,val):original.set(key,val)}static createFromUrl(urlString){var url=new URL(urlString,"https://"+window.location.host);return url.hash?HashRequest.createFromHash(url.hash,url.host):null}static createFromHash(hashString,host=window.location.host){var path=hashString.replace(/^#\/?/,"/"),local=new URL(path,"https://"+window.location.host);return host!=window.location.host?null:new HashRequest(local.pathname,local.searchParams)}}const Routing_HashRequest=HashRequest;const Routing_Route=class Route{constructor(patterns,callback){this.patterns=Array.isArray(patterns)?patterns:[patterns],this.callback=callback}callIt(request){var pattern=this.getMatchingPattern(request.path),attributes=this.getAttributesFromPath(request.path,pattern);return request.setAttributes(attributes),this.instantiateElement(request)}instantiateElement(request){var element;return"string"==typeof this.callback?(element=document.createElement(this.callback)).setHashRequest&&element.setHashRequest(request):"function"==typeof this.callback&&(element=this.callback.apply(this,[request])),element.request=request,element}doesItMatchTheRequest(request){return!(!request.path||!this.getMatchingPattern(request.path))}getMatchingPattern(path){for(var pattern of this.patterns)if(path.match(pattern))return pattern;return null}getAttributesFromPath(path,pattern){return pattern.exec(path).groups||{}}};const Routing_RouteCollection=class RouteCollection{constructor(){this.routes=[]}call(route,request){return route.callIt(request)}getMatchingRoute(request){for(var route of this.routes)if(route.doesItMatchTheRequest(request))return route;return null}addRoute(route){return this.routes.push(route),this}createRoute(pattern,callback){return this.addRoute(new Routing_Route(pattern,callback))}};class TabPanel extends HTMLElement{constructor(){super(),this.tabId=null,this.history=[],this.historyIndex=-1,this.routeCollection=null,this.ctrlKey=!1,this.rendered=!1}setRouteCollection(routeCollection){return this.routeCollection=routeCollection,this}setTabId(tabId){this.tabId=tabId,this.rendered&&this.setAttribute("id",tabId)}getTitle(){if(this.children.length&&this.children[0].getTitle)return this.children[0].getTitle();if(!this.history.length)return"New tab";var present=this.history[this.historyIndex]||null;return present&&present.meta&&present.meta.title?present.meta.title:"New tab"}focus(){return this.classList.add("tabbed-router__tab-panel--focused"),this}unfocus(){return this.classList.remove("tabbed-router__tab-panel--focused"),this}canGoBackwards(){return this.historyIndex>0}canGoForwards(){return this.historyIndex<this.history.length-1}backwards(){this.canGoBackwards()&&(this.historyIndex--,this.request(this.history[this.historyIndex]))}forwards(){this.canGoForwards()&&(this.historyIndex++,this.request(this.history[this.historyIndex]))}goTo(request){this.history=this.history.slice(0,this.historyIndex+1),this.history.push(request),this.request(request),this.historyIndex++}access(href){var request=Routing_HashRequest.createFromHash(href);this.goTo(request)}connectedCallback(){this.rendered||(this.render(),this.rendered=!0)}render(){this.classList.add("tabbed-router__tab-panel"),this.setAttribute("id",this.tabId),this.addEventListener("click",this.onAnchorClicked.bind(this)),this.addEventListener("submit",this.onFormSubmitted.bind(this)),this.addEventListener("keydown",this.onKeyDown.bind(this)),this.addEventListener("keyup",this.onKeyUp.bind(this));this.observer=new MutationObserver(this.observer.bind(this)),this.observer.observe(this,{childList:!0,attributes:!1,subtree:!0}),this.updatedEvent()}observer(){this.updatedEvent()}updatedEvent(request=null){var event=new CustomEvent("tabbed-router:tab-updated",{bubbles:!0,detail:{tab:this,request}});this.dispatchEvent(event)}onKeyDown(evt){this.ctrlKey=evt.ctrlKey}onKeyUp(evt){this.ctrlKey=evt.ctrlKey}onAnchorClicked(evt){var a=TabPanel.getAnchor(evt.target);if(a&&!(evt.ctrlKey||"_blank"==a.getAttribute("target"))){evt.tabbedRouterAvaliated=!0;var request=Routing_HashRequest.createFromAnchor(a);0==request||request.matchesHtmlElement()||(evt.stopPropagation(),evt.preventDefault(),this.goTo(request))}}onFormSubmitted(evt){var form=evt.target;if(!(this.ctrlKey||"_blank"==form.getAttribute("target"))){evt.tabbedRouterAvaliated=!0;var request=Routing_HashRequest.createFromForm(form);0==request||"get"!=form.method||request.matchesHtmlElement()||(evt.stopPropagation(),evt.preventDefault(),this.goTo(request))}}request(request){var route=this.routeCollection.getMatchingRoute(request),element=route?route.callIt(request):this.nothingFoundCallback(request);element?(this.stageElement(element),this.updatedEvent(request)):console.error("Route failed in returning an element.")}stageElement(element){this.clearStage(),this.addToStage(element)}clearStage(){this.querySelectorAll(":scope > *").forEach(e=>{e.remove()})}addToStage(element){this.append(element)}nothingFoundCallback(request){var defaultElement=document.createElement("div");return defaultElement.innerHTML="Nothing found",request.meta.title=request.meta.title?request.meta.title+" ( not found )":"not found",defaultElement.getTitle=function(){return"nothing found"},defaultElement}static getAnchor(element){if(element instanceof HTMLAnchorElement)return element;do{element=element.parentNode}while(element.parentNode&&!(element instanceof HTMLAnchorElement));return element&&element instanceof HTMLAnchorElement?element:null}}const Elements_TabPanel=TabPanel;class TabControls extends HTMLElement{constructor(){super(),this.$refs={},this.rendered=!1}connectedCallback(){this.rendered||(this.render(),this.rendered=!0)}render(){this.classList.add("tabbed-router__tab-manager__controls"),this.$refs.backwardButton=document.createElement("button"),this.$refs.backwardButton.title="Click to go back",this.$refs.backwardButton.classList.add("tabbed-router__tab-manager__backwards-button"),this.append(this.$refs.backwardButton),this.$refs.forwardButton=document.createElement("button"),this.$refs.forwardButton.title="Click to go forward",this.$refs.forwardButton.classList.add("tabbed-router__tab-manager__forwards-button"),this.append(this.$refs.forwardButton),this.$refs.backwardButton.addEventListener("click",()=>{var event=new CustomEvent("tabbed-router:request-backwards",{bubbles:!0});this.dispatchEvent(event)}),this.$refs.forwardButton.addEventListener("click",()=>{var event=new CustomEvent("tabbed-router:request-forwards",{bubbles:!0});this.dispatchEvent(event)}),this.parentNode.parentNode.addEventListener("tabbed-router:tab-focused",this.onTabFocused.bind(this)),this.parentNode.parentNode.addEventListener("tabbed-router:tab-updated",this.onTabUpdated.bind(this))}onTabUpdated(evt){this.onTabFocused(evt)}onTabFocused(evt){var tab=evt.detail.tab;tab.canGoForwards()?this.$refs.forwardButton.removeAttribute("disabled"):this.$refs.forwardButton.setAttribute("disabled","disabled"),tab.canGoBackwards()?this.$refs.backwardButton.removeAttribute("disabled"):this.$refs.backwardButton.setAttribute("disabled","disabled")}}const Elements_TabControls=TabControls;class TabButton extends HTMLElement{constructor(){super(),this.$refs={},this.label="",this.tabId="",this.rendered=!1}setLabel(label){return this.label=label,this.rendered&&(this.$refs.label.innerHTML=label),this}focus(){return this.classList.add("tabbed-router__tab-button--focused"),this}unfocus(){return this.classList.remove("tabbed-router__tab-button--focused"),this}setTabId(tabId){return this.tabId=tabId,this}connectedCallback(){this.rendered||(this.render(),this.rendered=!0)}render(){this.classList.add("tabbed-router__tab-button"),this.$refs.label=document.createElement("span"),this.$refs.label.innerHTML=this.label,this.append(this.$refs.label),this.$refs.closeBtn=document.createElement("button"),this.$refs.closeBtn.setAttribute("title","close tab"),this.append(this.$refs.closeBtn),this.addEventListener("click",this.onClick.bind(this)),this.$refs.closeBtn.addEventListener("click",this.onCloseBtnClicked.bind(this))}onClick(){var options={bubbles:!0,detail:this.tabId},event=new CustomEvent("tabbed-router:request-focus",options);this.dispatchEvent(event)}onCloseBtnClicked(evt){evt.stopPropagation(),evt.preventDefault();var options={bubbles:!0,detail:this.tabId},event=new CustomEvent("tabbed-router:request-closing",options);this.dispatchEvent(event)}}const Elements_TabButton=TabButton;class TabsBar extends HTMLElement{constructor(){super(),this.buttonCount=0,this.$refs={buttons:{}},this.rendered=!1}connectedCallback(){this.rendered||(this.render(),this.rendered=!0)}render(){this.classList.add("tabbed-router__tab-manager__tabs-bar"),this.parentNode.parentNode.addEventListener("tabbed-router:tab-updated",this.onTabUpdated.bind(this)),this.parentNode.parentNode.addEventListener("tabbed-router:tab-focused",this.onTabFocused.bind(this)),this.parentNode.parentNode.addEventListener("tabbed-router:tab-closed",this.onTabClosed.bind(this))}createButton(tabId,label="new tab"){var button=new Elements_TabButton;return button.setTabId(tabId),button.setLabel(label),this.append(button),this.$refs.buttons[tabId]=button,this.buttonCount++,button}getButton(tabId){return this.$refs.buttons[tabId]||null}getButtons(){return Object.values(this.$refs.buttons)}focusButton(tabId){var button=this.getButton(tabId);if(!button)throw`Tab ${tabId} not found`;for(var tb of this.getButtons())tb.tabId==tabId?tb.focus():tb.unfocus();return button}onTabFocused(evt){var tabId=evt.detail.tab.tabId;this.focusButton(tabId)}onTabClosed(evt){var tabId=evt.detail.tab.tabId;this.$refs.buttons[tabId].remove(),delete this.$refs.buttons[tabId],this.buttonCount--}onTabUpdated(evt){var tab,tabId,button;tabId=(tab=evt.detail.tab).tabId,(button=this.getButton(tabId))?button.setLabel(tab.getTitle()):button=this.createButton(tabId,tab.getTitle()),1==this.buttonCount&&this.focusButton(tabId)}}const Elements_TabsBar=TabsBar;class TabManager extends HTMLElement{constructor(){super(),this.$refs={tabs:{}},this.tabCount=0,this.rendered=!1,this.focusedTabId=null,this.routeCollection=null,this.ctrlKey=!1}setRouteCollection(routeCollection){return this.routeCollection=routeCollection,this}generateNewTabId(){var id;do{id="tab-"+Math.floor(1e3*Math.random())}while(this.$refs.tabs[id]);return id}backwards(){var tab;(tab=this.getFocusedTab())&&tab.backwards()}forwards(){var tab;(tab=this.getFocusedTab())&&tab.forwards()}focusTab(tabId){var tab=this.getTab(tabId);if(!tab)throw`Tab ${tabId} not found`;for(var tb of(this.focusedTabId=tabId,this.getTabs()))tb.tabId==tabId?tb.focus():tb.unfocus();return this.fireEvent("tabbed-router:tab-focused",!0,{tab}),tab}createTab(tabId,focus=!0){var newTab=new Elements_TabPanel;return this.setTab(tabId,newTab),focus&&this.focusTab(tabId),newTab}getTabs(){return Object.values(this.$refs.tabs)}getTab(tabId){return this.$refs.tabs[tabId]||null}getFocusedTab(){return this.$refs.tabs[this.focusedTabId]||null}setTab(tabId,tabPanel){if(this.$refs.tabs[tabId])throw"Tab {tabId} is already set";tabPanel.setRouteCollection(this.routeCollection),tabPanel.setTabId(tabId),this.$refs.tabs[tabId]=tabPanel,this.rendered&&this.attachTab(tabId)}removeTab(tabId){var tabPanel;return this.$refs.tabs[tabId]?(tabPanel=this.$refs.tabs[tabId],this.rendered&&this.detachTab(tabId),this.fireEvent("tabbed-router:tab-closed",!0,{tab:tabPanel}),tabPanel):null}connectedCallback(){this.rendered||(this.render(),this.rendered=!0)}render(){for(var tabId in this.classList.add("tabbed-router__tab-manager"),this.subRenderHeader(),this.subRenderPanes(),this.$refs.tabs)this.attachTab(tabId);document.addEventListener("click",this.onAnchorClicked.bind(this)),document.addEventListener("submit",this.onFormSubmitted.bind(this)),document.addEventListener("keydown",this.onKeyDown.bind(this)),document.addEventListener("keyup",this.onKeyUp.bind(this)),this.addEventListener("tabbed-router:request-closing",this.onRequestToCloseTab.bind(this)),this.addEventListener("tabbed-router:request-focus",this.onRequestFocus.bind(this)),this.addEventListener("tabbed-router:request-backwards",this.onRequestBackwards.bind(this)),this.addEventListener("tabbed-router:request-forwards",this.onRequestForwards.bind(this))}subRenderHeader(){this.$refs.header=document.createElement("div"),this.$refs.header.classList.add("tabbed-router__tab-manager__header"),this.append(this.$refs.header),this.$refs.controls=new Elements_TabControls,this.$refs.header.append(this.$refs.controls),this.$refs.tabLinks=new Elements_TabsBar,this.$refs.header.append(this.$refs.tabLinks)}subRenderPanes(){this.$refs.tabPanels=document.createElement("div"),this.$refs.tabPanels.classList.add("tabbed-router__tab-manager__tab-panels"),this.append(this.$refs.tabPanels)}onRequestFocus(evt){var tabId=evt.detail;this.focusTab(tabId)}onRequestBackwards(evt){this.backwards()}onRequestForwards(evt){this.forwards()}onRequestToCloseTab(evt){if(!(this.tabCount<=1)){var tabId=evt.detail;if(tabId==this.focusedTabId){var newFocus=(this.$refs.tabLinks.getButton(tabId).previousSibling||this.$refs.tabLinks.getButton(tabId).nextSibling).tabId;this.focusTab(newFocus)}this.removeTab(tabId)}}onKeyDown(evt){this.ctrlKey=evt.ctrlKey}onKeyUp(evt){this.ctrlKey=evt.ctrlKey}onAnchorClicked(evt){if(!evt.tabbedRouterAvaliated){var a=Elements_TabPanel.getAnchor(evt.target);if(a){var request=Routing_HashRequest.createFromAnchor(a);if(0!=request&&!request.matchesHtmlElement())if(evt.stopPropagation(),evt.preventDefault(),evt.ctrlKey)this.openInNewTab(request,!1);else"_blank"==(a.getAttribute("target")||"self")?this.openInNewTab(request,!0):this.$refs.tabs[this.focusedTabId].goTo(request)}}}onFormSubmitted(evt){if(!evt.tabbedRouterAvaliated){var form=evt.target;evt.tabbedRouterAvaliated=!0;var request=Routing_HashRequest.createFromForm(form);if(0!=request&&"get"==form.method&&!request.matchesHtmlElement())if(evt.stopPropagation(),evt.preventDefault(),this.ctrlKey)this.openInNewTab(request,!1);else"_blank"==(form.getAttribute("target")||"self")?this.openInNewTab(request,!0):this.$refs.tabs[this.focusedTabId].goTo(request)}}openInNewTab(request,focus=!1){var tabId=this.generateNewTabId(),tab=this.createTab(tabId,focus);return tab.goTo(request),tab}attachTab(tabId){var tab=this.$refs.tabs[tabId];return this.$refs.tabPanels.append(tab),this.tabCount++,tab}detachTab(tabId){var tab=this.$refs.tabs[tabId];return tab.remove(),delete this.$refs.tabs[tabId],this.tabCount--,tab}fireEvent(eventName,bubbles=!0,detail={}){var event=new CustomEvent(eventName,{bubbles,detail});this.dispatchEvent(event)}}const tabbed_router=TabManager;class Serialization{static serialize(arbitraryData){return"function"==typeof arbitraryData.serialize?arbitraryData.serialize():Serialization.serializeWhateverThisIs(arbitraryData)}static serializeWhateverThisIs(arbitraryData){return arbitraryData.constructor.name===Routing_HashRequest.name?{path:arbitraryData.path,queryParams:arbitraryData.queryParams?arbitraryData.queryParams.toString():"",attributes:arbitraryData.attributes,meta:arbitraryData.meta}:"object"==typeof arbitraryData?arbitraryData:null}}const Helper_Serialization=Serialization;customElements.define("tab-manager",tabbed_router),customElements.define("tab-panel",Elements_TabPanel),customElements.define("tab-link",Elements_TabButton),customElements.define("tab-links",Elements_TabsBar),customElements.define("tab-controls",Elements_TabControls);class App extends Element_CustomElement{static elementName="the-app";__construct(api){super.__construct(),this.api=api,this.routeCollection=this.instantiateRouteCollection(api),this.state=new State_State("showrunner.state"),this.navigationState=new State_State("navigation.state"),this.contextFactory=new Line_ContextFactory(api),this.setHistory(this.loadHistory());var queue=this.loadQueue();this.isShuffleOn()&&!queue.isShuffled()?queue.shuffle():!this.isShuffleOn()&&queue.isShuffled()&&queue.unshuffle(),this.setQueue(this.loadQueue()),this.updateReproductionTray()}saveHistory(history){this.state.set("history",history)}loadHistory(){var history=new Line_History;if(!this.state.get("history"))return history;var items=this.state.get("history");return null==items||0==items.length||history.add(items),history}saveQueue(queue){queue.context&&this.saveQueueContext(queue.context),this.state.set("queue",queue)}loadQueue(){if(!this.state.get("queue"))return Line_Queue.instantiate([],null);var context=this.loadQueueContext(),items=this.state.get("queue");return Line_Queue.instantiate(items,context)}saveQueueContext(context){this.state.set("queueContext",context.serialize())}loadQueueContext(){if(!this.state.get("queueContext"))return null;var c=this.state.get("queueContext");return this.contextFactory.instantiate(c)}render(){this.classList.add("app"),this.$refs.stage=new tabbed_router,this.$refs.stage.classList.add("app__stage"),this.$refs.stage.setAttribute("id","stage"),this.$refs.stage.setRouteCollection(this.routeCollection),this.$refs.middle=this.createAndAttach("div",{class:"app__middle"},[this.$refs.navMenu=Navigation_AppNavigation.instantiate(this.api),this.$refs.stage,this.$refs.queueDisplay=Element_QueueDisplay.instantiate()]),this.$refs.footer=this.createAndAttach("div",{class:"app__footer"},[this.$refs.controls=Component_ReproductionControls.instantiate(this.api,null,null,null,this.isShuffleOn())]),this.restoreTabs()||this.openHomePage(),this.addEventListener("queue:item-selected",this.onItemSelected.bind(this)),this.addEventListener("playable:ended",this.onPlayerEnded.bind(this)),this.addEventListener("player:intention:toggle-shuffle",this.toggleShuffle.bind(this)),this.addEventListener("queue:intention:forward",this.forwardTheQueue.bind(this)),this.addEventListener("queue:intention:backward",this.rewindTheQueue.bind(this)),this.addEventListener("queue:intention:jump",this.onJumpLine.bind(this)),this.addEventListener("queue:intention:play-it-next",this.onPlayNext.bind(this)),this.addEventListener("tabbed-router:tab-updated",this.onNavigationUpdate.bind(this)),this.addEventListener("playlist:added",()=>{this.$refs.navMenu.render()}),this.addEventListener("playlist:updated",()=>{this.$refs.navMenu.render()}),this.addEventListener("item:intention:add-to-collection",evt=>{var modal=Modal_ModalAddToPlaylist.instantiate(this.api,evt.detail.items);this.append(modal)}),this.addEventListener("playlist:intention:compose-new-item",evt=>{var modal=Modal_ModalItemAdd.instantiate(this.api,evt.detail.playlistId);this.append(modal)}),this.addEventListener("item:intention:edit",evt=>{var modal=Modal_ModalItemEdit.instantiate(this.api,evt.detail.uuid);this.append(modal)}),this.addEventListener("item:intention:delete",evt=>{confirm("Are you sure you want to remove it from your collection ?")&&(this.api.collection.playlistItems.get(evt.detail.uuid).delete(),evt.target.remove())}),this.addEventListener("collection:intention:download",evt=>{this.api.collection.playlists.downloadAll()}),this.addEventListener("collection:intention:compose-new-playlist",evt=>{var modal=Modal_ModalPlaylistAdd.instantiate(this.api);this.append(modal)}),this.addEventListener("playlist:intention:edit",evt=>{var modal=Modal_ModalPlaylistEdit.instantiate(this.api,evt.detail.playlistId);this.append(modal)}),this.addEventListener("playlist:intention:delete",evt=>{confirm("Are you sure you want to delete the playlist ?")&&(this.api.collection.playlists.get(evt.detail.playlistId).delete().then(()=>{this.$refs.navMenu.render()}),window.location.hash="#home")}),this.addEventListener("gui:summon-queue",()=>{this.$refs.queueDisplay.toggle()}),this.queue.length&&this.setupItem(this.queue[0],!1),this.updateReproductionTray()}instantiateRouteCollection(api){var collection=new Routing_RouteCollection;return collection.createRoute([/^$/,/home$/],function(request){return View_ViewWelcome.instantiate(request,api)}).createRoute(/playlist:(?<playlistId>[\w\d\-]+)$/,function(request){return View_ViewPlaylist.instantiate(request,api)}).createRoute(/search/,function(request){return View_ViewSearch.instantiate(request,api)}).createRoute(/discover:artist/,function(request){return View_ViewDiscoverArtists.instantiate(request,api)}).createRoute(/discover:albums$/,function(request){return View_ViewDiscoverAlbums.instantiate(request,api)}),collection}async onJumpLine(evt){var{from,to}=evt.detail,target=this.queue.move(from,to);0==to&&this.playItem(target)}async onPlayerEnded(evt){return console.log("-------------------------------"),console.log("Show runner: song ended, next."),this.advanceTheQueue()}isShuffleOn(){return 1==this.state.get("shuffle")}toggleShuffle(evt){this.isShuffleOn()?this.turnShuffleOff():this.turnShuffleOn()}turnShuffleOff(){this.state.set("shuffle",0),this.$refs.controls.turnShuffleOff(),this.queue&&(this.queue.unshuffle(),this.saveQueue(this.queue))}turnShuffleOn(){this.state.set("shuffle",1),this.$refs.controls.turnShuffleOn(),this.queue&&(this.queue.shuffle(),this.saveQueue(this.queue))}onPlayNext(evt){var{item}=evt.detail;0==this.queue.length?this.playItem(item):this.queue.jump(item,1)}async stopAndBeginThisNewQueue(queue){var oldQueue=this.queue;return oldQueue.front&&this.history.add(oldQueue.front),this.isShuffleOn()&&queue.shuffle(!0),this.setQueue(queue),this.saveQueue(queue),this.playItem(this.queue.front)}setHistory(history){this.history=history,this.history.updatedCallback=()=>{var resume=this.history.slice(0,30);this.saveHistory(resume),this.updateReproductionTray()},this.updateReproductionTray()}setQueue(queue){this.queue=queue,queue.length<=1&&queue.fetchMore(),this.queue.updatedCallback=()=>{this.saveQueue(queue),this.updateReproductionTray()},this.updateReproductionTray()}updateReproductionTray(){this.$refs.queueDisplay&&this.$refs.queueDisplay.refresh(this.queue,this.history)}async rewindTheQueue(evt){if(this.history.length){console.log("-------------------------------"),console.log("Show runner: rewinding queue.");var previous=this.history.rewind(1)[0];return this.queue.dropIn(previous),this.playItem(previous)}}async forwardTheQueue(evt){return console.log("-------------------------------"),console.log("Show runner: song skipped, next."),this.advanceTheQueue()}async advanceTheQueue(){return this.queue.getNextInLine().then(next=>{var current=this.queue.dequeue();if(this.history.add(current),next)return this.playItem(next);console.log("Showrunner: Nothing else to play")})}async onItemSelected(evt){var{item,queue}=evt.detail;if(console.log("-------------------------------"),console.log("Show runner: New item selected"),queue&&queue.length)return this.stopAndBeginThisNewQueue(queue);var current=this.queue.dequeue();return current&&this.history.add(current),this.queue.dropIn(item),Array.isArray(item)?this.playItem(item[0]):this.playItem(item)}async playItem(item){if(item.hasOwnProperty("album")&&!item.hasOwnProperty("title")){var artist=Array.isArray(item.artist)?item.artist[0]:item.artist,album=item.album,tracks=await this.api.discover.albums.get(artist,album).fetchItems();return this.queue.dequeue(),this.queue.dropIn(tracks),this.setupItem(this.queue.front,!0)}return this.setupItem(item,!0)}async setupItem(item,play=!0){return this.findResourcesForMusicalItem(item).then(response=>{if(response.data.length)return this.setupResources(item,response.data,play),response;alert("Show runner: Nothing found to play")})}setupResources(item,resources,autoPlay=!0){this.$refs.controls.remove(),this.$refs.controls=Component_ReproductionControls.instantiate(this.api,item,resources,autoPlay,this.isShuffleOn()),this.$refs.footer.append(this.$refs.controls)}async findResourcesForMusicalItem(item){console.log("Show runner: searching for source to play");var params={};return item.title&&(params.title=item.title),item.soundtrack&&item.soundtrack.length?params.soundtrack=item.soundtrack:item.artist&&item.artist.length&&(params.artist=item.artist),item.genre&&(params.genre=Array.isArray(item.genre)?item.genre[0]:item.genre),this.api.discover.resources(params)}onNavigationUpdate(evt){this.saveTabs()}saveTabs(){var requests=[];for(var tab of this.$refs.stage.getTabs()){var request=tab.childNodes[0]&&tab.childNodes[0].request?tab.childNodes[0].request:null;request&&requests.push(Helper_Serialization.serialize(request))}this.navigationState.set("requests",requests)}restoreTabs(){var requests=this.loadTabs(),focus=!1,n=0;for(var r of requests)focus=n==requests.length-1,this.$refs.stage.openInNewTab(r,focus),n++;return requests.length}openHomePage(){this.$refs.stage.createTab("main-tab",!0).access("#home")}loadTabs(){var serializedRequests=this.navigationState.get("requests",[]),requests=[];for(var s of serializedRequests){var ins=new(Instantiator_default())(Routing_HashRequest,s).instantiate();requests.push(ins)}return requests}}App.register();const Element_App=App;class CreateElement{constructor(elementName,attributes=null,children=[]){this.elementName=elementName,this.attributes=attributes,this.children=Array.isArray(children)?children:[children]}create(){var element=document.createElement(this.elementName);for(var attribute in this.attributes)element.setAttribute(attribute,this.attributes[attribute]);for(var child of this.children)null!=child&&("string"==typeof child?child=document.createTextNode(child):"object"==typeof child&&child.elementName&&(child=CreateElement.createFromObject(child)),element.append(child));return element}static createFromObject(obj){var{elementName,attributes,children}=obj;return new CreateElement(elementName,attributes,children).create()}}const Helper_CreateElement=CreateElement;HTMLElement.prototype.attach=function(element){return element instanceof NodeList||Array.isArray(element)?(element.forEach(el=>{this.attach(el)}),element):(null!==element&&this.append(element),element)},HTMLElement.prototype.attachTo=function(element){return element.append(this),this},HTMLElement.prototype.create=function(elementName,attributes=null,children=[]){return new Helper_CreateElement(elementName,attributes,children).create()},HTMLElement.prototype.createAndAttach=function(elementName,attributes=null,children=[]){return this.attach(this.create(elementName,attributes,children))},HTMLElement.prototype.clear=function(){var children=Array.from(this.children);for(var c of children)c.remove();return this},HTMLElement.prototype.getAncestor=function(selector){for(var element=this;element.parentNode;){if(element.matches(selector))return element;element=element.parentNode}return null},HTMLElement.prototype.addEventListenerOnce=function(key,eventName,callback){var attribute="data-once-"+key;this.hasAttribute(attribute)||(this.setAttribute(attribute,"true"),this.addEventListener(eventName,callback))},URLSearchParams.prototype.without=function(name){var newSearch=new URLSearchParams(this.toString());return newSearch.delete(name),newSearch},URLSearchParams.prototype.withAdded=function(name,value){var newSearch=new URLSearchParams(this.toString());return newSearch.append(name,value),newSearch},URLSearchParams.prototype.isEmpty=function(){return 0==this.toString().length},HTMLElement.prototype.index=function(){return Array.from(this.parentElement.childNodes).indexOf(this)};const api=new Api_Api(window.playerSettings.backEndBaseUrl);window.api=api,window.app=Element_App.instantiate(api),document.addEventListener("DOMContentLoaded",()=>{document.body.append(window.app)})})()})();