(()=>{var t={978:(t,e,s)=>{t.exports=s(411)},781:(t,e,s)=>{const i=s(923);class a{static toObject(t){var e,s,r;return"Object"==t.constructor.name?t:t instanceof FormData?i.formDataToObject(t):t instanceof HTMLFormElement?(e=new FormData(t),i.formDataToObject(e)):t instanceof URL?i.queryStringToObject(t.search):t instanceof URLSearchParams?i.searchParamsToObject(t):i.isValidJson(t)?JSON.parse(t):(r=(s=i.stringToUrl(t))&&s.search?new URLSearchParams(s.search):new URLSearchParams(t),a.emptySearchParams(r)?null:i.searchParamsToObject(r))}static toJson(t){var e;return i.isValidJson(t)?t:(e=a.toObject(t),JSON.stringify(e))}static toFormData(t){var e;return t instanceof FormData?t:t instanceof HTMLFormElement?new FormData(t):(e=a.toObject(t),i.objectToFormData(e))}static emptySearchParams(t){for(var e of t.values())if(e)return!1;return!0}}t.exports=a},923:(t,e,s)=>{const i=s(26),a=s(15);class r{static stringToUrl(t){if(a.isAbsolute(t))return new URL(t);var e;const s="/"==t.slice(0,1),r=a.getBaseHref();return s?((e=new URL(r)).pathname=t,e.placeholder=e.toString().replace(t,"")):(e=new URL(r+i.ltrim(t,"/"))).placeholder=r,e}static urlToString(t){var e=t.toString();return t.placeholder&&(e=e.replace(t.placeholder,"")),e}static searchParamsToObject(t){var e={};for(var[s,a]of t.entries()){var n=-1==s.indexOf("[")?[s]:i.rtrim(s,"]").split(/\]?\[/);r.addPropertyToObject(e,n,a)}return e}static addPropertyToObject(t,e,s){var i=e.pop();for(var a of e)void 0===t[a]&&(t[a]=isNaN(a)?{}:[]),t=t[a];t[i]=s}static objectToSearchParams(t){var e=new URLSearchParams;for(var s in t)r.addToSearchparam(e,s,t[s]);return e}static addToSearchparam(t,e,s){if(Array.isArray(s)||"object"==typeof s)for(var i in s)r.addToSearchparam(t,e+"["+i+"]",s[i]);else t.set(e,s)}static objectToFormData(t){var e=new FormData;for(var s in t)r.addToSearchparam(e,s,t[s]);return e}static formDataToObject(t){return r.searchParamsToObject(t)}static objectToQueryString(t){return r.objectToSearchParams(t).toString()}static queryStringToObject(t){var e=new URLSearchParams(t);return r.searchParamsToObject(e)}static isValidJson(t){if("string"!=typeof t)return!1;try{JSON.parse(t)}catch(t){return!1}return!0}}t.exports=r},26:t=>{class e{static ltrim(t,e=null){e=e||"[ \t\n\r\0\v]";var s=new RegExp("^"+e+"+");return t.replace(s,"")}static rtrim(t,e=null){e=e||"[ \t\n\r\0\v]";var s=new RegExp(e+"+$");return t.replace(s,"")}static trim(t,s=" "){return t=e.ltrim(t,s),e.rtrim(t,s)}}t.exports=e},15:(t,e,s)=>{const i=s(26);class a{static getBaseHref(){return a.getDocumentBaseHref()??a.getWindowLocationBaseHref()}static getWindowLocationBaseHref(){const t=window.location;var e;return e="/"==t.pathname.slice(-1)?t.protocol+"//"+t.host+t.pathname:t.pathname.match(/\.[\w]{2,4}$/)?t.protocol+"//"+t.host+t.pathname.replace(/\/[^\/]+$/,""):t.protocol+"//"+t.host+t.pathname,i.rtrim(e,"/")+"/"}static getDocumentBaseHref(){const t=document.querySelector("base");if(!t)return null;const e=t.getAttribute("href");return e?i.rtrim(e,"/")+"/":null}static isAbsolute(t){return t instanceof URL||"http"==t.substr(0,4)}static isRelative(t){return!a.isAbsolute(t)}}t.exports=a},411:(t,e,s)=>{const i=s(923),a=s(781),r=s(15),n=s(26);class l{defaultOptions={};constructor(t={}){null!=t.baseHref&&(t.baseHref=n.rtrim(t.baseHref,"/")+"/"),this.defaultOptions=t}async fetch(t,e={}){return e.method||(e.method="get"),this.request(t,e)}async get(t,e={}){return e.method="get",this.request(t,e)}async post(t,e={}){return e.method="post",this.request(t,e)}async put(t,e={}){return e.method="put",this.request(t,e)}async delete(t,e={}){return e.method="delete",this.request(t,e)}async options(t,e={}){return e.method="options",this.request(t,e)}async patch(t,e={}){return e.method="patch",this.request(t,e)}static createRequest(t,e){return"string"==typeof t&&(t=r.isRelative(t)?new URL(t,e.baseHref||r.getBaseHref()):new URL(t)),null==e.headers&&(e.headers={}),e.queryParams&&(t=l.addToQueryString(t,e.queryParams),e.queryParams=void 0),"get"==e.method&&e.body?(t=l.addToQueryString(t,e.body),e.body=void 0):e.body&&(e.body="application/json"==l.getHeader(e.headers,"Content-Type")?a.toJson(e.body):a.toFormData(e.body)),l.clearUpOptions(e),new Request(t,e)}static clearUpOptions(t){for(var e in t)void 0===t[e]&&delete t[e];if(t.headers)for(var s in t.headers)void 0===t.headers[s]&&delete t.headers[s]}async request(t,e={}){e={...this.defaultOptions,...e};var s=l.createRequest(t,e);return fetch(s)}static addToQueryString(t,e){var s;e=a.toObject(e);var r=t instanceof URL;for(var n in s=(t=r?t:i.stringToUrl(t)).search?new URLSearchParams(t.search):new URLSearchParams,e)i.addToSearchparam(s,n,e[n]);return t.search=s.toString(),r?t:i.urlToString(t)}static getHeader(t,e){e=e.toLowerCase();for(let s in t)if(s.toLocaleLowerCase()==e)return t[s];return null}}t.exports=l},766:t=>{t.exports=class{static isA(t,e){for(var s=t.__proto__;s;){if("string"==typeof e&&s.name==e)return!0;if("function"==typeof e&&s.name==e.name)return!0;s=s.__proto__}return!1}}}},e={};function s(i){var a=e[i];if(void 0!==a)return a.exports;var r=e[i]={exports:{}};return t[i](r,r.exports,s),r.exports}s.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";const t=class{constructor(t){this.httpClient=t}async apiCall(t,e,s=void 0,i=void 0,a=void 0){return new Promise(((r,n)=>{this.request(t,e,s,i,a).then((t=>t.json().then((e=>{t.status<400?r(e):n(e)}))))}))}request(t,e,s=void 0,i=void 0,a=void 0){var r,n={body:s,queryParams:i};switch(a&&(n={...n,...a}),t){case"post":r=this.httpClient.post(e,n);break;case"put":r=this.httpClient.put(e,n);break;case"delete":r=this.httpClient.delete(e,n);break;case"get":r=this.httpClient.get(e,n)}return r}},e=class extends t{list(){return this.apiCall("get","api/v1/collection/artists")}},i=class extends t{constructor(t,e){super(t),this.playlistId=e}read(){return this.apiCall("get","api/v1/collection/playlists/"+this.playlistId)}download(){var t=new URL("api/v1/collection/playlists/"+this.playlistId+"?download=1",this.httpClient.defaultOptions.baseHref);window.open(t.toString(),"_blank")}getItems(t=null){return this.apiCall("get","api/v1/collection/playlists/"+this.playlistId+"/items",null,t)}update(t){return this.apiCall("put","api/v1/collection/playlists/"+this.playlistId,t,null,{headers:{"Content-Type":void 0}})}delete(){return this.apiCall("delete","api/v1/collection/playlists/"+this.playlistId)}},a=class extends t{list(){return this.apiCall("get","api/v1/collection/playlists")}downloadAll(){var t=new URL("api/v1/collection/playlists?download=1",this.httpClient.defaultOptions.baseHref);window.open(t.toString(),"_blank")}create(t){return this.apiCall("post","api/v1/collection/playlists",t,null,{headers:{"Content-Type":void 0}})}get(t){return new i(this.httpClient,t)}},r=class extends t{constructor(t,e){super(t),this.uuid=e}read(){return this.apiCall("get","api/v1/collection/items/"+this.uuid)}update(t){return this.apiCall("put","api/v1/collection/items/"+this.uuid,t,null,{headers:{"Content-Type":void 0}})}delete(){return this.apiCall("delete","api/v1/collection/items/"+this.uuid)}},n=class extends t{search(t){return this.apiCall("get","api/v1/collection/items",null,t)}create(t){return this.apiCall("post","api/v1/collection/items",t,null,{headers:{"Content-Type":void 0}})}get(t){return new r(this.httpClient,t)}},l=class extends t{constructor(t,e){super(t),this.releaseId=e}getTracks(t=null){return this.apiCall("get","api/v1/discover/releases/"+this.releaseId,null,t)}},o=class extends t{search(t){return this.apiCall("get","api/v1/discover/releases",null,t)}get(t){return new l(this.httpClient,t)}},h=class extends t{search(t){return this.apiCall("get","api/v1/discover/artists",null,t)}},d=class extends t{constructor(t){super(t),this.releases=new o(t),this.artists=new h(t)}resources(t){return this.apiCall("get","api/v1/discover/resources",null,t)}},c=s(978);class u extends HTMLElement{__construct(t=null,e=null){}beforeRender(){}render(){this.innerHTML="inner html"}afterRender(){}refresh(){this.clear(),this.renderLifeCycle()}renderLifeCycle(){this.beforeRender(),this.render(),this.afterRender()}connectedCallback(){this.attached||(this.attached=!0,this.renderLifeCycle())}static elementName="base-element";static register(){customElements.get(this.elementName)||customElements.define(this.elementName,this)}static instantiate(...t){if(!customElements.get(this.elementName))throw`Register this garbage <${this.elementName}> damn you, you forgot to register it! Call .register() !!`;var e=document.createElement(this.elementName);return e.__construct(...t),e}fireEvent(t,e=null,s=!0){var i={bubbles:s};null!=e&&(i.detail=e);var a=new CustomEvent(t,i);return this.dispatchEvent(a)}constructor(){super(),this.$refs={},this.attached=!1}}const p=u;class m extends p{static elementName="nav-menu";__construct(t){this.api=t}render(){this.clear(),this.classList.add("app-nav"),this.addGenericNavItem("#home","Home","fa-chevron-right"),this.addGenericNavItem("#search","Search","fa-chevron-right"),this.addGenericNavItem("#discover:artist","Discover","fa-chevron-right"),this.createAndAttach("hr"),this.$refs.playlists=this.createAndAttach("div",{class:"app-nav__playlists"}),this.createAndAttach("hr"),this.$refs.artists=this.createAndAttach("div",{class:"app-nav__artists"}),this.updatePlaylists(),this.updateArtists()}updatePlaylists(){this.api.collection.playlists.list().then((t=>{if(t.data)for(var e of t.data)this.addPlaylistNavItem(e.id,e.title);this.$refs.playlists.append(this.$refs.createPlaylist=this.createGenericNavItem(null,"Create playlist","fa-plus-circle")),this.$refs.createPlaylist.addEventListener("click",(()=>{this.fireEvent("add-playlist")})),this.$refs.playlists.append(this.$refs.downloadPlaylists=this.createGenericNavItem(null,"Download playlists","fa-download")),this.$refs.downloadPlaylists.addEventListener("click",(()=>{this.fireEvent("download-playlists")}))}))}updateArtists(){this.api.collection.artists.list().then((t=>{for(var e of t.data)this.addArtistNavItem(e)}))}addArtistNavItem(t){this.$refs.artists.createAndAttach("div",{class:"app-nav__item"},this.create("a",{href:"#search?artist="+t},t))}addPlaylistNavItem(t,e){var s;this.$refs.playlists.createAndAttach("div",{class:"app-nav__item"},[this.create("a",{href:`#playlist:${t}`,class:"ellipsis"},e),s=this.create("a",{class:"editing"},this.create("span",{class:"fa fa-pencil"}))]),s.addEventListener("click",(()=>{this.fireEvent("edit-playlist",{playlistId:t})}))}addGenericNavItem(t,e,s=null){var i=this.createGenericNavItem(t,e,s);return this.append(i),i}createGenericNavItem(t,e,s=null){var i,a;return i=this.createAndAttach("div",{class:"app-nav__item"}),a=null!=t?i.createAndAttach("a",{href:t}):i.createAndAttach("a"),s&&a.createAndAttach("span",{class:"fa "+s}),a.append(e),i}}m.register();const f=m;class g extends HTMLElement{constructor(){super(),this.state={isPaused:!1,isPlaying:!1,isReproducing:!1,isBuffering:!1,isWaiting:!1,isEnded:!1,volume:100}}appendTo(t){return t.append(this),new Promise((async(t,e)=>t()))}prependTo(t){return t.prepend(this),new Promise((async(t,e)=>t()))}appendAfter(t){return t.after(this),new Promise((async(t,e)=>t()))}get isPaused(){return this.state.isPaused}get isPlaying(){return this.state.isPlaying}get isReproducing(){return this.state.isReproducing}get isWaiting(){return this.state.isWaiting}get isBuffering(){return this.state.isBuffering}get isEnded(){return this.state.isEnded}get volume(){return this.state.volume}get currentTime(){}get currentTimeFormatted(){return g.secondsToStringRepresentation(this.currentTime)}get currentTimePercentage(){var t,e;return t=Math.round(this.currentTime),e=Math.round(this.duration),isNaN(t)||isNaN(e)||0==t||0==e?0:t/e*100}get remainingTime(){return this.duration-this.currentTime}get remainingTimeFormatted(){return g.secondsToStringRepresentation(this.remainingTime)}get remainingTimePercentage(){return 100-this.currentTimePercentage}get duration(){}get durationFormatted(){return g.secondsToStringRepresentation(this.duration)}getTime(t){return Math.round(this.duration/100*t)}getTimeFormatted(t){return g.secondsToStringRepresentation(this.getTime(t))}getPercentage(t){return("string"==typeof t&&t.indexOf(":")>=0?g.stringRepresentationToSeconds(t):parseFloat(t))/this.duration*100}seek(t){}play(t=null){}pause(){}toggle(){this.isPlaying?this.pause():this.play()}sanitizeGetSeconds(t){var e;return e="string"==typeof t&&t.indexOf(":")>=0?g.stringRepresentationToSeconds(t):"string"==typeof t&&t.indexOf("%")>=0?this.getTime(parseInt(t)):"string"==typeof t?parseInt(t):t,isNaN(e)&&(e=0),e}fireEvent(t,e,s=!0){var i={bubbles:s};null!=e&&(i.detail=e);var a=new CustomEvent(t,i);return this.dispatchEvent(a)}log(t){console.log(t)}static secondsToStringRepresentation(t){return isNaN(t)?"00:00":(t=Math.round(t),n=(a=(a=(s=Math.floor(t/60))-60*(e=Math.floor(s/60)))<10?"0"+a:a)+":"+(r=(r=t-60*s)<10?"0"+r:r),n=(i=e)>0?i+":"+n:n);var e,s,i,a,r,n}static stringRepresentationToSeconds(t){var e,s,i;return!((e=t.match(/[0-9]+/g)).length>3)&&(i=parseInt(e[e.length-1]),s=parseInt(e[e.length-2]||0),3600*parseInt(e[e.length-3]||0)+60*s+i)}}const v=g,y=class{static async loadExternalJs(t,e=null){return new Promise((async function(s,i){var a;(a=document.createElement("script")).async=!0,a.type="text/javascript",a.onload=function(t){s("SCRIPT: loaded")},a.onerror=function(t){i("SCRIPT: failed to load")},a.src=t,(e=e||document.body).appendChild(a)}))}};class b extends v{static sdkLoaded=!1;static sdkLoading=!1;static sdkPromise=null;static defaults={width:640,height:null};constructor(){super(),this.state.currentTime=0,this.state.playerInitialized=!1;var t={embbedId:"youtube-embbed-"+Math.floor(1e4*Math.random()),id:null};this.settings={...b.defaults,...t},this.html={},this.follower=null}connectedCallback(){this.html.embed||this.setUp()}setUp(){var t,e,s,i;return this.html.embed=this.createDiv(this.settings.embbedId,this),(t=this.getAttribute("src"))&&(this.src=t),(e=this.getAttribute("video-id"))&&(this.videoId=e),(s=this.getAttribute("width"))&&(this.width=s),(i=this.getAttribute("height"))&&(this.height=i),this.readyToPlayPromise=b.loadSdk().then((()=>this.initializePlayer()))}remove(){this.html.ytPlayer&&this.html.ytPlayer.destroy(),super.remove()}appendTo(t){return t.append(this),this.readyToPlayPromise}prependTo(t){return t.prepend(this),this.readyToPlayPromise}appendAfter(t){return t.after(this),this.readyToPlayPromise}set src(t){this.settings.id=b.getIdFromUrl(t)}set videoId(t){this.settings.id=t}set width(t){this.settings.width=parseInt(t),this.updateDimensions()}set height(t){this.settings.height=parseInt(t),this.updateDimensions()}updateDimensions(){if(this.html.ytPlayer){var t=this.settings.width,e=this.settings.height;t="auto"==t||"100%"==t?this.offsetWidth:t,e=null==e?t/1.77:e;var s=this.html.ytPlayer.getIframe();s.width=t,s.height=e}}get currentTime(){return this.state.currentTime}get duration(){return this.html.ytPlayer&&this.html.ytPlayer.getDuration?this.html.ytPlayer.getDuration():0}seek(t){if(!this.state.playerInitialized)return!1;var e=this.sanitizeGetSeconds(t);this.html.ytPlayer.seekTo(e,!0)}play(t=null){if(t&&this.seek(t),!this.state.playerInitialized)return!1;this.html.ytPlayer.playVideo()}pause(){if(!this.state.playerInitialized)return!1;this.html.ytPlayer.pauseVideo()}setVolume(t){this.state.volume=t,this.state.playerInitialized&&this.html.ytPlayer.setVolume(t)}async initializePlayer(){return new Promise((async(t,e)=>{var s=this.settings.width,i=this.settings.height;s="auto"==s?this.offsetWidth:s,i=null==i?s/1.77:i,this.html.ytPlayer=new YT.Player(this.settings.embbedId,{width:s,height:i,videoId:this.settings.id,startSeconds:0,host:"https://www.youtube.com",playerVars:{autoplay:1,controls:0},events:{onReady:e=>{t(this),this.setVolume(this.volume),this.state.playerInitialized=!0},onError:t=>{var s=b.getErrorDescription(t.data);e(s),this.fireEvent("player:error",{errorCode:t.data,errorMessage:s})},onStateChange:this.callBackOnStateChange.bind(this)}})}))}callBackOnStateChange(t){switch(t.data){case-1:this.state.isReproducing=!1,this.state.isPlaying=!1,this.state.isPaused=!1;break;case 0:this.state.isReproducing=!1,this.state.isPlaying=!1,this.state.isPaused=!0,this.state.isWaiting=!1,this.state.isEnded=!0,this.stopFollowing(),this.fireEvent("player:ended");break;case 1:var e=this.state.isWaiting;this.state.isReproducing=!0,this.state.isPlaying=!0,this.state.isPaused=!1,this.state.isBuffering=!1,this.state.isWaiting=!1,this.state.isEnded=!1,this.startFollowing(),e?this.fireEvent("player:playing"):this.fireEvent("player:play");break;case 2:this.state.isReproducing=!1,this.state.isPlaying=!1,this.state.isPaused=!0,this.state.isWaiting=!1,this.fireEvent("player:pause");break;case 3:this.state.isReproducing=!1,this.state.isPlaying=!0,this.state.isPaused=!1,this.state.isBuffering=!0,this.state.isWaiting=!0,this.fireEvent("player:waiting");break;case 5:this.play(0),this.fireEvent("player:play")}}startFollowing(){this.follower=setInterval(this.following.bind(this),1e3)}stopFollowing(){clearInterval(this.follower)}following(){var t=this.html.ytPlayer&&this.html.ytPlayer.getCurrentTime?this.html.ytPlayer.getCurrentTime():0;t!=this.currentTime&&(this.state.currentTime=t,this.fireEvent("player:timeupdate"))}static getErrorDescription(t){switch(t){case"2":return"Error 2: invalid parameters.";case"5":return"Error 5: An error related to the HTML5 player occurred.";case"100":return"Error 100: Video not found.";case"101":case"150":return"Error 101: The video's owner won't allow it on embbed players."}return"Error "+t+": Unknown error"}static getIdFromUrl(t){var e;return(e=t.match(/v=([A-Za-z0-9-_]+)/))||(e=t.match(/\.be\/([A-Za-z0-9-_]+)/))||(e=t.match(/embed\/([A-Za-z0-9-_]+)/))?e[1]:null}static async loadSdk(){return b.sdkLoaded?new Promise((async(t,e)=>{t()})):"undefined"!=typeof YT&&void 0!==YT.Player?(b.sdkLoaded=!0,new Promise((async(t,e)=>{t()}))):b.sdkLoading?b.sdkPromise:b.sdkPromise=new Promise((async(t,e)=>{y.loadExternalJs("https://www.youtube.com/iframe_api").then((async()=>{setTimeout((()=>{b.sdkLoaded=!0,t("YouTube SDK ready")}),500)}),(()=>{e("Error loading SDK")}))}))}createDiv(t,e){var s=document.createElement("div");return s.id=t,e.append(s),s}}const A=b;class w extends HTMLElement{constructor(){super(),this.state={isPaused:!1,isPlaying:!1,isReproducing:!1,isBuffering:!1,isWaiting:!1,isEnded:!1,volume:100}}appendTo(t){return t.append(this),new Promise((async(t,e)=>t()))}prependTo(t){return t.prepend(this),new Promise((async(t,e)=>t()))}appendAfter(t){return t.after(this),new Promise((async(t,e)=>t()))}get isPaused(){return this.state.isPaused}get isPlaying(){return this.state.isPlaying}get isReproducing(){return this.state.isReproducing}get isWaiting(){return this.state.isWaiting}get isBuffering(){return this.state.isBuffering}get isEnded(){return this.state.isEnded}get volume(){return this.state.volume}get currentTime(){}get currentTimeFormatted(){return w.secondsToStringRepresentation(this.currentTime)}get currentTimePercentage(){var t,e;return t=Math.round(this.currentTime),e=Math.round(this.duration),isNaN(t)||isNaN(e)||0==t||0==e?0:t/e*100}get remainingTime(){return this.duration-this.currentTime}get remainingTimeFormatted(){return w.secondsToStringRepresentation(this.remainingTime)}get remainingTimePercentage(){return 100-this.currentTimePercentage}get duration(){}get durationFormatted(){return w.secondsToStringRepresentation(this.duration)}getTime(t){return Math.round(this.duration/100*t)}getTimeFormatted(t){return w.secondsToStringRepresentation(this.getTime(t))}getPercentage(t){return("string"==typeof t&&t.indexOf(":")>=0?w.stringRepresentationToSeconds(t):parseFloat(t))/this.duration*100}seek(t){}play(t=null){}pause(){}toggle(){this.isPlaying?this.pause():this.play()}sanitizeGetSeconds(t){var e;return e="string"==typeof t&&t.indexOf(":")>=0?w.stringRepresentationToSeconds(t):"string"==typeof t&&t.indexOf("%")>=0?this.getTime(parseInt(t)):"string"==typeof t?parseInt(t):t,isNaN(e)&&(e=0),e}fireEvent(t,e,s=!0){var i={bubbles:s};null!=e&&(i.detail=e);var a=new CustomEvent(t,i);return this.dispatchEvent(a)}log(t){console.log(t)}static secondsToStringRepresentation(t){return isNaN(t)?"00:00":(t=Math.round(t),n=(a=(a=(s=Math.floor(t/60))-60*(e=Math.floor(s/60)))<10?"0"+a:a)+":"+(r=(r=t-60*s)<10?"0"+r:r),n=(i=e)>0?i+":"+n:n);var e,s,i,a,r,n}static stringRepresentationToSeconds(t){var e,s,i;return!((e=t.match(/[0-9]+/g)).length>3)&&(i=parseInt(e[e.length-1]),s=parseInt(e[e.length-2]||0),3600*parseInt(e[e.length-3]||0)+60*s+i)}}const P=w;customElements.define("player-youtube",A),customElements.define("player-audio",class extends P{constructor(){super(),this.settings={src:null}}connectedCallback(){this.mediaP||this.setUp()}setUp(){this.mediaP=this.createMedia(),this.mediaP.src=this.settings.src,this.append(this.mediaP),this.mediaP.addEventListener("play",(t=>{this.state.isPaused=!1,this.state.isPlaying=!0,this.state.isWaiting=!1,this.fireEvent("player:play")})),this.mediaP.addEventListener("pause",(t=>{this.state.isPlaying=!1,this.state.isPaused=!0,this.state.isReproducing=!1,this.fireEvent("player:pause")})),this.mediaP.addEventListener("timeupdate",(t=>{this.state.isReproducing=!0,this.state.isEnded=!1,this.fireEvent("player:timeupdate")})),this.mediaP.addEventListener("ended",(t=>{this.state.isPlaying=!1,this.state.isPaused=!0,this.state.isReproducing=!1,this.state.isWaiting=!1,this.state.isEnded=!0,this.fireEvent("player:ended")})),this.mediaP.addEventListener("error",(t=>{this.fireEvent("player:error",{errorCode:0,errorMessage:"Resource could not be loaded"})})),this.mediaP.addEventListener("loadstart",(t=>{this.state.isBuffering=!0})),this.mediaP.addEventListener("progress",(t=>{this.state.isBuffering=!0})),this.mediaP.addEventListener("waiting",(t=>{this.state.isReproducing=!1,this.state.isBuffering=!0,this.state.isWaiting=!0,this.fireEvent("player:waiting")})),this.mediaP.addEventListener("playing",(t=>{this.state.isWaiting=!1,this.fireEvent("player:playing")})),this.mediaP.addEventListener("canplaythrough",(t=>{this.state.isBuffering=!1,this.state.isWaiting=!1})),this.mediaP.addEventListener("canplay",(t=>{this.state.isBuffering=!1,this.state.isWaiting=!1})),this.mediaP.addEventListener("suspend",(t=>{this.state.isBuffering=!1})),this.mediaP.addEventListener("abort",(t=>{this.state.isBuffering=!1})),this.mediaP.addEventListener("stalled",(t=>{this.state.isBuffering=!1}))}set src(t){this.settings.src=t}get currentTime(){return this.mediaP.currentTime}get duration(){return this.mediaP.duration}play(t=this.currentTime){return this.seek(t),this.mediaP.play()}pause(){this.mediaP.pause()}seek(t){var e=this.sanitizeGetSeconds(t);this.mediaP.currentTime=e}setVolume(t){this.state.volume=t;var e=t>0?t/100:t;this.mediaP.volume=e}createMedia(){return new Audio}});class T extends p{static elementName="reproduction-controls";__construct(t,e=null,s=null){this.api=t,this.item=e,this.resources=s,this.index=0,this.player=null,this.settings=new class{constructor(t,e=null){this.name=t,e?this.data=e:this.load()}get(t,e=null){return null==this.data[t]?e:this.data[t]}getInt(t,e=0){return parseInt(this.get(t,e))}set(t,e){this.data[t]=e,this.save()}save(){var t=JSON.stringify(this.data);localStorage.setItem(this.name,t)}load(){var t=localStorage.getItem(this.name);return this.data=t?JSON.parse(t):{}}}("controls.settings"),this.item&&this.item.artist&&!Array.isArray(this.item.artist)&&(this.item.artist=[this.item.artist])}render(){if(this.classList.add("reproduction-controls"),this.createAndAttach("div",{class:"reproduction-controls__label"},[this.$refs.title=this.createAndAttach("div",{class:"reproduction-controls__title"}),this.$refs.artists=this.createAndAttach("div",{class:"reproduction-controls__artists"})]),this.resources&&this.resources.length&&(this.$refs.buttonNotIt=this.createAndAttach("button",{class:"reproduction-controls__not-it",title:"not it"},this.create("span",{class:"fa fa-refresh"}))),this.$refs.timer=this.createAndAttach("span",{class:"reproduction-controls__timer"},["--:--"]),this.createAndAttach("div",{class:"reproduction-controls__buttons button-group"},[this.$refs.buttonBackward=this.createAndAttach("button",{class:"reproduction-controls__button-next"},this.create("span",{class:"fa fa-backward"})),this.$refs.buttonPlay=this.createAndAttach("button",{class:"reproduction-controls__button-play"},this.create("span",{class:"fa fa-play"})),this.$refs.buttonNext=this.createAndAttach("button",{class:"reproduction-controls__button-next"},this.create("span",{class:"fa fa-forward"}))]),this.$refs.volumeControl=this.createAndAttach("input",{type:"range",min:0,max:100,step:1,class:"reproduction-controls__volume"}),this.$refs.buttonQueue=this.createAndAttach("button",{class:"reproduction-controls__button-queue",title:"Queue"},this.create("span",{class:"fa fa-list"})),this.$refs.progress=this.createAndAttach("progress",{max:100,class:"reproduction-controls__progress"}),this.$refs.playerFrame=this.createAndAttach("div",{class:"player-frame intangible"}),this.$refs.volumeControl.value=this.settings.getInt("volume",15),this.$refs.volumeControl.addEventListener("change",this.dialVolume.bind(this)),this.$refs.buttonQueue.addEventListener("click",(()=>{this.fireEvent("summon-queue")})),this.resources){for(var t of(this.$refs.title.innerHTML=this.item.title,this.item.artist))this.$refs.artists.createAndAttach("a",null,t);this.$refs.progress.addEventListener("click",this.seek.bind(this)),this.$refs.buttonPlay.addEventListener("click",this.toggle.bind(this)),this.addEventListener("player:timeupdate",this.onTimeUpdate.bind(this)),this.addEventListener("player:ended",(()=>{console.log("Reproduction: ended")})),this.addEventListener("player:pause",(()=>{console.log("Reproduction: paused")})),this.$refs.buttonBackward.addEventListener("click",(()=>{this.fireEvent("controls:backward")})),this.$refs.buttonNext.addEventListener("click",(()=>{this.fireEvent("controls:forward")})),this.$refs.buttonNotIt&&this.$refs.buttonNotIt.addEventListener("click",this.notIt.bind(this)),this.playResource()}}notIt(){this.resources[this.index+1]?(this.index++,this.destroyPlayer(),this.playResource(this.index)):alert("no more alternatives")}playResource(t=0){console.log("Reproduction: booting player"),window.player=this.player=this.createPlayer(this.resources[t]),this.player.appendTo(this.$refs.playerFrame).then((()=>{this.player.play(),this.player.setVolume(this.settings.getInt("volume",15)),console.log("Reproduction: reproducing audio")}))}destroyPlayer(){return this.player&&(this.player.pause(),this.player.remove()),this}createPlayer(t){switch(t.source){case"youtube":return this.createPlayerYouTube(t);case"sliderkz":return this.createPlayerSliderKz(t)}}createPlayerYouTube(t){var e=document.createElement("player-youtube");return e.videoId=t.id,e.width=390,e}createPlayerSliderKz(t){var e=document.createElement("player-audio");return e.src=t.src,e}toggle(){this.player&&this.player.toggle()}onTimeUpdate(){this.$refs.timer.innerHTML=this.player.currentTimeFormatted,this.$refs.progress.value=this.player.currentTimePercentage}dialVolume(t){var e=t.target.value;this.settings.set("volume",e),this.player&&this.player.setVolume(e)}seek(t){var e,s,i;this.player&&(e=t.clientX-this.$refs.progress.offsetLeft,s=this.$refs.progress.offsetWidth,i=Math.ceil(e/s*100)+"%",this.player.seek(i))}}T.register();const $=T,R=class extends p{static elementName="view-welcome";__construct(t,e){this.request=t,this.api=e}afterRender(){this.classList.add("view")}};class E extends R{static elementName="view-welcome";render(){var t=document.createElement("p");t.innerHTML="Welcome back",this.append(t)}}E.register();const L=E;class S extends p{static elementName="playlist-item";__construct(t={}){this.item=t,this.item.artist?this.item.artist=Array.isArray(this.item.artist)?this.item.artist:[this.item.artist]:this.item.artist=[],this.item.soundtrack?this.item.soundtrack=Array.isArray(this.item.soundtrack)?this.item.soundtrack:[this.item.soundtrack]:this.item.soundtrack=[]}render(){for(var t of(this.innerHTML="",this.classList.add("playlist-item"),this.$refs.body=this.createAndAttach("div",{class:"playlist-item__body"}),this.$refs.action=this.createAndAttach("div",{class:"playlist-item__actions"}),this.item.title&&(this.$refs.title=this.$refs.body.createAndAttach("span",{class:"playlist-item__title"},[this.item.title])),this.item.artist))this.$refs.body.createAndAttach("span",{class:"playlist-item__artist playlist-item__info"},[this.create("a",{href:`#search?artist=${t}`},t)," ",this.create("a",{href:`#discover:releases?artist=${t}`},[this.createAndAttach("span",{class:"fa fa-search"})])]);for(var e of this.item.soundtrack)this.$refs.body.createAndAttach("span",{class:"playlist-item__soundtrack playlist-item__info"},[this.create("a",{href:`#search?soundtrack=${e}`},e)]);this.$refs.addButton=this.$refs.action.createAndAttach("a",{title:"Add"},this.createAndAttach("span",{class:"fa fa-plus"})),this.item.uuid&&(this.$refs.editButton=this.$refs.action.createAndAttach("a",{title:"Edit"},this.createAndAttach("span",{class:"fa fa-pencil"})),this.$refs.editButton.addEventListener("click",(()=>{this.fireEvent("edit-item",{uuid:this.item.uuid})})),this.$refs.removeButton=this.$refs.action.createAndAttach("a",{title:"Remove"},this.createAndAttach("span",{class:"fa fa-times"})),this.$refs.removeButton.addEventListener("click",(()=>{this.fireEvent("delete-item",{uuid:this.item.uuid})}))),this.$refs.title.addEventListener("click",(()=>{this.fireEvent("item-selected",{item:this.item})})),this.$refs.addButton.addEventListener("click",(()=>{this.fireEvent("item-to-add",{items:[this.item]})}))}}S.register();const q=S;var I=s(781),x=s.n(I),k=s(923),_=s.n(k);class N extends p{static elementName="view-search-header";__construct(t,e,s){this.request=t,this.title=e,this.fields=s}render(){var t;for(var e of(this.classList.add("search-header"),this.createAndAttach("h1",null,this.title),this.$refs.form=this.createAndAttach("form",{class:"search-header__form input-group input-group-horizontal"}),this.fields))e.value=this.request.queryParams.get(e.name)||"",t=this.$refs.form.createAndAttach("input",e),e.value.length&&(t.focus(),t.selectionStart=t.selectionEnd=t.value.length);this.$refs.form.createAndAttach("button",null,[this.create("span",{class:"fa fa-search"})]),this.$refs.form.addEventListener("submit",(t=>{t.preventDefault(),window.location.href=this.request.path+"?"+_().objectToSearchParams(x().toObject(this.$refs.form)).toString()}))}}N.register();const M=N;class C extends p{static elementName="view-pagination";__construct(t,e,s){this.api=t,this.request=e,this.response=s,this.response.meta&&this.response.meta.pages&&(this.max=10,this.halfMax=this.max/2,this.response.meta.pages<=this.max?(this.first=1,this.last=this.response.meta.pages):this.response.meta.page+this.halfMax>this.response.meta.pages?(this.last=this.response.meta.pages,this.first=this.last-this.max):this.response.meta.page>this.halfMax?(this.first=this.response.meta.page-this.halfMax,this.last=this.response.meta.page+this.halfMax):(this.first=1,this.last=this.first+this.max))}render(){this.classList.add("button-group"),this.classList.add("view-nav"),this.response.meta&&this.response.meta.pages&&(this.first>1&&this.subRenderAnchorToBeginning(),this.response.meta.page>1&&this.subRenderAnchorToPreviousPage(),this.response.meta.pages>this.max&&this.subRenderAnchorBetweenExtremes(),this.response.meta.page<this.last&&this.subRenderAnchorToNextPage(),this.response.meta.pages>this.last&&this.subRenderAnchorToLast())}subRenderAnchorToBeginning(){var t=this.request.queryParams.without("page");t.set("page",1),this.createAndAttach("a",{href:this.request.path+"?"+t.toString(),class:"btn view-nav-first"},["first"])}subRenderAnchorToPreviousPage(){var t=this.request.queryParams.without("page");t.set("page",this.response.meta.page-1),this.createAndAttach("a",{href:this.request.path+"?"+t.toString(),class:"btn view-nav-previous"},["prev"])}subRenderAnchorBetweenExtremes(){for(var t=this.first;t<=this.last;t++){var e=this.request.queryParams.without("page");e.set("page",t);var s=this.response.meta.page==t;this.createAndAttach("a",{href:this.request.path+"?"+e.toString(),class:s?"btn view-nav-current":"btn"},[t])}}subRenderAnchorToNextPage(){var t=this.request.queryParams.without("page");t.set("page",this.response.meta.page+1),this.createAndAttach("a",{href:this.request.path+"?"+t.toString(),class:"btn view-nav-next"},["next"])}subRenderAnchorToLast(){var t=this.request.queryParams.without("page");t.set("page",this.response.meta.pages),this.createAndAttach("a",{href:this.request.path+"?"+t.toString(),class:"btn view-nav-last"},["last"])}}C.register();const F=C;class H{static enableBottomReached(t){t.addEventListener("scroll",H.onScroll.bind(t))}static onScroll(t){this.scrollTop+this.offsetHeight>=this.scrollHeight&&this.dispatchEvent(new CustomEvent("scroll-bottom-reached",{bubbles:!1}))}}const B=H,O=class{constructor(t){this.api=t,this.noMore=!1}progress(){}async fetchMore(t){return this.noMore?new Promise(((t,e)=>t({data:[]}))):(this.progress(),this.request(t).then((t=>(console.log(t),t.data&&0!=t.data.length||(this.noMore=!0),t))))}async request(t){}},D=class extends O{constructor(t,e){super(t),this.queryParams=e}progress(){var t=parseInt(this.queryParams.get("page")||1)+1;this.queryParams.set("page",t)}async request(t){return this.api.collection.playlistItems.search(this.queryParams)}},U=class extends D{constructor(t,e,s){super(t,e),this.playlistId=s}async request(t){return this.api.collection.playlists.get(this.playlistId).getItems(this.queryParams)}};class j extends Array{static instantiate(t=[],e){var s=new j;return s.enqueue(t),s.context=e,s.fetchingPromise=null,s.length<=1&&s.fetchMore(),s}enqueue(t){Array.isArray(t)?this.enqueueMultiple(t):this.enqueueSingle(t)}dequeue(){var t=this[0]||null;return this.splice(0,1),this.updatedCallback(),t}dropIn(t){this.splice(0,0,t),this.updatedCallback()}move(t,e=0){console.log(t,e);var s=this.splice(t,1)[0];return this.splice(e,0,s),this.updatedCallback(),s}get front(){return this[0]?this[0]:(console.log("Queue: end reached"),null)}get back(){return this.length?this[this.length-1]:null}async getNextInLine(){return this.length>=2?new Promise(((t,e)=>t(this[1]))):this.fetchMore().then((t=>this[1]||null))}async fetchMore(){return console.log("Queue: Searching for more content"),this.fetchingPromise?this.fetchingPromise:this.fetchingPromise=this.context.fetchMore(this).then((t=>(this.fetchingPromise=null,t.data&&t.data.length?this.enqueue(t.data):console.log("Queue: nothig more to add to the queue"),t)))}enqueueMultiple(t){this.push(...t),console.log("Queue: multiple items added"),this.updatedCallback()}enqueueSingle(t){this.push(t),console.log("Queue: single item added"),this.updatedCallback()}updatedCallback(){console.log("queue updated")}}const V=j;class Q extends R{static elementName="view-playlist";async render(){this.fetch().then((t=>{this.subRenderHeader(t),this.subRenderItems(t),this.subRenderNavigation(t),this.subRenderButtonGroup()})),B.enableBottomReached(this),this.addEventListener("scroll-bottom-reached",this.bottomReached.bind(this)),this.addEventListener("item-selected",this.onItemSelected.bind(this))}bottomReached(t){console.log("Bottom of the page reached")}fetch(){return this.api.collection.playlists.get(this.request.attributes.playlistId).getItems(this.request.queryParams)}subRenderHeader(t){return this.append(M.instantiate(this.request,t.playlist?t.playlist.title:this.request.attributes.playlistId,[{type:"search",name:"title",placeholder:"Title",class:"main"},{type:"search",name:"artist",placeholder:"Artist"},{type:"search",name:"genre",placeholder:"Genre"}]))}async subRenderItems(t){if(t.data)for(var e of t.data)this.attach(q.instantiate(e))}subRenderNavigation(t){this.append(F.instantiate(this.api,this.request,t))}subRenderButtonGroup(){this.createAndAttach("div",{class:"input-group input-group-horizontal"},[this.$refs.buttonCreate=this.create("button",{class:"main"},"New Item"),this.$refs.buttonDelete=this.create("button",{class:"btn-danger"},"Delete playlist")]),this.$refs.buttonCreate.addEventListener("click",(()=>{this.fireEvent("add-item",{playlist:this.request.attributes.playlistId})})),this.$refs.buttonDelete.addEventListener("click",(()=>{this.fireEvent("delete-playlist",{playlist:this.request.attributes.playlistId})}))}onItemSelected(t){var e=[];for(var s of this.querySelectorAll(q.elementName))e.push(s.item);for(var i in e)if(e[i]==t.detail.item){e=e.slice(i);break}var a=new U(this.api,this.request.queryParams,this.request.attributes.playlistId),r=V.instantiate(e,a);t.detail.queue=r}}Q.register();const G=Q;class W extends R{static elementName="view-discography";async render(){this.api.discover.releases.search(this.request.queryParams).then((t=>{this.renderHeader(t),this.renderReleases(t),this.renderNavigation(t)}))}renderHeader(t){var e=M.instantiate(this.request,"Discover albums",[{type:"search",name:"artist",placeholder:"artist",class:"main"}]);this.append(e)}async renderReleases(t){var e=this.createAndAttach("div",{class:"grid releases"});for(var s of t.data)e.createAndAttach("a",{href:`#discover:release:${s.id}`,class:"col-6 col-sm-4 col-md-3 col-lg-2"},[this.create("span",{class:"card"},[this.create("img",{src:s.thumbnail||"dist/img/missing-cover-art.webp"}),this.create("h4",null,[s.title])])])}renderNavigation(t){this.append(F.instantiate(this.api,this.request,t))}}W.register();const z=W,J=class extends O{constructor(t){super(t),this.noMore=!0}async fetchMore(t){return new Promise(((t,e)=>t({data:[]})))}};class Y extends R{static elementName="view-release";async render(){this.api.discover.releases.get(this.request.attributes.releaseId).getTracks().then((t=>{this.subRenderHeader(t),this.renderTracks(t)})),this.addEventListener("item-selected",this.onItemSelected.bind(this)),this.classList.add("release-view")}subRenderHeader(t){this.createAndAttach("div",{class:"release-view-header"},[this.create("img",{src:t.data.thumbnail||"dist/img/missing-cover-art.webp"}),this.create("div",{class:"release-view-label"},[this.create("h1",null,t.data.title),this.create("h3",null,this.create("a",{href:"#discover:releases?artist="+t.data.artist},t.data.artist))]),this.$refs.addButton=this.create("button",null,this.createAndAttach("span",{class:"fa fa-plus"}))]),this.$refs.addButton.addEventListener("click",this.addEntireRelease.bind(this))}addEntireRelease(){var t=[];this.querySelectorAll(q.elementName).forEach((e=>{t.push(e.item)})),this.fireEvent("item-to-add",{items:t})}async renderTracks(t){if(t.data.tracks)for(var e of t.data.tracks)this.append(q.instantiate({title:e,artist:t.data.artist,album:t.data.title}))}onItemSelected(t){var e=[];for(var s of this.querySelectorAll(q.elementName))e.push(s.item);for(var i in e)if(e[i]==t.detail.item){e=e.slice(i);break}var a=new J(this.api),r=V.instantiate(e,a);t.detail.queue=r}}Y.register();const K=Y;class Z extends G{static elementName="view-search";fetch(){return this.request.queryParams.isEmpty()?new Promise(((t,e)=>t({}))):this.api.collection.playlistItems.search(this.request.queryParams)}subRenderHeader(t){this.append(M.instantiate(this.request,"Search",[{type:"search",name:"title",placeholder:"Title",class:"main"},{type:"search",name:"artist",placeholder:"Artist"},{type:"search",name:"genre",placeholder:"Genre"}]))}subRenderButtonGroup(){}onItemSelected(t){var e=[];for(var s of this.querySelectorAll(q.elementName))e.push(s.item);for(var i in e)if(e[i]==t.detail.item){e=e.slice(i);break}var a=new D(this.api,this.request.queryParams),r=V.instantiate(e,a);t.detail.queue=r}}Z.register();const X=Z;class tt extends R{static elementName="view-discover";async render(){this.fetch().then((t=>{this.renderHeader(t),this.renderArtists(t)}))}fetch(){return this.request.queryParams.isEmpty()?new Promise(((t,e)=>t({data:[]}))):this.api.discover.artists.search(this.request.queryParams)}renderHeader(t){var e=M.instantiate(this.request,"Discover artist",[{type:"search",name:"name",placeholder:"name",class:"main"}]);this.append(e)}async renderArtists(t){var e=this.createAndAttach("div",{class:"grid artists"});for(var s of t.data)e.createAndAttach("a",{href:`#discover:releases?artist=${s.name}`,class:"col-6 col-sm-4 col-md-3 col-lg-2"},[this.create("span",{class:"card"},[s.thumbnail?this.create("img",{src:s.thumbnail}):null,this.create("h4",null,[s.name])])])}}tt.register();const et=tt;class st extends R{static elementName="not-found";async render(){this.createAndAttach("h1",null,"Not found"),this.createAndAttach("p",null,`Nothing found related to ${this.request.path}`)}}st.register();const it=st;var at=s(766),rt=s.n(at);class nt{constructor(t,e){this.path=t,this.queryParams=e,this.attributes={}}static createFromGlobals(){if(!location.hash)return new nt("",new URLSearchParams(""));var t=new URL(location.hash.replace("#","/"),"https://"+location.hostname);return new nt(t.pathname.replace(/^\//,"#"),new URLSearchParams(t.search))}}const lt=nt,ot=class extends Array{add(t){Array.isArray(t)?this.addMultiple(t):this.addSingle(t)}get theMostRecent(){return this.length?this[0]:null}get theOldest(){return this.length?this[this.length-1]:null}rewind(t=1){return this.splice(0,t)}addMultiple(t){this.splice(0,0,...t),console.log("History: multiple items added"),this.updatedCallback()}addSingle(t){this.splice(0,0,t),console.log("History: single item added"),this.updatedCallback()}updatedCallback(){console.log("history updated")}};class ht extends p{static elementName="queue-display";constructor(){super(),this.isOpen=!1}open(){this.isOpen=!0,this.classList.add("open")}close(){this.isOpen=!1,this.classList.remove("open")}toggle(){this.isOpen?this.close():this.open()}render(){this.classList.add("queue-display"),this.createAndAttach("div",{class:"queue-display__drawer"},this.$refs.content=this.create("div",{class:"queue-display__content"},[this.$refs.history=this.create("ol",{reversed:"reversed"}),this.create("hr"),this.$refs.queued=this.create("ol")]))}showQueue(t,e){this.$refs.history.clear(),this.$refs.queued.clear();for(var s=e.length-1;s>=0;s--)this.$refs.history.createAndAttach("li",null,this.create("div",{class:"ellipsis"},e[s].title));for(s=0;s<t.length;s++)this.$refs.queued.createAndAttach("li",null,this.create("div",{class:"ellipsis"},t[s].title)).addEventListener("click",(t=>{var e=[...this.$refs.queued.children].indexOf(t.target);this.fireEvent("queue:jump",{from:e,to:0})}))}}ht.register();const dt=ht;class ct extends p{static elementName="modal-window";__construct(t){this.api=t}render(){this.subRenderModal()}subRenderModal(){this.classList.add("modal"),this.createAndAttach("div",{class:"modal-dialog"},[this.create("div",{class:"modal-content"},[this.$refs.header=this.create("div",{class:"modal-header"},["header"]),this.$refs.body=this.create("div",{class:"modal-body"}),this.$refs.footer=this.create("div",{class:"modal-footer"},[this.$refs.closeButton=this.create("button",{class:"btn-danger"},"Close")])])]),this.$refs.closeButton.addEventListener("click",(()=>{this.remove()}))}}ct.register();const ut=ct;class pt extends ut{static elementName="modal-window-add-to-playlist";__construct(t,e){super.__construct(t),this.items=e}render(){super.render(),this.$refs.header.innerHTML="Add to playlist",this.api.collection.playlists.list().then((t=>{if(t.data)for(var e of(this.$refs.body.clear(),this.$refs.buttonGroup=this.$refs.body.createAndAttach("div",{class:"input-group input-group-vertical"}),t.data))this.$refs.buttonGroup.createAndAttach("button",{"data-playlist":e.id},e.title).addEventListener("click",this.onPlaylistChoosen.bind(this))}))}onPlaylistChoosen(t){var e,s=t.target.getAttribute("data-playlist"),i=[];for(var a of this.items)e=a.uuid?this.api.collection.playlistItems.create({playlist:s,uuid:a.uuid}):this.api.collection.playlistItems.create({playlist:s,title:a.title,artist:a.artist}),i.push(e);Promise.all(i).then((()=>{alert("Item added!!"),this.remove()}))}}pt.register();const mt=pt;class ft extends p{static elementName="messages-container";render(){this.classList.add("messages"),this.successes=this.createAndAttach("ul",{class:"successes hidden"}),this.warnings=this.createAndAttach("ul",{class:"warnings hidden"}),this.errors=this.createAndAttach("ul",{class:"errors hidden"})}messages(t){if(this.successes.clear().classList.add("hidden"),this.warnings.clear().classList.add("hidden"),this.errors.clear().classList.add("hidden"),t.successes)for(var e of(this.successes.classList.remove("hidden"),t.successes))this.successes.createAndAttach("li",null,e.title);if(t.errors)for(var e of(this.errors.classList.remove("hidden"),t.errors))this.errors.createAndAttach("li",null,e.title);if(t.warnings)for(var e of(this.warnings.classList.remove("hidden"),t.warnings))this.warnings.createAndAttach("li",null,e.title)}}ft.register();const gt=ft;class vt extends p{static elementName="text-field";__construct(t,e,s,i=""){this.name=t,this.label=e,this.value=s,this.placeholder=i}render(){var t=Math.floor(1e4*Math.random());this.classList.add("form-group"),this.createAndAttach("label",{class:"label col-sm-2",for:t},this.label),this.$refs.input=this.createAndAttach("input",{type:"text",class:"col-sm-10",id:t,name:this.name,value:this.value,placeholder:this.placeholder})}setValue(t){this.$refs.input.value=t}}vt.register();const yt=vt;class bt extends p{static elementName="text-area-field";__construct(t,e,s,i=""){this.name=t,this.label=e,this.value=s,this.placeholder=i}render(){var t=Math.floor(1e4*Math.random());this.classList.add("form-group"),this.createAndAttach("label",{class:"label col-sm-2",for:t},this.label),this.$refs.input=this.createAndAttach("textarea",{class:"col-sm-10",id:t,name:this.name,placeholder:this.placeholder}),this.$refs.input.value=this.value}setValue(t){this.$refs.input.value=t}}bt.register();const At=bt;class wt extends p{static elementName="multiple-text-field";__construct(t,e,s,i="",a="Add +"){this.name=t,this.label=e,this.value=s,this.placeholder=i,this.addButton=a}render(){this.classList.add("form-group"),this.createAndAttach("span",{class:"label col-sm-2"},this.label),this.createAndAttach("div",{class:"col-sm-10"},[this.$refs.body=this.create("div",{class:"input-group input-group-vertical"}),this.$refs.plusButton=this.create("small",{},this.addButton)]),this.$refs.plusButton.addEventListener("click",this.addBlank.bind(this)),this.setValue(this.value)}setValue(t){this.$refs.body.clear(),this.addValues(t)}addValues(t){for(var e of t=Array.isArray(t)?t:[t])this.add(e)}add(t=""){this.$refs.body.createAndAttach("input",{type:"text",placeholder:this.placeholder,class:"col-sm-12",name:this.name,value:t})}addBlank(){this.add("")}}wt.register();const Pt=wt;class Tt extends p{static elementName="form-element";render(){this.$refs.form=this.createAndAttach("form",{class:"vertical",method:"post",enctype:"multipart/form-data"})}setValue(t,e){return this.$refs[t]||console.error("No input named "+t),this.$refs[t].setValue(e),this}getForm(){return this.$refs.form}addHidden(t,e){return this.$refs[t]=this.$refs.form.createAndAttach("input",{type:"hidden",name:t,value:e})}addTextField(t,e,s,i=""){return this.$refs[t]=this.$refs.form.attach(yt.instantiate(t,e,s,i))}addTextArea(t,e,s,i=""){return this.$refs[t]=this.$refs.form.attach(At.instantiate(t,e,s,i))}addMultiTextField(t,e,s,i="",a="Add +"){return this.$refs[t]=this.$refs.form.attach(Pt.instantiate(t,e,s,i,a))}addSubmitButton(t="submit",e="Submit"){return this.$refs[t]=this.$refs.form.createAndAttach("div",{class:"form-group"},[this.create("input",{type:"submit",name:t,value:e,class:"col-12 btn-main"})])}}Tt.register();const $t=Tt;class Rt extends ut{static elementName="modal-form";__construct(){}render(){super.subRenderModal(),this.subRenderHeader(),this.subRenderForm(),this.subRenderSubmitListener()}subRenderHeader(){this.$refs.messages=this.$refs.body.attach(gt.instantiate())}subRenderForm(){this.$refs.form=this.$refs.body.attach($t.instantiate()),this.$refs.form.addTextField("title","Title",""),this.$refs.form.addSubmitButton("save","Save")}subRenderSubmitListener(){this.$refs.form.addEventListener("submit",(t=>{console.log("FORM SUBMITTED")}))}onResponse(t){this.$refs.messages.messages(t),t.successes&&t.successes.length&&(alert("FINISHED!"),this.remove())}}Rt.register();const Et=Rt;class Lt extends Et{static elementName="modal-add-item";__construct(t,e){this.api=t,this.playlistId=e}subRenderHeader(){super.subRenderHeader(),this.$refs.header.innerHTML="Add item"}subRenderForm(){this.$refs.form=this.$refs.body.attach($t.instantiate()),this.$refs.form.addTextField("title","Title",""),this.$refs.form.addTextField("album","Album",""),this.$refs.form.addMultiTextField("artist[]","Artist",[""],"Artist","Add artist"),this.$refs.form.addMultiTextField("featuring[]","Artist",[""],"Featuring","Add featured artist"),this.$refs.form.addTextField("cover","Cover",""),this.$refs.form.addMultiTextField("soundtrack[]","Soundtrack",[""],"Soundtrack","Add soundtrack"),this.$refs.form.addMultiTextField("genre[]","Genre",[""],"Genre","Add genre"),this.playlistId&&this.$refs.form.addHidden("playlist",this.playlistId||""),this.$refs.form.addSubmitButton("save","Save")}subRenderSubmitListener(){this.$refs.form.addEventListener("submit",(t=>{t.preventDefault(),this.api.collection.playlistItems.create(this.$refs.form.getForm()).then(this.onResponse.bind(this),this.onResponse.bind(this))}))}onResponse(t){this.$refs.messages.messages(t),t.successes&&t.successes.length&&(alert("Added!"),this.fireEvent("item-added"),this.remove())}}Lt.register();const St=Lt;class qt extends St{static elementName="modal-edit-item";__construct(t,e){this.api=t,this.uuid=e}render(){super.subRenderModal(),this.api.collection.playlistItems.get(this.uuid).read().then((t=>{this.subRenderHeader(),this.subRenderForm(t),this.subRenderSubmitListener()}))}subRenderHeader(){super.subRenderHeader(),this.$refs.header.innerHTML="Edit item"}subRenderForm(t){super.subRenderForm(),this.$refs.form.setValue("title",t.data.title||"").setValue("artist[]",t.data.artist||[""]).setValue("featuring[]",t.data.featuring||[""]).setValue("cover",t.data.cover||"").setValue("album",t.data.album||"").setValue("soundtrack[]",t.data.soundtrack||[""]).setValue("genre[]",t.data.genre||[""])}subRenderSubmitListener(){this.$refs.form.addEventListener("submit",(t=>{t.preventDefault(),this.api.collection.playlistItems.get(this.uuid).update(this.$refs.form.getForm()).then(this.onResponse.bind(this),this.onResponse.bind(this))}))}onResponse(t){this.$refs.messages.messages(t),t.successes&&t.successes.length&&(alert("Edited!"),this.fireEvent("item-updated"),this.remove())}}qt.register();const It=qt;class xt extends St{static elementName="modal-add-playlist";__construct(t){this.api=t}subRenderHeader(){super.subRenderHeader(),this.$refs.header.innerHTML="Edit playlist"}subRenderForm(){this.$refs.form=this.$refs.body.attach($t.instantiate()),this.$refs.form.addTextField("title","Title",""),this.$refs.form.addTextArea("description","Descrio",""),this.$refs.form.addSubmitButton("save","Save")}subRenderSubmitListener(){this.$refs.form.addEventListener("submit",(t=>{t.preventDefault(),this.api.collection.playlists.create(this.$refs.form.getForm()).then(this.onResponse.bind(this),this.onResponse.bind(this))}))}onResponse(t){this.$refs.messages.messages(t),t.successes&&t.successes.length&&(alert("Added!"),this.fireEvent("playlist-added"),this.remove())}}xt.register();const kt=xt;class _t extends kt{static elementName="modal-edit-playlist";__construct(t,e){this.api=t,this.playlistId=e}subRenderHeader(){super.subRenderHeader(),this.$refs.header.innerHTML="Edit playlist"}render(){super.subRenderModal(),this.api.collection.playlists.get(this.playlistId).read().then((t=>{this.subRenderHeader(),this.subRenderForm(t),this.subRenderSubmitListener()}))}subRenderForm(t){super.subRenderForm(),this.$refs.form.setValue("title",t.data.title||"").setValue("description",t.data.description||"")}subRenderSubmitListener(){this.$refs.form.addEventListener("submit",(t=>{t.preventDefault(),this.api.collection.playlists.get(this.playlistId).update(this.$refs.form.getForm()).then(this.onResponse.bind(this),this.onResponse.bind(this))}))}onResponse(t){this.$refs.messages.messages(t),t.successes&&t.successes.length&&(alert("Edited!"),this.fireEvent("item-updated"),this.remove())}}_t.register();const Nt=_t;class Mt extends p{static elementName="the-app";__construct(t){this.api=t,this.router=this.setUpRouter(t),this.showRunner=new class{constructor(t,e,s=null,i=null){this.app=t,this.api=e,this.history=i||new ot,this.setQueue(s||new V),this.app.addEventListener("item-selected",this.onItemSelected.bind(this)),this.app.addEventListener("player:ended",this.onPlayerEnded.bind(this)),this.app.addEventListener("controls:forward",this.forwardTheQueue.bind(this)),this.app.addEventListener("controls:backward",this.rewindTheQueue.bind(this)),this.app.addEventListener("queue:jump",this.onJumpLine.bind(this))}async onJumpLine(t){var{from:e,to:s}=t.detail,i=this.queue.move(e,s);0==s&&this.playItem(i)}async onItemSelected(t){var{item:e,queue:s}=t.detail;return console.log("-------------------------------"),console.log("Show runner: New item selected"),s?this.playNewQueue(s):this.jumpTheQueue(e)}async jumpTheQueue(t){return this.playItem(t)}async playNewQueue(t){var e=this.queue;return e.front&&this.addToHistory(e.front),this.setQueue(t),this.playItem(this.queue.front)}setQueue(t){this.queue=t,this.queue.updatedCallback=()=>{this.app.$refs.queueDisplay&&this.app.$refs.queueDisplay.showQueue(this.queue,this.history)},this.queue.updatedCallback()}async onPlayerEnded(t){return console.log("-------------------------------"),console.log("Show runner: song ended, next."),this.advanceTheQueue()}async rewindTheQueue(t){if(this.history.length){console.log("-------------------------------"),console.log("Show runner: rewinding queue.");var e=this.history.rewind(1)[0];return this.queue.dropIn(e),this.playItem(e)}}async forwardTheQueue(t){return console.log("-------------------------------"),console.log("Show runner: song skipped, next."),this.advanceTheQueue()}async advanceTheQueue(){return this.queue.getNextInLine().then((t=>{if(this.addToHistory(this.queue.front),this.queue.dequeue(),t)return this.playItem(t);console.log("Showrunner: Nothing else to play")}))}addToHistory(t){this.history.add(t)}async playItem(t){return this.findResourcesForMusicalItem(t).then((e=>{if(e.data.length)return this.app.playItem(t,e.data),e;alert("Show runner: Nothing found to play")}))}async findResourcesForMusicalItem(t){console.log("Show runner: searching for source to play");var e={};return t.title&&(e.title=t.title),t.soundtrack&&t.soundtrack.length?e.soundtrack=t.soundtrack:t.artist&&t.artist.length&&(e.artist=t.artist),this.api.discover.resources(e)}}(this,t)}render(){this.classList.add("app"),this.$refs.middle=this.createAndAttach("div",{class:"app-middle"},[this.$refs.navMenu=f.instantiate(this.api),this.$refs.stage=this.create("div",{class:"app-stage",id:"stage"}),this.$refs.queueDisplay=dt.instantiate()]),this.$refs.footer=this.createAndAttach("div",{class:"app-footer"},[this.$refs.controls=$.instantiate(this.api)]),this.router.setStage(this.$refs.stage),this.router.listenToChanges(),this.addEventListener("playlist-added",(()=>{this.$refs.navMenu.render()})),this.addEventListener("playlist-updated",(()=>{this.$refs.navMenu.render()})),this.addEventListener("item-to-add",(t=>{var e=mt.instantiate(this.api,t.detail.items);this.append(e)})),this.addEventListener("add-item",(t=>{var e=St.instantiate(this.api,t.detail.playlist);this.append(e)})),this.addEventListener("edit-item",(t=>{var e=It.instantiate(this.api,t.detail.uuid);this.append(e)})),this.addEventListener("delete-item",(t=>{confirm("Are you sure you want to remove it ?")&&(this.api.collection.playlistItems.get(t.detail.uuid).delete(),t.target.remove())})),this.addEventListener("download-playlists",(t=>{this.api.collection.playlists.downloadAll()})),this.addEventListener("add-playlist",(t=>{var e=kt.instantiate(this.api);this.append(e)})),this.addEventListener("edit-playlist",(t=>{var e=Nt.instantiate(this.api,t.detail.playlistId);this.append(e)})),this.addEventListener("delete-playlist",(t=>{confirm("Are you sure you want to delete the playlist ?")&&(this.api.collection.playlists.get(t.detail.playlist).delete().then((()=>{this.$refs.navMenu.render()})),window.location.hash="#home")})),this.addEventListener("summon-queue",(()=>{this.$refs.queueDisplay.toggle()}))}playItem(t,e){this.$refs.controls.destroyPlayer().remove(),this.$refs.controls=$.instantiate(this.api,t,e),this.$refs.footer.append(this.$refs.controls)}setUpRouter(t){var e=new class{constructor(t=null){this.stage=t,this.routes=[]}setStage(t){this.stage=t}listenToChanges(){window.addEventListener("hashchange",this.hashChanged.bind(this)),this.hashChanged()}hashChanged(t=null){var e,s=lt.createFromGlobals(),i=this.getMatchingRoute(s);i?(this.clearStage(),e=this.call(i,s),this.stageIt(e)):this.notFoundCallback&&(this.clearStage(),e=this.notFoundCallback(i,s),this.stageIt(e))}clearStage(){this.stage.querySelectorAll(":scope > *").forEach((t=>{t.remove()}))}stageIt(t){this.stage.append(t)}call(t,e){return t.callIt(e)}getMatchingRoute(t){for(var e of this.routes)if(e.doesItMatcheRequest(t))return e;return null}addRouter(t,e){return this.routes.push(new class{constructor(t,e){this.patterns=Array.isArray(t)?t:[t],this.callback=e}callIt(t){var e,s=this.getMatchingPattern(t.path).exec(t.path).groups;return t.attributes=s||{},"string"==typeof this.callback?e=document.createElement(this.callback):rt().isA(this.callback,p)?e=this.callback.instantiate.apply(this.callback,s??[]):"function"==typeof this.callback&&(e=this.callback.apply(this,[t])),e}doesItMatcheRequest(t){return!!this.getMatchingPattern(t.path)}getMatchingPattern(t){for(var e of this.patterns)if(t.match(e))return e;return null}}(t,e)),this}};return e.addRouter([/^$/,/home$/],(function(e){return L.instantiate(e,t)})).addRouter(/playlist:(?<playlistId>[\w\d\-]+)$/,(function(e){return G.instantiate(e,t)})).addRouter(/playlist:(?<playlistId>[\w\d\-]+)\/edit/,(function(e){return ViewEditPlaylist.instantiate(e,t)})).addRouter(/search/,(function(e){return X.instantiate(e,t)})).addRouter(/discover:artist/,(function(e){return et.instantiate(e,t)})).addRouter(/discover:releases$/,(function(e){return z.instantiate(e,t)})).addRouter(/discover:release:(?<releaseId>.+)/,(function(e){return K.instantiate(e,t)})).addRouter(/playlist\/create/,(function(e){return ViewAddPlaylist.instantiate(e,t)})).notFoundCallback=function(e,s){return it.instantiate(s,t)},e}}Mt.register();const Ct=Mt;class Ft{constructor(t,e=null,s=[]){this.elementName=t,this.attributes=e,this.children=Array.isArray(s)?s:[s]}create(){var t=document.createElement(this.elementName);for(var e in this.attributes)t.setAttribute(e,this.attributes[e]);for(var s of this.children)null!=s&&("string"==typeof s?s=document.createTextNode(s):"object"==typeof s&&s.elementName&&(s=Ft.createFromObject(s)),t.append(s));return t}static createFromObject(t){var{elementName:e,attributes:s,children:i}=t;return new Ft(e,s,i).create()}}const Ht=Ft;HTMLElement.prototype.attach=function(t){return this.append(t),t},HTMLElement.prototype.create=function(t,e=null,s=[]){return new Ht(t,e,s).create()},HTMLElement.prototype.createAndAttach=function(t,e=null,s=[]){return this.attach(this.create(t,e,s))},HTMLElement.prototype.clear=function(){var t=Array.from(this.children);for(var e of t)e.remove();return this},URLSearchParams.prototype.without=function(t){var e=new URLSearchParams(this.toString());return e.delete(t),e},URLSearchParams.prototype.withAdded=function(t,e){var s=new URLSearchParams(this.toString());return s.append(t,e),s},URLSearchParams.prototype.isEmpty=function(){return 0==this.toString().length};const Bt=new class{constructor(t){var s=new c({baseHref:t,headers:{"Content-Type":"application/json"}});this.collection=new class{constructor(t){this.artists=new e(t),this.playlists=new a(t),this.playlistItems=new n(t)}}(s),this.discover=new d(s)}}(window.playerSettings.backEndBaseUrl);window.app=Ct.instantiate(Bt),window.api=Bt,document.addEventListener("DOMContentLoaded",(()=>{document.body.append(window.app)}))})()})();