(()=>{var t={978:(t,e,s)=>{t.exports=s(411)},781:(t,e,s)=>{const i=s(923);class a{static toObject(t){var e,s,r;return"Object"==t.constructor.name?t:t instanceof FormData?i.formDataToObject(t):t instanceof HTMLFormElement?(e=new FormData(t),i.formDataToObject(e)):t instanceof URL?i.queryStringToObject(t.search):t instanceof URLSearchParams?i.searchParamsToObject(t):i.isValidJson(t)?JSON.parse(t):(r=(s=i.stringToUrl(t))&&s.search?new URLSearchParams(s.search):new URLSearchParams(t),a.emptySearchParams(r)?null:i.searchParamsToObject(r))}static toJson(t){var e;return i.isValidJson(t)?t:(e=a.toObject(t),JSON.stringify(e))}static toFormData(t){var e;return t instanceof FormData?t:t instanceof HTMLFormElement?new FormData(t):(e=a.toObject(t),i.objectToFormData(e))}static emptySearchParams(t){for(var e of t.values())if(e)return!1;return!0}}t.exports=a},923:(t,e,s)=>{const i=s(26),a=s(15);class r{static stringToUrl(t){if(a.isAbsolute(t))return new URL(t);var e;const s="/"==t.slice(0,1),r=a.getBaseHref();return s?((e=new URL(r)).pathname=t,e.placeholder=e.toString().replace(t,"")):(e=new URL(r+i.ltrim(t,"/"))).placeholder=r,e}static urlToString(t){var e=t.toString();return t.placeholder&&(e=e.replace(t.placeholder,"")),e}static searchParamsToObject(t){var e={};for(var[s,a]of t.entries()){var n=-1==s.indexOf("[")?[s]:i.rtrim(s,"]").split(/\]?\[/);r.addPropertyToObject(e,n,a)}return e}static addPropertyToObject(t,e,s){var i=e.pop();for(var a of e)void 0===t[a]&&(t[a]=isNaN(a)?{}:[]),t=t[a];t[i]=s}static objectToSearchParams(t){var e=new URLSearchParams;for(var s in t)r.addToSearchparam(e,s,t[s]);return e}static addToSearchparam(t,e,s){if(Array.isArray(s)||"object"==typeof s)for(var i in s)r.addToSearchparam(t,e+"["+i+"]",s[i]);else t.set(e,s)}static objectToFormData(t){var e=new FormData;for(var s in t)r.addToSearchparam(e,s,t[s]);return e}static formDataToObject(t){return r.searchParamsToObject(t)}static objectToQueryString(t){return r.objectToSearchParams(t).toString()}static queryStringToObject(t){var e=new URLSearchParams(t);return r.searchParamsToObject(e)}static isValidJson(t){if("string"!=typeof t)return!1;try{JSON.parse(t)}catch(t){return!1}return!0}}t.exports=r},26:t=>{class e{static ltrim(t,e=null){e=e||"[ \t\n\r\0\v]";var s=new RegExp("^"+e+"+");return t.replace(s,"")}static rtrim(t,e=null){e=e||"[ \t\n\r\0\v]";var s=new RegExp(e+"+$");return t.replace(s,"")}static trim(t,s=" "){return t=e.ltrim(t,s),e.rtrim(t,s)}}t.exports=e},15:(t,e,s)=>{const i=s(26);class a{static getBaseHref(){return a.getDocumentBaseHref()??a.getWindowLocationBaseHref()}static getWindowLocationBaseHref(){const t=window.location;var e;return e="/"==t.pathname.slice(-1)?t.protocol+"//"+t.host+t.pathname:t.pathname.match(/\.[\w]{2,4}$/)?t.protocol+"//"+t.host+t.pathname.replace(/\/[^\/]+$/,""):t.protocol+"//"+t.host+t.pathname,i.rtrim(e,"/")+"/"}static getDocumentBaseHref(){const t=document.querySelector("base");if(!t)return null;const e=t.getAttribute("href");return e?i.rtrim(e,"/")+"/":null}static isAbsolute(t){return t instanceof URL||"http"==t.substr(0,4)}static isRelative(t){return!a.isAbsolute(t)}}t.exports=a},411:(t,e,s)=>{const i=s(923),a=s(781),r=s(15),n=s(26);class h{defaultOptions={};constructor(t={}){null!=t.baseHref&&(t.baseHref=n.rtrim(t.baseHref,"/")+"/"),this.defaultOptions=t}async fetch(t,e={}){return e.method||(e.method="get"),this.request(t,e)}async get(t,e={}){return e.method="get",this.request(t,e)}async post(t,e={}){return e.method="post",this.request(t,e)}async put(t,e={}){return e.method="put",this.request(t,e)}async delete(t,e={}){return e.method="delete",this.request(t,e)}async options(t,e={}){return e.method="options",this.request(t,e)}async patch(t,e={}){return e.method="patch",this.request(t,e)}static createRequest(t,e){return"string"==typeof t&&(t=r.isRelative(t)?new URL(t,e.baseHref||r.getBaseHref()):new URL(t)),null==e.headers&&(e.headers={}),e.queryParams&&(t=h.addToQueryString(t,e.queryParams),e.queryParams=void 0),"get"==e.method&&e.body?(t=h.addToQueryString(t,e.body),e.body=void 0):e.body&&(e.body="application/json"==h.getHeader(e.headers,"Content-Type")?a.toJson(e.body):a.toFormData(e.body)),h.clearUpOptions(e),new Request(t,e)}static clearUpOptions(t){for(var e in t)void 0===t[e]&&delete t[e];if(t.headers)for(var s in t.headers)void 0===t.headers[s]&&delete t.headers[s]}async request(t,e={}){e={...this.defaultOptions,...e};var s=h.createRequest(t,e);return fetch(s)}static addToQueryString(t,e){var s;e=a.toObject(e);var r=t instanceof URL;for(var n in s=(t=r?t:i.stringToUrl(t)).search?new URLSearchParams(t.search):new URLSearchParams,e)i.addToSearchparam(s,n,e[n]);return t.search=s.toString(),r?t:i.urlToString(t)}static getHeader(t,e){e=e.toLowerCase();for(let s in t)if(s.toLocaleLowerCase()==e)return t[s];return null}}t.exports=h}},e={};function s(i){var a=e[i];if(void 0!==a)return a.exports;var r=e[i]={exports:{}};return t[i](r,r.exports,s),r.exports}(()=>{"use strict";const t=class{constructor(t){this.httpClient=t}async apiCall(t,e,s=void 0,i=void 0,a=void 0){return new Promise(((r,n)=>{this.request(t,e,s,i,a).then((t=>t.json().then((e=>{t.status<400?r(e):n(e)}))))}))}request(t,e,s=void 0,i=void 0,a=void 0){var r,n={body:s,queryParams:i};switch(a&&(n={...n,...a}),t){case"post":r=this.httpClient.post(e,n);break;case"put":r=this.httpClient.put(e,n);break;case"delete":r=this.httpClient.delete(e,n);break;case"get":r=this.httpClient.get(e,n)}return r}},e=class extends t{list(){return this.apiCall("get","api/v1/collection/artists")}},i=class extends t{constructor(t,e){super(t),this.playlistId=e}read(){return this.apiCall("get","api/v1/collection/playlists/"+this.playlistId)}download(){var t=new URL("api/v1/collection/playlists/"+this.playlistId+"?download=1",this.httpClient.defaultOptions.baseHref);window.open(t.toString(),"_blank")}getItems(t=null){return this.apiCall("get","api/v1/collection/playlists/"+this.playlistId+"/items",null,t)}update(t){return this.apiCall("put","api/v1/collection/playlists/"+this.playlistId,t,null,{headers:{"Content-Type":void 0}})}delete(){return this.apiCall("delete","api/v1/collection/playlists/"+this.playlistId)}},a=class extends t{list(){return this.apiCall("get","api/v1/collection/playlists")}downloadAll(){var t=new URL("api/v1/collection/playlists?download=1",this.httpClient.defaultOptions.baseHref);window.open(t.toString(),"_blank")}create(t){return this.apiCall("post","api/v1/collection/playlists",t,null,{headers:{"Content-Type":void 0}})}get(t){return new i(this.httpClient,t)}},n=class extends t{constructor(t,e){super(t),this.uuid=e}read(){return this.apiCall("get","api/v1/collection/items/"+this.uuid)}update(t){return this.apiCall("put","api/v1/collection/items/"+this.uuid,t,null,{headers:{"Content-Type":void 0}})}delete(){return this.apiCall("delete","api/v1/collection/items/"+this.uuid)}},h=class extends t{search(t){return this.apiCall("get","api/v1/collection/items",null,t)}create(t){return this.apiCall("post","api/v1/collection/items",t,null,{headers:{"Content-Type":void 0}})}get(t){return new n(this.httpClient,t)}},o=class extends t{search(t){return this.apiCall("get","api/v1/discover/albums",null,t)}get(t,e){return this.apiCall("get","api/v1/discover/album",null,{artist:t,title:e})}},l=class extends t{search(t){return this.apiCall("get","api/v1/discover/artists",null,t)}},d=class extends t{constructor(t){super(t),this.albums=new o(t),this.artists=new l(t)}resources(t){return this.apiCall("get","api/v1/discover/resources",null,t)}},c=s(978);class u extends HTMLElement{__construct(t=null,e=null){}connectedCallback(){this.attached||(this.attached=!0,this.renderLifeCycle())}renderLifeCycle(){this.beforeRender(),this.render(),this.afterRender()}refresh(){this.clear(),this.renderLifeCycle()}beforeRender(){}render(){this.innerHTML="inner html"}afterRender(){}once(t,e,s){var i="data-once-"+t;this.hasAttribute(i)||(this.setAttribute(i,"1"),this.addEventListener(e,s))}static elementName="base-element";static register(){customElements.get(this.elementName)||customElements.define(this.elementName,this)}static instantiate(...t){if(!customElements.get(this.elementName))throw`Register this garbage <${this.elementName}> damn you, you forgot to register it! Call .register() !!`;var e=document.createElement(this.elementName);return e.__construct(...t),e}fireEvent(t,e=null,s=!0){var i={bubbles:s};null!=e&&(i.detail=e);var a=new CustomEvent(t,i);return this.dispatchEvent(a)}constructor(){super(),this.$refs={},this.attached=!1}}const p=u;class m extends p{static elementName="app-navigation";__construct(t){this.api=t}render(){this.clear(),this.classList.add("app-navigation"),this.addGenericNavItem("#home","Home","fa-home"),this.addGenericNavItem("#search","Search","fa-search"),this.addGenericNavItem("#discover:artist","Discover","fa fa-search-plus"),this.createAndAttach("hr"),this.$refs.playlists=this.createAndAttach("div",{class:"app-navigation__playlists"}),this.createAndAttach("hr"),this.$refs.artists=this.createAndAttach("div",{class:"app-navigation__artists"}),this.updatePlaylists(),this.updateArtists()}updatePlaylists(){this.api.collection.playlists.list().then((t=>{if(t.data)for(var e of t.data)this.addPlaylistNavItem(e.id,e.title);this.$refs.playlists.createAndAttach("div",{class:"input-group input-group-horizontal"},[this.$refs.createPlaylist=this.create("button",{title:"Create playlist"},this.create("span",{class:"fa fa-plus-circle"})),this.$refs.downloadPlaylists=this.create("button",{title:"Download playlist"},this.create("span",{class:"fa fa-download"}))]),this.$refs.createPlaylist.addEventListener("click",(()=>{this.fireEvent("collection:intention:compose-new-playlist")})),this.$refs.downloadPlaylists.addEventListener("click",(()=>{this.fireEvent("collection:intention:download")}))}))}updateArtists(){this.api.collection.artists.list().then((t=>{for(var e in t.data)this.addArtistNavItem(e,t.data[e])}))}addArtistNavItem(t,e){this.$refs.artists.createAndAttach("div",{class:"app-navigation__item"},this.create("a",{href:"#search?artist="+t,title:t},[this.create("span",{class:"label"},t),this.create("span",{class:"badge"},e)]))}addPlaylistNavItem(t,e){this.$refs.playlists.createAndAttach("div",{class:"app-navigation__item"},[this.create("a",{href:`#playlist:${t}`,class:"ellipsis",title:e},e)])}addGenericNavItem(t,e,s=null){var i=this.createGenericNavItem(t,e,s);return this.append(i),i}createGenericNavItem(t,e,s=null){var i,a;return i=this.createAndAttach("div",{class:"app-navigation__item"}),(a=null!=t?i.createAndAttach("a",{href:t}):i.createAndAttach("a")).setAttribute("title",e),s&&a.createAndAttach("span",{class:"fa "+s}),a.append(e),i}}m.register();const f=m;class b extends HTMLElement{constructor(){super(),this.state={isPaused:!1,isPlaying:!1,isReproducing:!1,isBuffering:!1,isWaiting:!1,isEnded:!1,volume:100}}appendTo(t){return t.append(this),new Promise((async(t,e)=>t()))}prependTo(t){return t.prepend(this),new Promise((async(t,e)=>t()))}appendAfter(t){return t.after(this),new Promise((async(t,e)=>t()))}get isPaused(){return this.state.isPaused}get isPlaying(){return this.state.isPlaying}get isReproducing(){return this.state.isReproducing}get isWaiting(){return this.state.isWaiting}get isBuffering(){return this.state.isBuffering}get isEnded(){return this.state.isEnded}get volume(){return this.state.volume}get currentTime(){}get currentTimeFormatted(){return b.secondsToStringRepresentation(this.currentTime)}get currentTimePercentage(){var t,e;return t=Math.round(this.currentTime),e=Math.round(this.duration),isNaN(t)||isNaN(e)||0==t||0==e?0:t/e*100}get remainingTime(){return this.duration-this.currentTime}get remainingTimeFormatted(){return b.secondsToStringRepresentation(this.remainingTime)}get remainingTimePercentage(){return 100-this.currentTimePercentage}get duration(){}get durationFormatted(){return b.secondsToStringRepresentation(this.duration)}getTime(t){return Math.round(this.duration/100*t)}getTimeFormatted(t){return b.secondsToStringRepresentation(this.getTime(t))}getPercentage(t){return("string"==typeof t&&t.indexOf(":")>=0?b.stringRepresentationToSeconds(t):parseFloat(t))/this.duration*100}seek(t){}play(t=null){}pause(){}toggle(){this.isPlaying?this.pause():this.play()}sanitizeGetSeconds(t){var e;return e="string"==typeof t&&t.indexOf(":")>=0?b.stringRepresentationToSeconds(t):"string"==typeof t&&t.indexOf("%")>=0?this.getTime(parseInt(t)):"string"==typeof t?parseInt(t):t,isNaN(e)&&(e=0),e}fireEvent(t,e,s=!0){var i={bubbles:s};null!=e&&(i.detail=e);var a=new CustomEvent(t,i);return this.dispatchEvent(a)}log(t){console.log(t)}static secondsToStringRepresentation(t){return isNaN(t)?"00:00":(t=Math.round(t),n=(a=(a=(s=Math.floor(t/60))-60*(e=Math.floor(s/60)))<10?"0"+a:a)+":"+(r=(r=t-60*s)<10?"0"+r:r),n=(i=e)>0?i+":"+n:n);var e,s,i,a,r,n}static stringRepresentationToSeconds(t){var e,s,i;return!((e=t.match(/[0-9]+/g)).length>3)&&(i=parseInt(e[e.length-1]),s=parseInt(e[e.length-2]||0),3600*parseInt(e[e.length-3]||0)+60*s+i)}}const g=b,v=class{static async loadExternalJs(t,e=null){return new Promise((async function(s,i){var a;(a=document.createElement("script")).async=!0,a.type="text/javascript",a.onload=function(t){s("SCRIPT: loaded")},a.onerror=function(t){i("SCRIPT: failed to load")},a.src=t,(e=e||document.body).appendChild(a)}))}};class y extends g{static sdkLoaded=!1;static sdkLoading=!1;static sdkPromise=null;static defaults={width:640,height:"auto",autoplay:!1};constructor(){super(),this.state.currentTime=0,this.state.playerInitialized=!1;var t={embbedId:"youtube-embbed-"+Math.floor(1e4*Math.random()),id:null};this.settings={...y.defaults,...t},this.html={},this.follower=null}connectedCallback(){var t,e,s,i,a;if(!this.html.embed)return this.html.embed=this.createDiv(this.settings.embbedId,this),(t=this.getAttribute("src"))&&(this.src=t),(e=this.getAttribute("video-id"))&&(this.videoId=e),(s=this.getAttribute("width"))&&(this.width=s),(i=this.getAttribute("height"))&&(this.height=i),(a=this.getAttribute("autoplay"))&&(this.autoplay=["true","1"].includes(a)),this.readyToPlayPromise=y.loadSdk().then((()=>this.initializePlayer()))}remove(){this.html.ytWidget&&this.html.ytWidget.destroy(),super.remove()}appendTo(t){return t.append(this),this.readyToPlayPromise}prependTo(t){return t.prepend(this),this.readyToPlayPromise}appendAfter(t){return t.after(this),this.readyToPlayPromise}set src(t){this.settings.id=y.getIdFromUrl(t)}set videoId(t){this.settings.id=t}set width(t){this.settings.width=t,this.updateDimensions()}set height(t){this.settings.height=t,this.updateDimensions()}set autoplay(t){this.settings.autoplay=t}calculateDimensions(){var t,e,s=this.settings.width,i=this.settings.height;return"auto"==s?t=this.parentNode.offsetWidth>400?400:this.parentNode.offsetWidth:"string"==typeof s&&s.indexOf("%")>-1?(t=parseInt(s),t=parseInt(this.parentNode.offsetWidth/100*t)):t=s,"auto"==i?e=parseInt(t/1.77):"string"==typeof i&&i.indexOf("%")>-1?(e=parseInt(i),e=parseInt(this.parentNode.offsetHeight/100*e)):e=i,{actualWidth:t,actualHeight:e}}updateDimensions(){if(this.html.ytWidget){var t=this.html.ytWidget.getIframe(),{actualWidth:e,actualHeight:s}=this.calculateDimensions();t.style.width=e+"px",t.style.height=s+"px"}}get currentTime(){return this.state.currentTime}get duration(){return this.html.ytWidget&&this.html.ytWidget.getDuration?this.html.ytWidget.getDuration():0}seek(t){if(!this.state.playerInitialized)return!1;var e=this.sanitizeGetSeconds(t);this.html.ytWidget.seekTo(e,!0)}play(t=null){return t&&this.seek(t),new Promise(((t,e)=>this.state.playerInitialized?(this.html.ytWidget.playVideo(),t()):e("Player has not been initialized")))}pause(){if(!this.state.playerInitialized)return!1;this.html.ytWidget.pauseVideo()}setVolume(t){this.state.volume=t,this.state.playerInitialized&&this.html.ytWidget.setVolume(t)}async initializePlayer(){return new Promise((async(t,e)=>{var{actualWidth:s,actualHeight:i}=this.calculateDimensions();this.html.ytWidget=new YT.Player(this.settings.embbedId,{width:s,height:i,videoId:this.settings.id,startSeconds:0,playerVars:{autoplay:this.settings.autoplay,controls:0},events:{onReady:e=>{t(this),this.setVolume(this.volume),this.state.playerInitialized=!0},onError:t=>{var s=y.getErrorDescription(t.data);e(s),this.fireEvent("player:error",{errorCode:t.data,errorMessage:s})},onStateChange:this.callBackOnStateChange.bind(this)}})}))}callBackOnStateChange(t){switch(t.data){case-1:this.state.isReproducing=!1,this.state.isPlaying=!1,this.state.isPaused=!1;break;case 0:this.state.isReproducing=!1,this.state.isPlaying=!1,this.state.isPaused=!0,this.state.isWaiting=!1,this.state.isEnded=!0,this.stopFollowing(),this.fireEvent("player:ended");break;case 1:var e=this.state.isWaiting;this.state.isReproducing=!0,this.state.isPlaying=!0,this.state.isPaused=!1,this.state.isBuffering=!1,this.state.isWaiting=!1,this.state.isEnded=!1,this.startFollowing(),e?this.fireEvent("player:playing"):this.fireEvent("player:play");break;case 2:this.state.isReproducing=!1,this.state.isPlaying=!1,this.state.isPaused=!0,this.state.isWaiting=!1,this.fireEvent("player:pause");break;case 3:this.state.isReproducing=!1,this.state.isPlaying=!0,this.state.isPaused=!1,this.state.isBuffering=!0,this.state.isWaiting=!0,this.fireEvent("player:waiting");break;case 5:this.play(0),this.fireEvent("player:play")}}startFollowing(){this.follower=setInterval(this.following.bind(this),1e3)}stopFollowing(){clearInterval(this.follower)}following(){var t=this.html.ytWidget&&this.html.ytWidget.getCurrentTime?this.html.ytWidget.getCurrentTime():0;t!=this.currentTime&&(this.state.currentTime=t,this.fireEvent("player:timeupdate"))}static getErrorDescription(t){switch(t){case"2":return"Error 2: invalid parameters.";case"5":return"Error 5: An error related to the HTML5 player occurred.";case"100":return"Error 100: Video not found.";case"101":case"150":return"Error 101: The video's owner won't allow it on embbed players."}return"Error "+t+": Unknown error"}static getIdFromUrl(t){var e;return(e=t.match(/v=([A-Za-z0-9-_]+)/))||(e=t.match(/\.be\/([A-Za-z0-9-_]+)/))||(e=t.match(/embed\/([A-Za-z0-9-_]+)/))?e[1]:null}static async loadSdk(){return y.sdkLoaded?new Promise((async(t,e)=>{t()})):y.sdkDefined()?(y.sdkLoaded=!0,new Promise((async(t,e)=>{t()}))):y.sdkLoading?y.sdkPromise:(y.sdkLoading=!0,y.sdkPromise=new Promise((async(t,e)=>{v.loadExternalJs("https://www.youtube.com/iframe_api").then(y.loadSdkSuccess(t),y.loadSdkFail(e))})))}static sdkDefined(){return"undefined"!=typeof YT&&void 0!==YT.Player}static loadSdkSuccess(t){return()=>{y.waiter=setInterval((()=>{if(y.sdkDefined())return y.sdkLoaded=!0,clearInterval(y.waiter),y.sdkLoading=!1,t("YouTube SDK ready")}),500)}}static loadSdkFail(t){return()=>(y.sdkLoading=!1,t("Error loading SDK"))}createDiv(t,e){var s=document.createElement("div");return s.id=t,e.append(s),s}}const A=y;class w extends p{static elementName="float-menu-item";__construct(t,e,s,i){this.title=t,this.helpText=e,this.icon=s,this.onClick=i}render(){this.classList.add("float-menu__item"),this.$refs.body=this.createAndAttach("div",{title:this.helpText},this.title),this.addEventListener("click",(t=>{t.stopPropagation(),this.onClick(),this.fireEvent("float-menu-item:selected")}))}}w.register();const $=w;class R extends p{static elementName="float-menu";__construct(t={}){this.menuActions=t,this.opened=!1,this.addEventListener("float-menu-item:selected",this.close.bind(this)),window.document.addEventListener("float-menu:opened",this.closeAndRemove.bind(this)),window.document.addEventListener("click",this.closeAndRemove.bind(this))}closeAndRemove(t){t.detail.menu&&t.detail.menu==this||this.close().remove()}render(){this.classList.add("float-menu"),this.$refs.list=this.createAndAttach("div",{class:"float-menu__list"}),this.opened&&this.subRenderItems()}subRenderItems(){for(var t in this.menuActions){var e=this.menuActions[t];this.$refs.list.append($.instantiate(e.title,e.helpText,e.icon,e.onClick))}}open(t,e=0,s=0){var i,a,r,n;return t.menuOpened=this,this.opened=!0,this.refresh(),r=this.$refs.list.offsetWidth,n=this.$refs.list.offsetHeight,i=e+r>window.innerWidth?window.innerWidth-r:e,a=s+n>window.innerHeight?window.innerHeight-n:s,this.style.left=i+"px",this.style.top=a+"px",this.fireEvent("float-menu:opened",{menu:this}),this}close(){return this.opened=!0,this.clear(),this.fireEvent("float-menu:closed"),this}addMenuItem(t,e,s,i,a){return this.menuItems[t]={title:e,helpText:s,icon:i,onClick:a},this}}R.register();const T=R;class E extends p{static elementName="playlist-item";__construct(t={},e={}){E.sanitizeItem(t),this.item=t,this.options=e,this.actions=this.getContextActions()}render(){this.innerHTML="",this.classList.add("playlist-item"),this.subRenderHeader(),this.subRenderBody(),this.subRenderFooter()}subRenderHeader(){this.options.disablePlayButton||(this.$refs.header=this.createAndAttach("div",{class:"playlist-item__header"},[this.$refs.playButton=this.create("button",null,this.createAndAttach("span",{class:"fa fa-play"}))]),this.$refs.playButton.addEventListener("click",(()=>{this.fireEvent("queue:item-selected",{item:this.item})})))}subRenderBody(){for(var t of(this.$refs.body=this.createAndAttach("div",{class:"playlist-item__body"}),this.item.title&&(this.$refs.title=this.$refs.body.createAndAttach("span",{class:"playlist-item__title"},[this.item.title])),this.item.artist))this.$refs.body.createAndAttach("span",{class:"playlist-item__artist playlist-item__info"},[this.create("a",{href:`#search?artist=${t}`,title:t},t)," ",this.create("a",{href:`#discover:albums?artist=${t}`,title:`Search ${t}`},this.createAndAttach("span",{class:"fa fa-search"}))]);for(var e of this.item.soundtrack)this.$refs.body.createAndAttach("span",{class:"playlist-item__soundtrack playlist-item__info"},[this.create("a",{href:`#search?soundtrack=${e}`,title:e},e)])}subRenderFooter(){this.$refs.footer=this.createAndAttach("div",{class:"playlist-item__footer"}),this.addEventListener("contextmenu",(t=>{t.preventDefault(),this.openContextMenu(t)})),this.$refs.popupButton=this.$refs.footer.createAndAttach("button",null,this.create("span",{class:"fa fa-ellipsis-v"})),this.$refs.popupButton.addEventListener("click",(t=>{t.stopPropagation(),this.openContextMenu(t)}))}getContextActions(){var t={addToPlaylist:{title:"Add to playlist",helpText:"choose a playlist",icon:"fa-plus",onClick:()=>{this.fireEvent("item:intention:add-to-collection",{items:[this.item]})}}};return t.playNext={title:"Play next",helpText:"play next",icon:"fa-minus",onClick:()=>{this.fireEvent("queue:intention:play-it-next",{item:this.item})}},this.item.uuid?(t.editItem={title:"Edit item",helpText:"",icon:"fa-pencil",onClick:()=>{this.fireEvent("item:intention:edit",{uuid:this.item.uuid})}},t.removeItem={title:"Remove item",helpText:"",icon:"fa-times",onClick:()=>{this.fireEvent("item:intention:delete",{uuid:this.item.uuid})}},t):t}openContextMenu(t){var e=T.instantiate(this.actions);this.append(e),e.open(t,t.clientX,t.clientY)}static sanitizeItem(t){t.artist?t.artist=Array.isArray(t.artist)?t.artist:[t.artist]:t.artist=[],t.soundtrack?t.soundtrack=Array.isArray(t.soundtrack)?t.soundtrack:[t.soundtrack]:t.soundtrack=[]}}E.register();const L=E,P=class{constructor(t,e=null){this.name=t,this.data=e||this.retrieve()}get(t,e=null){return null==this.data[t]?e:this.data[t]}getInt(t,e=0){return parseInt(this.get(t,e))}set(t,e){this.data[t]=e,this.save()}save(){var t=JSON.stringify(this.data);localStorage.setItem(this.name,t)}retrieve(){var t=localStorage.getItem(this.name);return t?JSON.parse(t):{}}};customElements.define("player-youtube",A),customElements.define("player-audio",class extends g{constructor(){super(),this.settings={src:null}}connectedCallback(){this.mediaP||(this.mediaP=this.createMedia(),this.mediaP.src=this.settings.src,this.append(this.mediaP),this.mediaP.addEventListener("play",(t=>{this.state.isPaused=!1,this.state.isPlaying=!0,this.state.isWaiting=!1,this.fireEvent("player:play")})),this.mediaP.addEventListener("pause",(t=>{this.state.isPlaying=!1,this.state.isPaused=!0,this.state.isReproducing=!1,this.fireEvent("player:pause")})),this.mediaP.addEventListener("timeupdate",(t=>{this.state.isReproducing=!0,this.state.isEnded=!1,this.fireEvent("player:timeupdate")})),this.mediaP.addEventListener("ended",(t=>{this.state.isPlaying=!1,this.state.isPaused=!0,this.state.isReproducing=!1,this.state.isWaiting=!1,this.state.isEnded=!0,this.fireEvent("player:ended")})),this.mediaP.addEventListener("error",(t=>{this.fireEvent("player:error",{errorCode:0,errorMessage:"Resource could not be loaded"})})),this.mediaP.addEventListener("loadstart",(t=>{this.state.isBuffering=!0})),this.mediaP.addEventListener("progress",(t=>{this.state.isBuffering=!0})),this.mediaP.addEventListener("waiting",(t=>{this.state.isReproducing=!1,this.state.isBuffering=!0,this.state.isWaiting=!0,this.fireEvent("player:waiting")})),this.mediaP.addEventListener("playing",(t=>{this.state.isWaiting=!1,this.fireEvent("player:playing")})),this.mediaP.addEventListener("canplaythrough",(t=>{this.state.isBuffering=!1,this.state.isWaiting=!1})),this.mediaP.addEventListener("canplay",(t=>{this.state.isBuffering=!1,this.state.isWaiting=!1})),this.mediaP.addEventListener("suspend",(t=>{this.state.isBuffering=!1})),this.mediaP.addEventListener("abort",(t=>{this.state.isBuffering=!1})),this.mediaP.addEventListener("stalled",(t=>{this.state.isBuffering=!1})))}set src(t){this.settings.src=t}get currentTime(){return this.mediaP.currentTime}get duration(){return this.mediaP.duration}play(t=this.currentTime){return this.seek(t),this.mediaP.play()}pause(){this.mediaP.pause()}seek(t){var e=this.sanitizeGetSeconds(t);this.mediaP.currentTime=e}setVolume(t){this.state.volume=t;var e=t>0?t/100:t;this.mediaP.volume=e}createMedia(){return new Audio}});class k extends p{static elementName="reproduction-controls";__construct(t,e=null,s=null,i=!0){this.api=t,this.item=e,this.resources=s,this.index=0,this.player=null,this.state=new P("controls.state"),this.autoPlay=i}render(){this.classList.add("reproduction-controls"),this.subRenderItem(),this.subRenderClock(),this.subRenderButtons(),this.subRenderVolume(),this.subRenderQueueButton(),this.subRenderProgressBar(),this.$refs.playerFrame=this.createAndAttach("div",{class:"player-frame intangible"}),this.resources&&(this.addEventListener("player:timeupdate",this.onTimeUpdate.bind(this)),this.addEventListener("player:ended",(()=>{console.log("Reproduction: ended")})),this.addEventListener("player:pause",(()=>{console.log("Reproduction: paused")})),this.setupResource(0,this.autoPlay))}subRenderItem(){this.item&&(this.$refs.playlistItem=this.attach(L.instantiate(this.item,{disablePlayButton:!0}))),this.resources&&this.resources.length&&(this.$refs.buttonNotIt=this.createAndAttach("button",{class:"reproduction-controls__not-it",title:"not it"},this.create("span",{class:"fa fa-refresh"})),this.$refs.buttonNotIt.addEventListener("click",this.notIt.bind(this)))}subRenderClock(){this.$refs.timer=this.createAndAttach("span",{class:"reproduction-controls__timer"},"--:--")}subRenderButtons(){this.createAndAttach("div",{class:"reproduction-controls__buttons button-group"},[this.$refs.buttonBackward=this.createAndAttach("button",{class:"reproduction-controls__button-next"},this.create("span",{class:"fa fa-backward"})),this.$refs.buttonPlay=this.createAndAttach("button",{class:"reproduction-controls__button-play"},this.create("span",{class:"fa fa-play"})),this.$refs.buttonNext=this.createAndAttach("button",{class:"reproduction-controls__button-next"},this.create("span",{class:"fa fa-forward"}))]),this.$refs.buttonPlay.addEventListener("click",this.toggle.bind(this)),this.$refs.buttonBackward.addEventListener("click",(()=>{this.fireEvent("queue:intention:backward")})),this.$refs.buttonNext.addEventListener("click",(()=>{this.fireEvent("queue:intention:forward")}))}subRenderVolume(){this.$refs.volumeControl=this.createAndAttach("input",{type:"range",min:0,max:100,step:1,class:"reproduction-controls__volume"}),this.$refs.volumeControl.value=this.state.getInt("volume",15),this.$refs.volumeControl.addEventListener("change",this.dialVolume.bind(this))}subRenderQueueButton(){this.$refs.buttonQueue=this.createAndAttach("button",{class:"reproduction-controls__button-queue",title:"Queue"},this.create("span",{class:"fa fa-list"})),this.$refs.buttonQueue.addEventListener("click",(()=>{this.fireEvent("gui:summon-queue")}))}subRenderProgressBar(){this.$refs.progress=this.createAndAttach("progress",{max:100,class:"reproduction-controls__progress"}),this.$refs.progress.addEventListener("click",this.seek.bind(this))}remove(){return this.destroyPlayer(),super.remove()}notIt(){this.resources[this.index+1]?(this.index++,this.destroyPlayer(),this.playResource(this.index)):alert("no more alternatives")}playResource(t=0){this.setupResource(t,!0)}setupResource(t=0,e=!0){console.log("Reproduction: booting player"),window.player=this.player=this.createPlayer(this.resources[t]),this.player?this.player.appendTo(this.$refs.playerFrame).then((()=>{this.setMediaSession(this.resources[t]),e&&this.player.play(),this.player.setVolume(this.state.getInt("volume",15)),console.log("Reproduction: reproducing audio")})):console.error("Could not instantiate a player")}setMediaSession(t){if(!(!1 in navigator)){var{title:e,artist:s,album:i}=this.item;s=Array.isArray(s)?s.join(", "):s;var a=new MediaMetadata({title:e,artist:s,album:i});t.thumbnail&&(a.artwork=[{src:t.thumbnail,sizes:"120x90",type:"image/jpeg"}]),navigator.mediaSession.metadata=a}}destroyPlayer(){return this.player&&(this.player.pause(),this.player.remove()),this}createPlayer(t){switch(t.source){case"youtube":return this.createPlayerYouTube(t);case"sliderkz":case"localFiles":return this.createPlayerSliderKz(t)}}createPlayerYouTube(t){var e=document.createElement("player-youtube");return e.videoId=t.id,e.width=390,e}createPlayerSliderKz(t){var e=document.createElement("player-audio");return e.src=t.src,e}toggle(){this.player&&this.player.toggle()}onTimeUpdate(){this.$refs.timer.innerHTML=this.player.currentTimeFormatted,this.$refs.progress.value=this.player.currentTimePercentage}dialVolume(t){var e=t.target.value;this.state.set("volume",e),this.player&&this.player.setVolume(e)}seek(t){var e,s,i;this.player&&(e=t.clientX-this.$refs.progress.offsetLeft,s=this.$refs.progress.offsetWidth,i=Math.ceil(e/s*100)+"%",this.player.seek(i))}}k.register();const q=k,x=class extends p{static elementName="view-base";__construct(t,e){this.hashRequest=t,this.api=e}afterRender(){this.classList.add("view")}};class I extends x{static elementName="view-welcome";render(){var t=document.createElement("p");t.innerHTML="Welcome back",this.append(t)}}I.register();const _=I;class S extends p{static elementName="view-search-header";__construct(t,e,s){this.request=t,this.title=e,this.fields=s}render(){var t;for(var e of(this.classList.add("search-header"),this.$refs.form=this.createAndAttach("form",{action:"#"+this.request.path,class:"input-group input-group-horizontal"}),this.fields))e.value=this.request.queryParams.get(e.name)||"",t=this.$refs.form.createAndAttach("input",e),e.value.length&&(t.focus(),t.selectionStart=t.selectionEnd=t.value.length);this.$refs.form.createAndAttach("button",null,[this.create("span",{class:"fa fa-search"})])}}S.register();const C=S;class H extends p{static elementName="view-pagination";__construct(t,e,s){this.api=t,this.request=e,this.response=s,this.response.meta&&this.response.meta.pages&&(this.max=10,this.halfMax=this.max/2,this.response.meta.pages<=this.max?(this.first=1,this.last=this.response.meta.pages):this.response.meta.page+this.halfMax>this.response.meta.pages?(this.last=this.response.meta.pages,this.first=this.last-this.max):this.response.meta.page>this.halfMax?(this.first=this.response.meta.page-this.halfMax,this.last=this.response.meta.page+this.halfMax):(this.first=1,this.last=this.first+this.max))}render(){this.classList.add("button-group"),this.classList.add("view-nav"),this.response.meta&&this.response.meta.pages&&(this.first>1&&this.subRenderAnchorToBeginning(),this.response.meta.page>1&&this.subRenderAnchorToPreviousPage(),this.response.meta.pages>this.max&&this.subRenderAnchorBetweenExtremes(),this.response.meta.page<this.last&&this.subRenderAnchorToNextPage(),this.response.meta.pages>this.last&&this.subRenderAnchorToLast())}subRenderAnchorToBeginning(){var t=this.request.queryParams.without("page");t.set("page",1),this.createAndAttach("a",{href:this.request.path.replace("/","#")+"?"+t.toString(),class:"btn view-nav-first",title:this.request.meta.title},["first"])}subRenderAnchorToPreviousPage(){var t=this.request.queryParams.without("page");t.set("page",this.response.meta.page-1),this.createAndAttach("a",{href:this.request.path.replace("/","#")+"?"+t.toString(),class:"btn view-nav-previous",title:this.request.meta.title},["prev"])}subRenderAnchorBetweenExtremes(){for(var t=this.first;t<=this.last;t++){var e=this.request.queryParams.without("page");e.set("page",t);var s=this.response.meta.page==t;this.createAndAttach("a",{href:this.request.path.replace("/","#")+"?"+e.toString(),class:s?"btn view-nav-current":"btn",title:this.request.meta.title},[t])}}subRenderAnchorToNextPage(){var t=this.request.queryParams.without("page");t.set("page",this.response.meta.page+1),this.createAndAttach("a",{href:this.request.path.replace("/","#")+"?"+t.toString(),class:"btn view-nav-next",title:this.request.meta.title},["next"])}subRenderAnchorToLast(){var t=this.request.queryParams.without("page");t.set("page",this.response.meta.pages),this.createAndAttach("a",{href:this.request.path.replace("/","#")+"?"+t.toString(),class:"btn view-nav-last",title:this.request.meta.title},["last"])}}H.register();const M=H;class N{static enableBottomReached(t){t.addEventListener("scroll",N.onScroll.bind(t))}static onScroll(t){this.scrollTop+this.offsetHeight>=this.scrollHeight&&this.dispatchEvent(new CustomEvent("scroll:bottom-reached",{bubbles:!1}))}}const F=N;class B extends x{static elementName="view-playlist";async render(){this.classList.add("view--playlist"),await this.fetchPlaylist().then((t=>this.subRenderHeader(t))),this.fetchItems().then((t=>{this.subRenderItems(t),this.subRenderNavigation(t)})),F.enableBottomReached(this),this.addEventListener("scroll:bottom-reached",this.bottomReached.bind(this)),this.addEventListener("queue:item-selected",this.onItemSelected.bind(this))}bottomReached(t){console.log("Bottom of the page reached")}fetchPlaylist(){return this.api.collection.playlists.get(this.hashRequest.attributes.playlistId).read()}fetchItems(){return this.api.collection.playlists.get(this.hashRequest.attributes.playlistId).getItems(this.hashRequest.queryParams)}subRenderHeader(t){this.$refs.header=this.createAndAttach("header",{class:"header"},[this.$refs.headerH=this.create("div",{class:"header__header"}),this.$refs.headerB=this.create("div",{class:"header__body"}),this.$refs.headerF=this.create("div",{class:"header__footer"})]),this.$refs.headerH.createAndAttach("h1",null,t.data.title),t.data.description&&this.$refs.headerH.createAndAttach("h3",null,t.data.description),this.$refs.buttons=this.$refs.headerF.createAndAttach("div",{class:"button-group"},[this.$refs.buttonAdd=this.create("button",{title:"Add new item to playlist"},this.create("span",{class:"fa fa-plus"})),this.$refs.buttonEdit=this.create("button",{title:"Edit playlist"},this.create("span",{class:"fa fa-pencil"})),this.$refs.buttonDelete=this.create("button",{title:"Delete entire playlist",class:"btn-danger"},this.create("span",{class:"fa fa-close"}))]),this.$refs.buttonAdd.addEventListener("click",(()=>{this.fireEvent("playlist:intention:compose-new-item",{playlistId:this.hashRequest.attributes.playlistId})})),this.$refs.buttonEdit.addEventListener("click",(()=>{this.fireEvent("playlist:intention:edit",{playlistId:this.hashRequest.attributes.playlistId})})),this.$refs.buttonDelete.addEventListener("click",(()=>{this.fireEvent("playlist:intention:delete",{playlistId:this.hashRequest.attributes.playlistId})})),this.$refs.headerB.append(C.instantiate(this.hashRequest,t.data.title,[{type:"search",name:"title",placeholder:"Title",class:"main"},{type:"search",name:"artist",placeholder:"Artist"},{type:"search",name:"genre",placeholder:"Genre"}]))}async subRenderItems(t){if(t.data)for(var e of(this.$refs.playlist=this.createAndAttach("div",{class:"playlist"}),t.data))this.$refs.playlist.attach(L.instantiate(e))}subRenderNavigation(t){this.append(M.instantiate(this.api,this.hashRequest,t))}onItemSelected(t){var e=[];for(var s of this.querySelectorAll(L.elementName))e.push(s.item);for(var i in e)if(e[i]==t.detail.item){e=e.slice(i);break}t.detail.initialBatch=e,t.detail.meta={id:"playlist",noMore:!1,queryParams:this.hashRequest.queryParams,playlistId:this.hashRequest.attributes.playlistId}}}B.register();const D=B;class U extends p{static elementName="discography-item";__construct(t){this.album=t}render(){var t="span",e={title:this.album.title};this.album.single||(t="a",e.href=`#discover:album?artist=${this.album.artist}&title=${this.album.title}`),this.createAndAttach(t,e,[this.$refs.card=this.create("span",{class:"card"},[this.create("img",{src:this.album.thumbnail||"dist/img/missing-cover-art.webp"}),this.$refs.title=this.create("h4",null,[this.album.title])])]),this.album.single&&(this.$refs.title.createAndAttach("span",{class:"fa fa-hand-pointer-o"}),this.addEventListener("click",(()=>{this.fireEvent("queue:item-selected",{item:{title:this.album.title,artist:this.album.artist}})})))}}U.register();const O=U;class W extends x{static elementName="view-discography";async render(){this.classList.add("view--albums"),this.api.discover.albums.search(this.hashRequest.queryParams).then((t=>{this.renderHeader(t),this.renderAlbums(t)}))}renderHeader(t){this.$refs.header=this.createAndAttach("header",{class:"header"},[this.$refs.headerH=this.create("div",{class:"header__header"}),this.$refs.headerB=this.create("div",{class:"header__body"}),this.$refs.headerF=this.create("div",{class:"header__footer"})]),this.$refs.headerH.createAndAttach("h1",null,"Discover albums"),this.$refs.headerB.append(C.instantiate(this.hashRequest,"",[{type:"search",name:"artist",placeholder:"Artist",class:"main"}]))}async renderAlbums(t){var e=this.createAndAttach("div",{class:"grid releases"});for(var s of t.data)e.createAndAttach("div",{class:"col-6 col-sm-4 col-md-3 col-lg-2"},O.instantiate(s))}}W.register();const Q=W;class j extends x{static elementName="view-release";async render(){this.classList.add("view--release");var t=this.hashRequest.queryParams.get("artist"),e=this.hashRequest.queryParams.get("title");this.api.discover.albums.get(t,e).then((t=>{this.subRenderHeader(t),this.subRenderTracks(t)})),this.addEventListener("queue:item-selected",this.onItemSelected.bind(this))}subRenderHeader(t){this.$refs.header=this.createAndAttach("header",{class:"header"},[this.$refs.headerH=this.create("div",{class:"header__header"}),this.$refs.headerB=this.create("div",{class:"header__body"}),this.$refs.headerF=this.create("div",{class:"header__footer"})]),this.$refs.headerH.createAndAttach("img",{src:t.data.thumbnail||"dist/img/missing-cover-art.webp"}),this.$refs.headerB.createAndAttach("h1",null,t.data.title),this.$refs.headerB.createAndAttach("h3",null,this.create("a",{href:"#discover:albums?artist="+t.data.artist},t.data.artist)),this.$refs.buttons=this.$refs.headerF.createAndAttach("div",{class:"button-group"},this.$refs.addButton=this.create("button",{title:"Add new item to playlist"},this.create("span",{class:"fa fa-plus"}))),this.$refs.addButton.addEventListener("click",this.addEntireRelease.bind(this))}subRenderTracks(t){if(t.data.tracks)for(var e of(this.$refs.playlist=this.createAndAttach("div",{class:"playlist"}),t.data.tracks))this.$refs.playlist.append(L.instantiate({title:e,artist:t.data.artist,album:t.data.title}))}addEntireRelease(){var t=[];this.querySelectorAll(L.elementName).forEach((e=>{t.push(e.item)})),this.fireEvent("item:intention:add-to-collection",{items:t})}onItemSelected(t){var e=[];for(var s of this.querySelectorAll(L.elementName))e.push(s.item);for(var i in e)if(e[i]==t.detail.item){e=e.slice(i);break}t.detail.initialBatch=e,t.detail.meta={id:"album",noMore:!1}}}j.register();const V=j;class z extends D{static elementName="view-search";async render(){this.classList.add("view--search"),this.fetch().then((t=>{this.subRenderHeader(t),this.subRenderItems(t),this.subRenderNavigation(t)})),this.addEventListener("queue:item-selected",this.onItemSelected.bind(this))}fetch(){return this.hashRequest.queryParams.isEmpty()?new Promise(((t,e)=>t({}))):this.api.collection.playlistItems.search(this.hashRequest.queryParams)}subRenderHeader(t){this.$refs.header=this.createAndAttach("header",{class:"header"},[this.$refs.headerH=this.create("div",{class:"header__header"}),this.$refs.headerB=this.create("div",{class:"header__body"}),this.$refs.headerF=this.create("div",{class:"header__footer"})]),this.$refs.headerH.createAndAttach("h1",null,"Search"),this.$refs.headerB.append(C.instantiate(this.hashRequest,"",[{type:"search",name:"title",placeholder:"Title",class:"main"},{type:"search",name:"artist",placeholder:"Artist"},{type:"search",name:"genre",placeholder:"Genre"}]))}subRenderButtonGroup(){}onItemSelected(t){var e=[];for(var s of this.querySelectorAll(L.elementName))e.push(s.item);for(var i in e)if(e[i]==t.detail.item){e=e.slice(i);break}t.detail.initialBatch=e,t.detail.meta={id:"search",noMore:!1,queryParams:this.hashRequest.queryParams}}}z.register();const K=z;class G extends x{static elementName="view-discover";async render(){this.classList.add("view--artists"),this.fetch().then((t=>{this.renderHeader(t),this.renderArtists(t)}))}fetch(){return this.hashRequest.queryParams.isEmpty()?new Promise((()=>r({data:[]}))):this.api.discover.artists.search(this.hashRequest.queryParams)}renderHeader(t){this.$refs.header=this.createAndAttach("header",{class:"header"},[this.$refs.headerH=this.create("div",{class:"header__header"}),this.$refs.headerB=this.create("div",{class:"header__body"}),this.$refs.headerF=this.create("div",{class:"header__footer"})]),this.$refs.headerH.createAndAttach("h1",null,"Discover artist"),this.$refs.headerB.append(C.instantiate(this.hashRequest,"",[{type:"search",name:"name",placeholder:"Name",class:"main"}]))}async renderArtists(t){var e=this.createAndAttach("div",{class:"grid artists"});for(var s of t.data)e.createAndAttach("a",{href:`#discover:albums?artist=${s.name}`,class:"col-6 col-sm-4 col-md-3 col-lg-2"},[this.create("span",{class:"card"},[s.thumbnail?this.create("img",{src:s.thumbnail}):null,this.create("h4",null,[s.name])])])}}G.register();const J=G;class Y extends p{static elementName="queue-display";get isOpen(){return this.classList.contains("is-open")}constructor(){super()}open(){this.classList.add("is-open")}close(){this.classList.remove("is-open")}toggle(){this.isOpen?this.close():this.open()}render(){this.classList.add("queue-display"),this.createAndAttach("div",{class:"queue-display__drawer"},this.$refs.content=this.create("div",{class:"queue-display__content"},[this.$refs.history=this.create("ol",{reversed:"reversed"}),this.create("hr"),this.$refs.queued=this.create("ol")]))}showQueue(t,e){var s;this.$refs.history.clear(),this.$refs.queued.clear();for(var i=e.length-1;i>=0;i--)e[i]&&(s=L.instantiate(e[i]),this.$refs.history.createAndAttach("li",null,s));for(i=0;i<t.length;i++)t[i]&&(s=L.instantiate(t[i]),this.addContextMenuItems(s,t,i),this.$refs.queued.createAndAttach("li",null,s).addEventListener("queue:item-selected",(t=>{t.stopPropagation();var e=t.target.parentNode,s=[...this.$refs.queued.children].indexOf(e);0!=s&&this.fireEvent("queue:intention:jump",{from:s,to:0})})))}addContextMenuItems(t,e,s){t.actions.removeFromQueue={title:"Remove from queue",helpText:"remove",icon:"fa-minus",onClick:()=>{e.removeIndex(s)}},s>1&&(t.actions.playNext={title:"Play next",helpText:"play next",icon:"fa-minus",onClick:()=>{e.move(s,1)}})}}Y.register();const Z=Y;class X extends p{static elementName="modal-window";__construct(t){this.api=t}render(){this.subRenderModal()}subRenderModal(){this.classList.add("modal"),this.createAndAttach("div",{class:"modal-dialog"},[this.create("div",{class:"modal-content"},[this.$refs.header=this.create("div",{class:"modal-header"},["header"]),this.$refs.body=this.create("div",{class:"modal-body"}),this.$refs.footer=this.create("div",{class:"modal-footer"},[this.$refs.closeButton=this.create("button",{class:"btn-danger"},"Close")])])]),this.$refs.closeButton.addEventListener("click",(()=>{this.remove()}))}}X.register();const tt=X;class et extends tt{static elementName="modal-window-add-to-playlist";__construct(t,e){super.__construct(t),this.items=e}render(){super.render(),this.$refs.header.innerHTML="Add to playlist",this.api.collection.playlists.list().then((t=>{if(t.data)for(var e of(this.$refs.body.clear(),this.$refs.buttonGroup=this.$refs.body.createAndAttach("div",{class:"input-group input-group-vertical"}),t.data))this.$refs.buttonGroup.createAndAttach("button",{"data-playlist":e.id},e.title).addEventListener("click",this.onPlaylistChoosen.bind(this))}))}onPlaylistChoosen(t){var e,s=t.target.getAttribute("data-playlist"),i=[];for(var a of this.items)e=a.uuid?this.api.collection.playlistItems.create({playlist:s,uuid:a.uuid}):this.api.collection.playlistItems.create({playlist:s,title:a.title,artist:a.artist}),i.push(e);Promise.all(i).then((()=>{alert("Item added!!"),this.remove()}))}}et.register();const st=et;class it extends p{static elementName="messages-container";render(){this.classList.add("messages"),this.successes=this.createAndAttach("ul",{class:"successes hidden"}),this.warnings=this.createAndAttach("ul",{class:"warnings hidden"}),this.errors=this.createAndAttach("ul",{class:"errors hidden"})}messages(t){if(this.successes.clear().classList.add("hidden"),this.warnings.clear().classList.add("hidden"),this.errors.clear().classList.add("hidden"),t.successes)for(var e of(this.successes.classList.remove("hidden"),t.successes))this.successes.createAndAttach("li",null,e.title);if(t.errors)for(var e of(this.errors.classList.remove("hidden"),t.errors))this.errors.createAndAttach("li",null,e.title);if(t.warnings)for(var e of(this.warnings.classList.remove("hidden"),t.warnings))this.warnings.createAndAttach("li",null,e.title)}}it.register();const at=it;class rt extends p{static elementName="text-field";__construct(t,e,s,i=""){this.name=t,this.label=e,this.value=s,this.placeholder=i}render(){var t=Math.floor(1e4*Math.random());this.classList.add("form-group"),this.createAndAttach("label",{class:"label col-sm-2",for:t},this.label),this.$refs.input=this.createAndAttach("input",{type:"text",class:"col-sm-10",id:t,name:this.name,value:this.value,placeholder:this.placeholder})}setValue(t){this.$refs.input.value=t}}rt.register();const nt=rt;class ht extends p{static elementName="text-area-field";__construct(t,e,s,i=""){this.name=t,this.label=e,this.value=s,this.placeholder=i}render(){var t=Math.floor(1e4*Math.random());this.classList.add("form-group"),this.createAndAttach("label",{class:"label col-sm-2",for:t},this.label),this.$refs.input=this.createAndAttach("textarea",{class:"col-sm-10",id:t,name:this.name,placeholder:this.placeholder}),this.$refs.input.value=this.value}setValue(t){this.$refs.input.value=t}}ht.register();const ot=ht;class lt extends p{static elementName="multiple-text-field";__construct(t,e,s,i="",a="Add +"){this.name=t,this.label=e,this.value=s,this.placeholder=i,this.addButton=a}render(){this.classList.add("form-group"),this.createAndAttach("span",{class:"label col-sm-2"},this.label),this.createAndAttach("div",{class:"col-sm-10"},[this.$refs.body=this.create("div",{class:"input-group input-group-vertical"}),this.$refs.plusButton=this.create("small",{},this.addButton)]),this.$refs.plusButton.addEventListener("click",this.addBlank.bind(this)),this.setValue(this.value)}setValue(t){this.$refs.body.clear(),this.addValues(t)}addValues(t){for(var e of t=Array.isArray(t)?t:[t])this.add(e)}add(t=""){this.$refs.body.createAndAttach("input",{type:"text",placeholder:this.placeholder,class:"col-sm-12",name:this.name,value:t})}addBlank(){this.add("")}}lt.register();const dt=lt;class ct extends p{static elementName="form-element";render(){this.$refs.form=this.createAndAttach("form",{class:"vertical",method:"post",enctype:"multipart/form-data"})}setValue(t,e){return this.$refs[t]||console.error("No input named "+t),this.$refs[t].setValue(e),this}getForm(){return this.$refs.form}addHidden(t,e){return this.$refs[t]=this.$refs.form.createAndAttach("input",{type:"hidden",name:t,value:e})}addTextField(t,e,s,i=""){return this.$refs[t]=this.$refs.form.attach(nt.instantiate(t,e,s,i))}addTextArea(t,e,s,i=""){return this.$refs[t]=this.$refs.form.attach(ot.instantiate(t,e,s,i))}addMultiTextField(t,e,s,i="",a="Add +"){return this.$refs[t]=this.$refs.form.attach(dt.instantiate(t,e,s,i,a))}addSubmitButton(t="submit",e="Submit"){return this.$refs[t]=this.$refs.form.createAndAttach("div",{class:"form-group"},[this.create("input",{type:"submit",name:t,value:e,class:"col-12 btn-main"})])}}ct.register();const ut=ct;class pt extends tt{static elementName="modal-form";__construct(){}render(){super.subRenderModal(),this.subRenderHeader(),this.subRenderForm(),this.subRenderSubmitListener()}subRenderHeader(){this.$refs.messages=this.$refs.body.attach(at.instantiate())}subRenderForm(){this.$refs.form=this.$refs.body.attach(ut.instantiate()),this.$refs.form.addTextField("title","Title",""),this.$refs.form.addSubmitButton("save","Save")}subRenderSubmitListener(){this.$refs.form.addEventListener("submit",(t=>{console.log("FORM SUBMITTED")}))}onResponse(t){this.$refs.messages.messages(t),t.successes&&t.successes.length&&(alert("FINISHED!"),this.remove())}}pt.register();const mt=pt;class ft extends mt{static elementName="modal-add-item";__construct(t,e){this.api=t,this.playlistId=e}subRenderHeader(){super.subRenderHeader(),this.$refs.header.innerHTML="Add item"}subRenderForm(){this.$refs.form=this.$refs.body.attach(ut.instantiate()),this.$refs.form.addTextField("title","Title",""),this.$refs.form.addTextField("album","Album",""),this.$refs.form.addMultiTextField("artist[]","Artist",[""],"Artist","Add artist"),this.$refs.form.addMultiTextField("featuring[]","Artist",[""],"Featuring","Add featured artist"),this.$refs.form.addTextField("cover","Cover",""),this.$refs.form.addMultiTextField("soundtrack[]","Soundtrack",[""],"Soundtrack","Add soundtrack"),this.$refs.form.addMultiTextField("genre[]","Genre",[""],"Genre","Add genre"),this.playlistId&&this.$refs.form.addHidden("playlist",this.playlistId||""),this.$refs.form.addSubmitButton("save","Save")}subRenderSubmitListener(){this.$refs.form.addEventListener("submit",(t=>{t.preventDefault(),this.api.collection.playlistItems.create(this.$refs.form.getForm()).then(this.onResponse.bind(this),this.onResponse.bind(this))}))}onResponse(t){this.$refs.messages.messages(t),t.successes&&t.successes.length&&(alert("Added!"),this.fireEvent("item:added"),this.remove())}}ft.register();const bt=ft;class gt extends bt{static elementName="modal-edit-item";__construct(t,e){this.api=t,this.uuid=e}render(){super.subRenderModal(),this.api.collection.playlistItems.get(this.uuid).read().then((t=>{this.subRenderHeader(),this.subRenderForm(t),this.subRenderSubmitListener()}))}subRenderHeader(){super.subRenderHeader(),this.$refs.header.innerHTML="Edit item"}subRenderForm(t){super.subRenderForm(),this.$refs.form.setValue("title",t.data.title||"").setValue("artist[]",t.data.artist||[""]).setValue("featuring[]",t.data.featuring||[""]).setValue("cover",t.data.cover||"").setValue("album",t.data.album||"").setValue("soundtrack[]",t.data.soundtrack||[""]).setValue("genre[]",t.data.genre||[""])}subRenderSubmitListener(){this.$refs.form.addEventListener("submit",(t=>{t.preventDefault(),this.api.collection.playlistItems.get(this.uuid).update(this.$refs.form.getForm()).then(this.onResponse.bind(this),this.onResponse.bind(this))}))}onResponse(t){this.$refs.messages.messages(t),t.successes&&t.successes.length&&(alert("Edited!"),this.fireEvent("item:updated"),this.remove())}}gt.register();const vt=gt;class yt extends bt{static elementName="modal-add-playlist";__construct(t){this.api=t}subRenderHeader(){super.subRenderHeader(),this.$refs.header.innerHTML="Edit playlist"}subRenderForm(){this.$refs.form=this.$refs.body.attach(ut.instantiate()),this.$refs.form.addTextField("title","Title",""),this.$refs.form.addTextArea("description","Descrio",""),this.$refs.form.addSubmitButton("save","Save")}subRenderSubmitListener(){this.$refs.form.addEventListener("submit",(t=>{t.preventDefault(),this.api.collection.playlists.create(this.$refs.form.getForm()).then(this.onResponse.bind(this),this.onResponse.bind(this))}))}onResponse(t){this.$refs.messages.messages(t),t.successes&&t.successes.length&&(alert("Added!"),this.fireEvent("playlist:added"),this.remove())}}yt.register();const At=yt;class wt extends At{static elementName="modal-edit-playlist";__construct(t,e){this.api=t,this.playlistId=e}subRenderHeader(){super.subRenderHeader(),this.$refs.header.innerHTML="Edit playlist"}render(){super.subRenderModal(),this.api.collection.playlists.get(this.playlistId).read().then((t=>{this.subRenderHeader(),this.subRenderForm(t),this.subRenderSubmitListener()}))}subRenderForm(t){super.subRenderForm(),this.$refs.form.setValue("title",t.data.title||"").setValue("description",t.data.description||"")}subRenderSubmitListener(){this.$refs.form.addEventListener("submit",(t=>{t.preventDefault(),this.api.collection.playlists.get(this.playlistId).update(this.$refs.form.getForm()).then(this.onResponse.bind(this),this.onResponse.bind(this))}))}onResponse(t){this.$refs.messages.messages(t),t.successes&&t.successes.length&&(alert("Edited!"),this.fireEvent("playlist:updated"),this.remove())}}wt.register();const $t=wt;class Rt extends Array{static instantiate(t=[],e){var s=new Rt;return s.enqueue(t),s.context=e,s.fetchingPromise=null,s.length<=1&&s.fetchMore(),s}jump(t,e=1){this.splice(e,0,t),this.updatedCallback()}enqueue(t){Array.isArray(t)?this.enqueueMultiple(t):this.enqueueSingle(t)}dequeue(){var t=this[0]||null;return this.splice(0,1),this.updatedCallback(),t}removeIndex(t){var e=this[t];return this.splice(t,1),this.updatedCallback(),e}dropIn(t){this.splice(0,0,t),this.updatedCallback()}move(t,e=0){console.log(`movin queue item from ${t} to position ${e}`);var s=this.splice(t,1)[0];return this.splice(e,0,s),this.updatedCallback(),s}clear(){this.splice(0,this.length),this.updatedCallback()}get front(){return this[0]?this[0]:(console.log("Queue: end reached"),null)}get back(){return this.length?this[this.length-1]:null}async getNextInLine(){return this.length>=2?new Promise(((t,e)=>t(this[1]))):this.fetchMore().then((t=>this[1]||null))}async fetchMore(){return console.log("Queue: Searching for more content"),this.fetchingPromise?this.fetchingPromise:this.context?this.fetchingPromise=this.context.fetchMore(this).then((t=>(this.fetchingPromise=null,t.data&&t.data.length?this.enqueue(t.data):console.log("Queue: nothig more to add to the queue"),t))):new Promise(((t,e)=>{t([])}))}enqueueMultiple(t){this.push(...t),console.log("Queue: multiple items added"),this.updatedCallback()}enqueueSingle(t){this.push(t),console.log("Queue: single item added"),this.updatedCallback()}updatedCallback(){console.log("queue updated")}}const Tt=Rt,Et=class extends Array{add(t){Array.isArray(t)?this.addMultiple(t):this.addSingle(t)}get theMostRecent(){return this.length?this[0]:null}get theOldest(){return this.length?this[this.length-1]:null}rewind(t=1){var e=this.splice(0,t);return this.updatedCallback(),e}addMultiple(t){this.splice(0,0,...t),console.log("History: multiple items added"),this.updatedCallback()}addSingle(t){this.splice(0,0,t),console.log("History: single item added"),this.updatedCallback()}clear(){this.splice(0,this.length),this.updatedCallback()}updatedCallback(){console.log("history updated")}},Lt=class{constructor(t,e=!1){this.api=t,this.noMore=!1}static id(){return"base"}serialize(){return{id:this.constructor.id(),noMore:this.noMore}}static instantiate(t,e){var s=Object.values(e);return s.splice(0,1,t),new this(...s)}progress(){}async fetchMore(t){return this.noMore?new Promise(((t,e)=>t({data:[]}))):(this.progress(),this.request(t).then((t=>(console.log(t),t.data&&0!=t.data.length||(this.noMore=!0),t))))}async request(t){}};class Pt extends Lt{constructor(t,e=!1,s){super(t,e),this.queryParams="string"==typeof s?new URLSearchParams(s):s}static id(){return"search"}serialize(){return{id:Pt.id(),noMore:this.noMore,queryParams:this.queryParams?this.queryParams.toString():""}}progress(){var t=parseInt(this.queryParams.get("page")||1)+1;this.queryParams.set("page",t)}async request(t){return this.api.collection.playlistItems.search(this.queryParams)}}const kt=Pt;class qt extends kt{constructor(t,e=!1,s,i){super(t,e,s),this.playlistId=i}static id(){return"playlist"}serialize(){return{id:qt.id(),noMore:this.noMore,queryParams:this.queryParams?this.queryParams.toString():"",playlistId:this.playlistId}}async request(t){return this.api.collection.playlists.get(this.playlistId).getItems(this.queryParams)}}const xt=qt,It=class extends Lt{constructor(t,e=!1){super(t,e)}static id(){return"album"}async fetchMore(t){return new Promise(((t,e)=>t({data:[]})))}};class _t{constructor(t,e,s={},i={}){this.path=t,this.queryParams="string"==typeof e?new URLSearchParams(e):e,this.attributes=s,this.meta=i}setAttributes(t){return this.attributes=t,this}setAttribute(t,e){return this.attributes[t]=e,this}getAttribute(t,e=null){return this.attributes[t]||e}matchesHtmlElement(){var t=this.path.replace(/^\//,"#"),e=!1;try{e=document.querySelector(t)}catch{e=!1}return!!e}static createFromAnchor(t){var e=t.getAttribute("href"),s=t.getAttribute("title")||null,i=_t.createFromUrl(e);return i?(i.meta.title=s,i):null}static createFromForm(t){var e=t.getAttribute("action"),s=t.getAttribute("title")||null,i=_t.createFromUrl(e);if(!i)return null;i.meta.title=s;var a=new FormData(t),r=new URLSearchParams(a);return _t.mergeUrlSearchParams(i.queryParams,r),i}static mergeUrlSearchParams(t,e){for(let[s,i]of e.entries())s.indexOf("[]")>=0&&t.has(s)?t.append(s,i):t.set(s,i)}static createFromUrl(t){var e=new URL(t,"https://"+window.location.host);return e.hash?_t.createFromHash(e.hash,e.host):null}static createFromHash(t,e=window.location.host){var s=t.replace(/^#\/?/,"/"),i=new URL(s,"https://"+window.location.host);return e!=window.location.host?null:new _t(i.pathname,i.searchParams)}}const St=_t;class Ct extends HTMLElement{constructor(){super(),this.$refs={},this.label="",this.tabId="",this.rendered=!1}setLabel(t){this.label=t,this.rendered&&(this.$refs.label.innerHTML=t)}setTabId(t){return this.tabId=t,this}connectedCallback(){this.rendered||this.render()}render(){this.rendered=!0,this.classList.add("tabbed-router__tab-link"),this.$refs.label=document.createElement("span"),this.$refs.label.innerHTML=this.label,this.append(this.$refs.label),this.$refs.closeBtn=document.createElement("button"),this.$refs.closeBtn.setAttribute("title","close tab"),this.append(this.$refs.closeBtn),this.addEventListener("click",this.onClick.bind(this)),this.$refs.closeBtn.addEventListener("click",this.onCloseBtnClicked.bind(this))}onClick(){var t=new CustomEvent("tabbed-router:tab-link:clicked",{});this.dispatchEvent(t)}onCloseBtnClicked(t){t.stopPropagation(),t.preventDefault();var e={bubbles:!0,detail:this.tabId},s=new CustomEvent("tabbed-router:tab-link:request-closing",e);this.dispatchEvent(s)}}const Ht=Ct;class Mt extends HTMLElement{constructor(){super(),this.history=[],this.historyIndex=-1,this.ctrlKey=!1}setRouteCollection(t){this.routeCollection=t}connectedCallback(){this.classList.add("tabbed-router__tab-panel"),this.addEventListener("click",this.onAnchorClicked.bind(this)),this.addEventListener("submit",this.onFormSubmitted.bind(this)),this.addEventListener("keydown",this.onKeyDown.bind(this)),this.addEventListener("keyup",this.onKeyUp.bind(this))}onKeyDown(t){this.ctrlKey=t.ctrlKey}onKeyUp(t){this.ctrlKey=t.ctrlKey}onAnchorClicked(t){var e=Mt.getAnchor(t.target);if(e&&!t.ctrlKey&&"_blank"!=e.getAttribute("target")){t.tabbedRouterAvaliated=!0;var s=St.createFromAnchor(e);0==s||s.matchesHtmlElement()||(t.stopPropagation(),t.preventDefault(),this.goTo(s))}}onFormSubmitted(t){var e=t.target;if(!this.ctrlKey&&"_blank"!=e.getAttribute("target")){t.tabbedRouterAvaliated=!0;var s=St.createFromForm(e);0==s||"get"!=e.method||s.matchesHtmlElement()||(t.stopPropagation(),t.preventDefault(),this.goTo(s))}}backwards(){this.historyIndex<=0||(this.historyIndex--,this.request(this.history[this.historyIndex]))}forwards(){this.historyIndex!=this.history.length-1&&(this.historyIndex++,this.request(this.history[this.historyIndex]))}goTo(t){this.history=this.history.slice(0,this.historyIndex+1),this.history.push(t),this.request(t),this.historyIndex++}request(t){var e=this.routeCollection.getMatchingRoute(t),s=e?e.callIt(t):this.nothingFoundCallback(t);if(s){this.stageElement(s);var i=new CustomEvent("tabbed-router:tab-panel:request-made",{bubbles:!0,detail:t});this.dispatchEvent(i)}else console.error("Route failed in returning an element.")}stageElement(t){this.clearStage(),this.addToStage(t)}clearStage(){this.querySelectorAll(":scope > *").forEach((t=>{t.remove()}))}addToStage(t){this.append(t)}nothingFoundCallback(t){var e=document.createElement("div");return e.innerHTML="Nothing found",t.meta.title=t.meta.title?t.meta.title+" ( not found )":"not found",e}static getAnchor(t){if(t instanceof HTMLAnchorElement)return t;do{t=t.parentNode}while(t.parentNode&&t.parentNode instanceof HTMLAnchorElement);return t&&t instanceof HTMLAnchorElement?t:null}}const Nt=Mt;class Ft extends HTMLElement{constructor(){super(),this.$refs={},this.links={},this.tabs={},this.tabCount=0,this.rendered=!1,this.currentTabId=null,this.routeCollection=null,this.ctrlKey=!1}setRouteCollection(t){this.routeCollection=t}connectedCallback(){this.rendered||this.render()}render(){for(var t in this.rendered=!0,this.classList.add("tabbed-router__tab-manager"),this.subRenderHeader(),this.subRenderPanes(),this.tabs)this.attachTab(t);document.addEventListener("click",this.onAnchorClicked.bind(this)),document.addEventListener("submit",this.onFormSubmitted.bind(this)),document.addEventListener("keydown",this.onKeyDown.bind(this)),document.addEventListener("keyup",this.onKeyUp.bind(this)),this.addEventListener("tabbed-router:tab-panel:request-made",this.onTabRequest.bind(this)),this.addEventListener("tabbed-router:tab-link:request-closing",this.onRequestToCloseTab.bind(this))}subRenderHeader(){this.$refs.header=document.createElement("div"),this.$refs.header.classList.add("tabbed-router__tab-manager__header"),this.append(this.$refs.header),this.subRenderControls(),this.subRenderTabLinks()}subRenderControls(){this.$refs.controls=document.createElement("div"),this.$refs.controls.classList.add("tabbed-router__tab-manager__controls"),this.$refs.header.append(this.$refs.controls),this.$refs.backwardButton=document.createElement("button"),this.$refs.backwardButton.title="Backwards",this.$refs.backwardButton.classList.add("tabbed-router__tab-manager__backwards-button"),this.$refs.controls.append(this.$refs.backwardButton),this.$refs.forwardButton=document.createElement("button"),this.$refs.forwardButton.title="Forwards",this.$refs.forwardButton.classList.add("tabbed-router__tab-manager__forwards-button"),this.$refs.controls.append(this.$refs.forwardButton),this.$refs.backwardButton.addEventListener("click",this.backwards.bind(this)),this.$refs.forwardButton.addEventListener("click",this.forwards.bind(this))}subRenderTabLinks(){this.$refs.tabLinks=document.createElement("div"),this.$refs.tabLinks.classList.add("tabbed-router__tab-manager__tab-links"),this.$refs.header.append(this.$refs.tabLinks)}subRenderPanes(){this.$refs.tabPanes=document.createElement("div"),this.$refs.tabPanes.classList.add("tabbed-router__tab-manager__tab-panes"),this.append(this.$refs.tabPanes)}onRequestToCloseTab(t){if(!(this.tabCount<=1)){var e=t.detail;if(e==this.currentTabId){var s=(this.links[e].previousSibling||this.links[e].nextSibling).tabId;this.focusTab(s)}this.removeTab(e)}}onKeyDown(t){this.ctrlKey=t.ctrlKey}onKeyUp(t){this.ctrlKey=t.ctrlKey}onAnchorClicked(t){if(!t.tabbedRouterAvaliated){var e=Nt.getAnchor(t.target);if(e){var s=St.createFromAnchor(e);0==s||s.matchesHtmlElement()||(t.stopPropagation(),t.preventDefault(),t.ctrlKey?this.openInNewTab(s,!1):"_blank"==(e.getAttribute("target")||"self")?this.openInNewTab(s,!0):this.tabs[this.currentTabId].goTo(s))}}}onFormSubmitted(t){if(!t.tabbedRouterAvaliated){var e=t.target;t.tabbedRouterAvaliated=!0;var s=St.createFromForm(e);0==s||"get"!=e.method||s.matchesHtmlElement()||(t.stopPropagation(),t.preventDefault(),this.ctrlKey?this.openInNewTab(s,!1):"_blank"==(e.getAttribute("target")||"self")?this.openInNewTab(s,!0):this.tabs[this.currentTabId].goTo(s))}}openInNewTab(t,e=!1){var s=this.generateNewTabId(),i=this.createTab(s,t.meta.title||s,e);return i.goTo(t),i}generateNewTabId(){var t;do{t="tab-"+Math.floor(1e3*Math.random())}while(this.tabs[t]);return t}onTabRequest(t){var e=this.getTabIdForTabPanel(t.target),s=t.detail;this.links[e].setLabel(s.meta.title||e)}getTabIdForTabPanel(t){for(var e in this.tabs)if(this.tabs[e]==t)return e;return null}backwards(){this.tabs[this.currentTabId].backwards()}forwards(){this.tabs[this.currentTabId].forwards()}focusTab(t){for(var e in this.currentTabId=t,this.tabs)e==t?(this.tabs[e].classList.add("focused"),this.links[e].classList.add("focused")):(this.tabs[e].classList.remove("focused"),this.links[e].classList.remove("focused"))}createTab(t,e=null,s=!0){var i=new Nt;return this.setTab(t,i,e),s&&this.focusTab(t),i}setTab(t,e,s){if(this.tabs[t])throw"Tab {tabId} is already set";e.setRouteCollection(this.routeCollection);var i=this.createTabButton(t,s||t);this.tabs[t]=e,this.links[t]=i,this.rendered&&this.attachTab(t)}removeTab(t){var e;return this.tabs[t]?(e=this.tabs[t],this.rendered&&this.detachTab(t),e):null}attachTab(t){var e=this.tabs[t],s=this.links[t];this.$refs.tabLinks.append(s),this.$refs.tabPanes.append(e),this.tabCount++}detachTab(t){this.links[t].remove(),delete this.links[t],this.tabs[t].remove(),delete this.tabs[t],this.tabCount--}createTabButton(t,e){var s=new Ht;return s.setTabId(t),s.setLabel(e),s.addEventListener("tabbed-router:tab-link:clicked",(t=>{this.focusTab(t.target.tabId)})),s}}const Bt=Ft;customElements.define("tab-manager",Bt),customElements.define("tab-link",Ht),customElements.define("tab-panel",Nt);class Dt extends p{static elementName="the-app";__construct(t){this.api=t,this.routeCollection=this.setUpRouteCollection(t),this.state=new P("showrunner.state"),this.queueContextFactory=new class{constructor(t){this.api=t}instantiate(t){if(null==t)return null;switch(t.id){case xt.id():return xt.instantiate(this.api,t);case It.id():return It.instantiate(this.api,t);case kt.id():return kt.instantiate(this.api,t)}return null}}(t),this.setHistory(this.loadHistory(),!1),this.setQueue(this.loadQueue(),!1),this.updateReproductionTray()}saveHistory(t){this.state.set("history",t)}loadHistory(){if(!this.state.get("history"))return new Et([]);var t=new Et;return t.add(this.state.get("history")),t}saveQueue(t){t.context&&this.saveQueueContext(t.context),this.state.set("queue",t)}loadQueue(){if(!this.state.get("queue"))return Tt.instantiate([],null);var t=this.loadQueueContext(),e=this.state.get("queue");return Tt.instantiate(e,t)}saveQueueContext(t){this.state.set("queueContext",t.serialize())}loadQueueContext(){if(!this.state.get("queueContext"))return null;var t=this.state.get("queueContext");return this.queueContextFactory.instantiate(t)}render(){this.classList.add("app"),this.$refs.stage=new Bt,this.$refs.stage.classList.add("app__stage"),this.$refs.stage.setAttribute("id","stage"),this.$refs.stage.setRouteCollection(this.routeCollection),this.$refs.middle=this.createAndAttach("div",{class:"app__middle"},[this.$refs.navMenu=f.instantiate(this.api),this.$refs.stage,this.$refs.queueDisplay=Z.instantiate()]),this.$refs.footer=this.createAndAttach("div",{class:"app__footer"},[this.$refs.controls=q.instantiate(this.api)]);var t=this.$refs.stage.createTab("main-tab",!0),e=St.createFromUrl("#home");e.meta.title="Home",t.goTo(e),this.addEventListener("queue:item-selected",this.onItemSelected.bind(this)),this.addEventListener("player:ended",this.onPlayerEnded.bind(this)),this.addEventListener("queue:intention:forward",this.forwardTheQueue.bind(this)),this.addEventListener("queue:intention:backward",this.rewindTheQueue.bind(this)),this.addEventListener("queue:intention:jump",this.onJumpLine.bind(this)),this.addEventListener("queue:intention:play-it-next",this.onPlayNext.bind(this)),this.addEventListener("playlist:added",(()=>{this.$refs.navMenu.render()})),this.addEventListener("playlist:updated",(()=>{this.$refs.navMenu.render()})),this.addEventListener("item:intention:add-to-collection",(t=>{var e=st.instantiate(this.api,t.detail.items);this.append(e)})),this.addEventListener("playlist:intention:compose-new-item",(t=>{var e=bt.instantiate(this.api,t.detail.playlistId);this.append(e)})),this.addEventListener("item:intention:edit",(t=>{var e=vt.instantiate(this.api,t.detail.uuid);this.append(e)})),this.addEventListener("item:intention:delete",(t=>{confirm("Are you sure you want to remove it ?")&&(this.api.collection.playlistItems.get(t.detail.uuid).delete(),t.target.remove())})),this.addEventListener("collection:intention:download",(t=>{this.api.collection.playlists.downloadAll()})),this.addEventListener("collection:intention:compose-new-playlist",(t=>{var e=At.instantiate(this.api);this.append(e)})),this.addEventListener("playlist:intention:edit",(t=>{var e=$t.instantiate(this.api,t.detail.playlistId);this.append(e)})),this.addEventListener("playlist:intention:delete",(t=>{confirm("Are you sure you want to delete the playlist ?")&&(this.api.collection.playlists.get(t.detail.playlistId).delete().then((()=>{this.$refs.navMenu.render()})),window.location.hash="#home")})),this.addEventListener("gui:summon-queue",(()=>{this.$refs.queueDisplay.toggle()})),this.queue.length&&this.setupItem(this.queue[0],!1),this.updateReproductionTray()}setUpRouteCollection(t){var e=new class{constructor(){this.routes=[]}call(t,e){return t.callIt(e)}getMatchingRoute(t){for(var e of this.routes)if(e.doesItMatcheRequest(t))return e;return null}addRoute(t){return this.routes.push(t),this}createRoute(t,e){return this.addRoute(new class{constructor(t,e){this.patterns=Array.isArray(t)?t:[t],this.callback=e}callIt(t){var e=this.getMatchingPattern(t.path),s=this.getAttributesFromPath(t.path,e);return t.setAttributes(s),this.instantiateElement(t)}instantiateElement(t){var e;return"string"==typeof this.callback?e=document.createElement(this.callback):"function"==typeof this.callback&&(e=this.callback.apply(this,[t])),e.request=t,e}doesItMatcheRequest(t){return!(!t.path||!this.getMatchingPattern(t.path))}getMatchingPattern(t){for(var e of this.patterns)if(t.match(e))return e;return null}getAttributesFromPath(t,e){return e.exec(t).groups||{}}}(t,e))}};return e.createRoute([/^$/,/home$/],(function(e){return _.instantiate(e,t)})).createRoute(/playlist:(?<playlistId>[\w\d\-]+)$/,(function(e){return D.instantiate(e,t)})).createRoute(/search/,(function(e){return K.instantiate(e,t)})).createRoute(/discover:artist/,(function(e){return J.instantiate(e,t)})).createRoute(/discover:albums$/,(function(e){return Q.instantiate(e,t)})).createRoute(/discover:album/,(function(e){return V.instantiate(e,t)})),e}async onJumpLine(t){var{from:e,to:s}=t.detail,i=this.queue.move(e,s);0==s&&this.playItem(i)}onPlayNext(t){var{item:e}=t.detail;0==this.queue.length?this.playItem(e):this.queue.jump(e,1)}async onItemSelected(t){var{item:e,initialBatch:s,meta:i}=t.detail;console.log("-------------------------------"),console.log("Show runner: New item selected");var a=this.queueContextFactory.instantiate(i),r=Tt.instantiate(s,a);return r?this.playNewQueue(r):this.jumpTheQueue(e)}async jumpTheQueue(t){return this.queue.dropIn(t),this.playItem(t)}async playNewQueue(t){var e=this.queue;return e.front&&this.addToHistory(e.front),this.setQueue(t),this.playItem(this.queue.front)}setHistory(t,e=!0){this.history=t,e&&this.saveHistory(t),this.history.updatedCallback=()=>{var t=this.history.slice(0,30);this.saveHistory(t),this.updateReproductionTray()},this.updateReproductionTray()}setQueue(t,e=!0){this.queue=t,e&&this.saveQueue(t),this.queue.updatedCallback=()=>{this.saveQueue(t),this.updateReproductionTray()},this.updateReproductionTray()}updateReproductionTray(){this.$refs.queueDisplay&&this.$refs.queueDisplay.showQueue(this.queue,this.history)}async onPlayerEnded(t){return console.log("-------------------------------"),console.log("Show runner: song ended, next."),this.advanceTheQueue()}async rewindTheQueue(t){if(this.history.length){console.log("-------------------------------"),console.log("Show runner: rewinding queue.");var e=this.history.rewind(1)[0];return this.queue.dropIn(e),this.playItem(e)}}async forwardTheQueue(t){return console.log("-------------------------------"),console.log("Show runner: song skipped, next."),this.advanceTheQueue()}async advanceTheQueue(){return this.queue.getNextInLine().then((t=>{if(this.addToHistory(this.queue.front),this.queue.dequeue(),t)return this.playItem(t);console.log("Showrunner: Nothing else to play")}))}addToHistory(t){this.history.add(t)}async playItem(t){return this.setupItem(t,!0)}async setupItem(t,e=!0){return this.findResourcesForMusicalItem(t).then((s=>{if(s.data.length)return this.setupResources(t,s.data,e),s;alert("Show runner: Nothing found to play")}))}setupResources(t,e,s=!0){this.$refs.controls.remove(),this.$refs.controls=q.instantiate(this.api,t,e,s),this.$refs.footer.append(this.$refs.controls)}async findResourcesForMusicalItem(t){console.log("Show runner: searching for source to play");var e={};return t.title&&(e.title=t.title),t.soundtrack&&t.soundtrack.length?e.soundtrack=t.soundtrack:t.artist&&t.artist.length&&(e.artist=t.artist),this.api.discover.resources(e)}}Dt.register();const Ut=Dt;class Ot{constructor(t,e=null,s=[]){this.elementName=t,this.attributes=e,this.children=Array.isArray(s)?s:[s]}create(){var t=document.createElement(this.elementName);for(var e in this.attributes)t.setAttribute(e,this.attributes[e]);for(var s of this.children)null!=s&&("string"==typeof s?s=document.createTextNode(s):"object"==typeof s&&s.elementName&&(s=Ot.createFromObject(s)),t.append(s));return t}static createFromObject(t){var{elementName:e,attributes:s,children:i}=t;return new Ot(e,s,i).create()}}const Wt=Ot;HTMLElement.prototype.attach=function(t){return this.append(t),t},HTMLElement.prototype.create=function(t,e=null,s=[]){return new Wt(t,e,s).create()},HTMLElement.prototype.createAndAttach=function(t,e=null,s=[]){return this.attach(this.create(t,e,s))},HTMLElement.prototype.clear=function(){var t=Array.from(this.children);for(var e of t)e.remove();return this},URLSearchParams.prototype.without=function(t){var e=new URLSearchParams(this.toString());return e.delete(t),e},URLSearchParams.prototype.withAdded=function(t,e){var s=new URLSearchParams(this.toString());return s.append(t,e),s},URLSearchParams.prototype.isEmpty=function(){return 0==this.toString().length};const Qt=new class{constructor(t){var s=new c({baseHref:t,headers:{"Content-Type":"application/json"}});this.collection=new class{constructor(t){this.artists=new e(t),this.playlists=new a(t),this.playlistItems=new h(t)}}(s),this.discover=new d(s)}}(window.playerSettings.backEndBaseUrl);window.api=Qt,window.app=Ut.instantiate(Qt),document.addEventListener("DOMContentLoaded",(()=>{document.body.append(window.app)}))})()})();