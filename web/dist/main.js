(()=>{var e={978:(e,t,s)=>{e.exports=s(411)},781:(e,t,s)=>{const i=s(923);class a{static toObject(e){var t,s,r;return"Object"==e.constructor.name?e:e instanceof FormData?i.formDataToObject(e):e instanceof HTMLFormElement?(t=new FormData(e),i.formDataToObject(t)):e instanceof URL?i.queryStringToObject(e.search):e instanceof URLSearchParams?i.searchParamsToObject(e):i.isValidJson(e)?JSON.parse(e):(r=(s=i.stringToUrl(e))&&s.search?new URLSearchParams(s.search):new URLSearchParams(e),a.emptySearchParams(r)?null:i.searchParamsToObject(r))}static toJson(e){var t;return i.isValidJson(e)?e:(t=a.toObject(e),JSON.stringify(t))}static toFormData(e){var t;return e instanceof FormData?e:e instanceof HTMLFormElement?new FormData(e):(t=a.toObject(e),i.objectToFormData(t))}static emptySearchParams(e){for(var t of e.values())if(t)return!1;return!0}}e.exports=a},923:(e,t,s)=>{const i=s(26),a=s(15);class r{static stringToUrl(e){if(a.isAbsolute(e))return new URL(e);var t;const s="/"==e.slice(0,1),r=a.getBaseHref();return s?((t=new URL(r)).pathname=e,t.placeholder=t.toString().replace(e,"")):(t=new URL(r+i.ltrim(e,"/"))).placeholder=r,t}static urlToString(e){var t=e.toString();return e.placeholder&&(t=t.replace(e.placeholder,"")),t}static searchParamsToObject(e){var t={};for(var[s,a]of e.entries()){var n=-1==s.indexOf("[")?[s]:i.rtrim(s,"]").split(/\]?\[/);r.addPropertyToObject(t,n,a)}return t}static addPropertyToObject(e,t,s){var i=t.pop();for(var a of t)void 0===e[a]&&(e[a]=isNaN(a)?{}:[]),e=e[a];e[i]=s}static objectToSearchParams(e){var t=new URLSearchParams;for(var s in e)r.addToSearchparam(t,s,e[s]);return t}static addToSearchparam(e,t,s){if(Array.isArray(s)||"object"==typeof s)for(var i in s)r.addToSearchparam(e,t+"["+i+"]",s[i]);else e.set(t,s)}static objectToFormData(e){var t=new FormData;for(var s in e)r.addToSearchparam(t,s,e[s]);return t}static formDataToObject(e){return r.searchParamsToObject(e)}static objectToQueryString(e){return r.objectToSearchParams(e).toString()}static queryStringToObject(e){var t=new URLSearchParams(e);return r.searchParamsToObject(t)}static isValidJson(e){if("string"!=typeof e)return!1;try{JSON.parse(e)}catch(e){return!1}return!0}}e.exports=r},26:e=>{class t{static ltrim(e,t=null){t=t||"[ \t\n\r\0\v]";var s=new RegExp("^"+t+"+");return e.replace(s,"")}static rtrim(e,t=null){t=t||"[ \t\n\r\0\v]";var s=new RegExp(t+"+$");return e.replace(s,"")}static trim(e,s=" "){return e=t.ltrim(e,s),t.rtrim(e,s)}}e.exports=t},15:(e,t,s)=>{const i=s(26);class a{static getBaseHref(){return a.getDocumentBaseHref()??a.getWindowLocationBaseHref()}static getWindowLocationBaseHref(){const e=window.location;var t;return t="/"==e.pathname.slice(-1)?e.protocol+"//"+e.host+e.pathname:e.pathname.match(/\.[\w]{2,4}$/)?e.protocol+"//"+e.host+e.pathname.replace(/\/[^\/]+$/,""):e.protocol+"//"+e.host+e.pathname,i.rtrim(t,"/")+"/"}static getDocumentBaseHref(){const e=document.querySelector("base");if(!e)return null;const t=e.getAttribute("href");return t?i.rtrim(t,"/")+"/":null}static isAbsolute(e){return e instanceof URL||"http"==e.substr(0,4)}static isRelative(e){return!a.isAbsolute(e)}}e.exports=a},411:(e,t,s)=>{const i=s(923),a=s(781),r=s(15),n=s(26);class l{defaultOptions={};constructor(e={}){null!=e.baseHref&&(e.baseHref=n.rtrim(e.baseHref,"/")+"/"),this.defaultOptions=e}async fetch(e,t={}){return t.method||(t.method="get"),this.request(e,t)}async get(e,t={}){return t.method="get",this.request(e,t)}async post(e,t={}){return t.method="post",this.request(e,t)}async put(e,t={}){return t.method="put",this.request(e,t)}async delete(e,t={}){return t.method="delete",this.request(e,t)}async options(e,t={}){return t.method="options",this.request(e,t)}async patch(e,t={}){return t.method="patch",this.request(e,t)}static createRequest(e,t){return"string"==typeof e&&(e=r.isRelative(e)?new URL(e,t.baseHref||r.getBaseHref()):new URL(e)),null==t.headers&&(t.headers={}),t.queryParams&&(e=l.addToQueryString(e,t.queryParams),t.queryParams=void 0),"get"==t.method&&t.body?(e=l.addToQueryString(e,t.body),t.body=void 0):t.body&&(t.body="application/json"==l.getHeader(t.headers,"Content-Type")?a.toJson(t.body):a.toFormData(t.body)),l.clearUpOptions(t),new Request(e,t)}static clearUpOptions(e){for(var t in e)void 0===e[t]&&delete e[t];if(e.headers)for(var s in e.headers)void 0===e.headers[s]&&delete e.headers[s]}async request(e,t={}){t={...this.defaultOptions,...t};var s=l.createRequest(e,t);return fetch(s)}static addToQueryString(e,t){var s;t=a.toObject(t);var r=e instanceof URL;for(var n in s=(e=r?e:i.stringToUrl(e)).search?new URLSearchParams(e.search):new URLSearchParams,t)i.addToSearchparam(s,n,t[n]);return e.search=s.toString(),r?e:i.urlToString(e)}static getHeader(e,t){t=t.toLowerCase();for(let s in e)if(s.toLocaleLowerCase()==t)return e[s];return null}}e.exports=l},766:e=>{e.exports=class{static isA(e,t){for(var s=e.__proto__;s;){if("string"==typeof t&&s.name==t)return!0;if("function"==typeof t&&s.name==t.name)return!0;s=s.__proto__}return!1}}}},t={};function s(i){var a=t[i];if(void 0!==a)return a.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,s),r.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=class{constructor(e){this.httpClient=e}async apiCall(e,t,s=void 0,i=void 0,a=void 0){return new Promise(((r,n)=>{this.request(e,t,s,i,a).then((e=>e.json().then((t=>{e.status<400?r(t):n(t)}))))}))}request(e,t,s=void 0,i=void 0,a=void 0){var r,n={body:s,queryParams:i};switch(a&&(n={...n,...a}),e){case"post":r=this.httpClient.post(t,n);break;case"put":r=this.httpClient.put(t,n);break;case"delete":r=this.httpClient.delete(t,n);break;case"get":r=this.httpClient.get(t,n)}return r}},t=class extends e{list(){return this.apiCall("get","api/v1/collection/artists")}},i=class extends e{constructor(e,t){super(e),this.playlistId=t}read(){return this.apiCall("get","api/v1/collection/playlists/"+this.playlistId)}download(){var e=new URL("api/v1/collection/playlists/"+this.playlistId+"?download=1",this.httpClient.defaultOptions.baseHref);window.open(e.toString(),"_blank")}getItems(e=null){return this.apiCall("get","api/v1/collection/playlists/"+this.playlistId+"/items",null,e)}update(e){return this.apiCall("put","api/v1/collection/playlists/"+this.playlistId,e,null,{headers:{"Content-Type":void 0}})}delete(){return this.apiCall("delete","api/v1/collection/playlists/"+this.playlistId)}},a=class extends e{list(){return this.apiCall("get","api/v1/collection/playlists")}downloadAll(){var e=new URL("api/v1/collection/playlists?download=1",this.httpClient.defaultOptions.baseHref);window.open(e.toString(),"_blank")}create(e){return this.apiCall("post","api/v1/collection/playlists",e,null,{headers:{"Content-Type":void 0}})}get(e){return new i(this.httpClient,e)}},r=class extends e{constructor(e,t){super(e),this.uuid=t}read(){return this.apiCall("get","api/v1/collection/items/"+this.uuid)}update(e){return this.apiCall("put","api/v1/collection/items/"+this.uuid,e,null,{headers:{"Content-Type":void 0}})}delete(){return this.apiCall("delete","api/v1/collection/items/"+this.uuid)}},n=class extends e{search(e){return this.apiCall("get","api/v1/collection/items",null,e)}create(e){return this.apiCall("post","api/v1/collection/items",e,null,{headers:{"Content-Type":void 0}})}get(e){return new r(this.httpClient,e)}},l=class extends e{constructor(e,t){super(e),this.releaseId=t}getTracks(e=null){return this.apiCall("get","api/v1/discover/releases/"+this.releaseId,null,e)}},o=class extends e{search(e){return this.apiCall("get","api/v1/discover/releases",null,e)}get(e){return new l(this.httpClient,e)}},h=class extends e{search(e){return this.apiCall("get","api/v1/discover/artists",null,e)}},d=class extends e{constructor(e){super(e),this.releases=new o(e),this.artists=new h(e)}resources(e){return this.apiCall("get","api/v1/discover/resources",null,e)}},c=s(978);class u extends HTMLElement{__construct(e=null,t=null){}beforeRender(){}render(){this.innerHTML="inner html"}afterRender(){}refresh(){this.clear(),this.renderLifeCycle()}renderLifeCycle(){this.beforeRender(),this.render(),this.afterRender()}connectedCallback(){this.attached||(this.attached=!0,this.renderLifeCycle())}once(e,t,s){var i="data-once-"+e;this.hasAttribute(i)||(this.setAttribute(i,"1"),this.addEventListener(t,s))}static elementName="base-element";static register(){customElements.get(this.elementName)||customElements.define(this.elementName,this)}static instantiate(...e){if(!customElements.get(this.elementName))throw`Register this garbage <${this.elementName}> damn you, you forgot to register it! Call .register() !!`;var t=document.createElement(this.elementName);return t.__construct(...e),t}fireEvent(e,t=null,s=!0){var i={bubbles:s};null!=t&&(i.detail=t);var a=new CustomEvent(e,i);return this.dispatchEvent(a)}constructor(){super(),this.$refs={},this.attached=!1}}const p=u;class m extends p{static elementName="nav-menu";__construct(e){this.api=e}render(){this.clear(),this.classList.add("app-nav"),this.addGenericNavItem("#home","Home","fa-chevron-right"),this.addGenericNavItem("#search","Search","fa-chevron-right"),this.addGenericNavItem("#discover:artist","Discover","fa-chevron-right"),this.createAndAttach("hr"),this.$refs.playlists=this.createAndAttach("div",{class:"app-nav__playlists"}),this.createAndAttach("hr"),this.$refs.artists=this.createAndAttach("div",{class:"app-nav__artists"}),this.updatePlaylists(),this.updateArtists()}updatePlaylists(){this.api.collection.playlists.list().then((e=>{if(e.data)for(var t of e.data)this.addPlaylistNavItem(t.id,t.title);this.$refs.playlists.append(this.$refs.createPlaylist=this.createGenericNavItem(null,"Create playlist","fa-plus-circle")),this.$refs.createPlaylist.addEventListener("click",(()=>{this.fireEvent("add-playlist")})),this.$refs.playlists.append(this.$refs.downloadPlaylists=this.createGenericNavItem(null,"Download playlists","fa-download")),this.$refs.downloadPlaylists.addEventListener("click",(()=>{this.fireEvent("download-playlists")}))}))}updateArtists(){this.api.collection.artists.list().then((e=>{for(var t of e.data)this.addArtistNavItem(t)}))}addArtistNavItem(e){this.$refs.artists.createAndAttach("div",{class:"app-nav__item"},this.create("a",{href:"#search?artist="+e},e))}addPlaylistNavItem(e,t){var s;this.$refs.playlists.createAndAttach("div",{class:"app-nav__item"},[this.create("a",{href:`#playlist:${e}`,class:"ellipsis"},t),s=this.create("a",{class:"editing"},this.create("span",{class:"fa fa-pencil"}))]),s.addEventListener("click",(()=>{this.fireEvent("edit-playlist",{playlistId:e})}))}addGenericNavItem(e,t,s=null){var i=this.createGenericNavItem(e,t,s);return this.append(i),i}createGenericNavItem(e,t,s=null){var i,a;return i=this.createAndAttach("div",{class:"app-nav__item"}),a=null!=e?i.createAndAttach("a",{href:e}):i.createAndAttach("a"),s&&a.createAndAttach("span",{class:"fa "+s}),a.append(t),i}}m.register();const f=m;class g extends HTMLElement{constructor(){super(),this.state={isPaused:!1,isPlaying:!1,isReproducing:!1,isBuffering:!1,isWaiting:!1,isEnded:!1,volume:100}}appendTo(e){return e.append(this),new Promise((async(e,t)=>e()))}prependTo(e){return e.prepend(this),new Promise((async(e,t)=>e()))}appendAfter(e){return e.after(this),new Promise((async(e,t)=>e()))}get isPaused(){return this.state.isPaused}get isPlaying(){return this.state.isPlaying}get isReproducing(){return this.state.isReproducing}get isWaiting(){return this.state.isWaiting}get isBuffering(){return this.state.isBuffering}get isEnded(){return this.state.isEnded}get volume(){return this.state.volume}get currentTime(){}get currentTimeFormatted(){return g.secondsToStringRepresentation(this.currentTime)}get currentTimePercentage(){var e,t;return e=Math.round(this.currentTime),t=Math.round(this.duration),isNaN(e)||isNaN(t)||0==e||0==t?0:e/t*100}get remainingTime(){return this.duration-this.currentTime}get remainingTimeFormatted(){return g.secondsToStringRepresentation(this.remainingTime)}get remainingTimePercentage(){return 100-this.currentTimePercentage}get duration(){}get durationFormatted(){return g.secondsToStringRepresentation(this.duration)}getTime(e){return Math.round(this.duration/100*e)}getTimeFormatted(e){return g.secondsToStringRepresentation(this.getTime(e))}getPercentage(e){return("string"==typeof e&&e.indexOf(":")>=0?g.stringRepresentationToSeconds(e):parseFloat(e))/this.duration*100}seek(e){}play(e=null){}pause(){}toggle(){this.isPlaying?this.pause():this.play()}sanitizeGetSeconds(e){var t;return t="string"==typeof e&&e.indexOf(":")>=0?g.stringRepresentationToSeconds(e):"string"==typeof e&&e.indexOf("%")>=0?this.getTime(parseInt(e)):"string"==typeof e?parseInt(e):e,isNaN(t)&&(t=0),t}fireEvent(e,t,s=!0){var i={bubbles:s};null!=t&&(i.detail=t);var a=new CustomEvent(e,i);return this.dispatchEvent(a)}log(e){console.log(e)}static secondsToStringRepresentation(e){return isNaN(e)?"00:00":(e=Math.round(e),n=(a=(a=(s=Math.floor(e/60))-60*(t=Math.floor(s/60)))<10?"0"+a:a)+":"+(r=(r=e-60*s)<10?"0"+r:r),n=(i=t)>0?i+":"+n:n);var t,s,i,a,r,n}static stringRepresentationToSeconds(e){var t,s,i;return!((t=e.match(/[0-9]+/g)).length>3)&&(i=parseInt(t[t.length-1]),s=parseInt(t[t.length-2]||0),3600*parseInt(t[t.length-3]||0)+60*s+i)}}const y=g,v=class{static async loadExternalJs(e,t=null){return new Promise((async function(s,i){var a;(a=document.createElement("script")).async=!0,a.type="text/javascript",a.onload=function(e){s("SCRIPT: loaded")},a.onerror=function(e){i("SCRIPT: failed to load")},a.src=e,(t=t||document.body).appendChild(a)}))}};class b extends y{static sdkLoaded=!1;static sdkLoading=!1;static sdkPromise=null;static defaults={width:640,height:null};constructor(){super(),this.state.currentTime=0,this.state.playerInitialized=!1;var e={embbedId:"youtube-embbed-"+Math.floor(1e4*Math.random()),id:null};this.settings={...b.defaults,...e},this.html={},this.follower=null}connectedCallback(){this.html.embed||this.setUp()}setUp(){var e,t,s,i;return this.html.embed=this.createDiv(this.settings.embbedId,this),(e=this.getAttribute("src"))&&(this.src=e),(t=this.getAttribute("video-id"))&&(this.videoId=t),(s=this.getAttribute("width"))&&(this.width=s),(i=this.getAttribute("height"))&&(this.height=i),this.readyToPlayPromise=b.loadSdk().then((()=>this.initializePlayer()))}remove(){this.html.ytPlayer&&this.html.ytPlayer.destroy(),super.remove()}appendTo(e){return e.append(this),this.readyToPlayPromise}prependTo(e){return e.prepend(this),this.readyToPlayPromise}appendAfter(e){return e.after(this),this.readyToPlayPromise}set src(e){this.settings.id=b.getIdFromUrl(e)}set videoId(e){this.settings.id=e}set width(e){this.settings.width=parseInt(e),this.updateDimensions()}set height(e){this.settings.height=parseInt(e),this.updateDimensions()}updateDimensions(){if(this.html.ytPlayer){var e=this.settings.width,t=this.settings.height;e="auto"==e||"100%"==e?this.offsetWidth:e,t=null==t?e/1.77:t;var s=this.html.ytPlayer.getIframe();s.width=e,s.height=t}}get currentTime(){return this.state.currentTime}get duration(){return this.html.ytPlayer&&this.html.ytPlayer.getDuration?this.html.ytPlayer.getDuration():0}seek(e){if(!this.state.playerInitialized)return!1;var t=this.sanitizeGetSeconds(e);this.html.ytPlayer.seekTo(t,!0)}play(e=null){if(e&&this.seek(e),!this.state.playerInitialized)return!1;this.html.ytPlayer.playVideo()}pause(){if(!this.state.playerInitialized)return!1;this.html.ytPlayer.pauseVideo()}setVolume(e){this.state.volume=e,this.state.playerInitialized&&this.html.ytPlayer.setVolume(e)}async initializePlayer(){return new Promise((async(e,t)=>{var s=this.settings.width,i=this.settings.height;s="auto"==s?this.offsetWidth:s,i=null==i?s/1.77:i,this.html.ytPlayer=new YT.Player(this.settings.embbedId,{width:s,height:i,videoId:this.settings.id,startSeconds:0,host:"https://www.youtube.com",playerVars:{autoplay:1,controls:0},events:{onReady:t=>{e(this),this.setVolume(this.volume),this.state.playerInitialized=!0},onError:e=>{var s=b.getErrorDescription(e.data);t(s),this.fireEvent("player:error",{errorCode:e.data,errorMessage:s})},onStateChange:this.callBackOnStateChange.bind(this)}})}))}callBackOnStateChange(e){switch(e.data){case-1:this.state.isReproducing=!1,this.state.isPlaying=!1,this.state.isPaused=!1;break;case 0:this.state.isReproducing=!1,this.state.isPlaying=!1,this.state.isPaused=!0,this.state.isWaiting=!1,this.state.isEnded=!0,this.stopFollowing(),this.fireEvent("player:ended");break;case 1:var t=this.state.isWaiting;this.state.isReproducing=!0,this.state.isPlaying=!0,this.state.isPaused=!1,this.state.isBuffering=!1,this.state.isWaiting=!1,this.state.isEnded=!1,this.startFollowing(),t?this.fireEvent("player:playing"):this.fireEvent("player:play");break;case 2:this.state.isReproducing=!1,this.state.isPlaying=!1,this.state.isPaused=!0,this.state.isWaiting=!1,this.fireEvent("player:pause");break;case 3:this.state.isReproducing=!1,this.state.isPlaying=!0,this.state.isPaused=!1,this.state.isBuffering=!0,this.state.isWaiting=!0,this.fireEvent("player:waiting");break;case 5:this.play(0),this.fireEvent("player:play")}}startFollowing(){this.follower=setInterval(this.following.bind(this),1e3)}stopFollowing(){clearInterval(this.follower)}following(){var e=this.html.ytPlayer&&this.html.ytPlayer.getCurrentTime?this.html.ytPlayer.getCurrentTime():0;e!=this.currentTime&&(this.state.currentTime=e,this.fireEvent("player:timeupdate"))}static getErrorDescription(e){switch(e){case"2":return"Error 2: invalid parameters.";case"5":return"Error 5: An error related to the HTML5 player occurred.";case"100":return"Error 100: Video not found.";case"101":case"150":return"Error 101: The video's owner won't allow it on embbed players."}return"Error "+e+": Unknown error"}static getIdFromUrl(e){var t;return(t=e.match(/v=([A-Za-z0-9-_]+)/))||(t=e.match(/\.be\/([A-Za-z0-9-_]+)/))||(t=e.match(/embed\/([A-Za-z0-9-_]+)/))?t[1]:null}static async loadSdk(){return b.sdkLoaded?new Promise((async(e,t)=>{e()})):"undefined"!=typeof YT&&void 0!==YT.Player?(b.sdkLoaded=!0,new Promise((async(e,t)=>{e()}))):b.sdkLoading?b.sdkPromise:b.sdkPromise=new Promise((async(e,t)=>{v.loadExternalJs("https://www.youtube.com/iframe_api").then((async()=>{setTimeout((()=>{b.sdkLoaded=!0,e("YouTube SDK ready")}),500)}),(()=>{t("Error loading SDK")}))}))}createDiv(e,t){var s=document.createElement("div");return s.id=e,t.append(s),s}}const A=b;class w extends HTMLElement{constructor(){super(),this.state={isPaused:!1,isPlaying:!1,isReproducing:!1,isBuffering:!1,isWaiting:!1,isEnded:!1,volume:100}}appendTo(e){return e.append(this),new Promise((async(e,t)=>e()))}prependTo(e){return e.prepend(this),new Promise((async(e,t)=>e()))}appendAfter(e){return e.after(this),new Promise((async(e,t)=>e()))}get isPaused(){return this.state.isPaused}get isPlaying(){return this.state.isPlaying}get isReproducing(){return this.state.isReproducing}get isWaiting(){return this.state.isWaiting}get isBuffering(){return this.state.isBuffering}get isEnded(){return this.state.isEnded}get volume(){return this.state.volume}get currentTime(){}get currentTimeFormatted(){return w.secondsToStringRepresentation(this.currentTime)}get currentTimePercentage(){var e,t;return e=Math.round(this.currentTime),t=Math.round(this.duration),isNaN(e)||isNaN(t)||0==e||0==t?0:e/t*100}get remainingTime(){return this.duration-this.currentTime}get remainingTimeFormatted(){return w.secondsToStringRepresentation(this.remainingTime)}get remainingTimePercentage(){return 100-this.currentTimePercentage}get duration(){}get durationFormatted(){return w.secondsToStringRepresentation(this.duration)}getTime(e){return Math.round(this.duration/100*e)}getTimeFormatted(e){return w.secondsToStringRepresentation(this.getTime(e))}getPercentage(e){return("string"==typeof e&&e.indexOf(":")>=0?w.stringRepresentationToSeconds(e):parseFloat(e))/this.duration*100}seek(e){}play(e=null){}pause(){}toggle(){this.isPlaying?this.pause():this.play()}sanitizeGetSeconds(e){var t;return t="string"==typeof e&&e.indexOf(":")>=0?w.stringRepresentationToSeconds(e):"string"==typeof e&&e.indexOf("%")>=0?this.getTime(parseInt(e)):"string"==typeof e?parseInt(e):e,isNaN(t)&&(t=0),t}fireEvent(e,t,s=!0){var i={bubbles:s};null!=t&&(i.detail=t);var a=new CustomEvent(e,i);return this.dispatchEvent(a)}log(e){console.log(e)}static secondsToStringRepresentation(e){return isNaN(e)?"00:00":(e=Math.round(e),n=(a=(a=(s=Math.floor(e/60))-60*(t=Math.floor(s/60)))<10?"0"+a:a)+":"+(r=(r=e-60*s)<10?"0"+r:r),n=(i=t)>0?i+":"+n:n);var t,s,i,a,r,n}static stringRepresentationToSeconds(e){var t,s,i;return!((t=e.match(/[0-9]+/g)).length>3)&&(i=parseInt(t[t.length-1]),s=parseInt(t[t.length-2]||0),3600*parseInt(t[t.length-3]||0)+60*s+i)}}const P=w;class R extends p{static elementName="popup-menuitem";__construct(e,t,s,i,a){this.parentMenu=e,this.title=t,this.helpText=s,this.icon=i,this.onClick=a}render(){this.classList.add("popup-menu__item"),this.$refs.body=this.createAndAttach("div",{title:this.helpText},this.title),this.addEventListener("click",this.onClick),this.addEventListener("click",(e=>{e.stopPropagation(),this.parentMenu.close()}))}}R.register();const T=R;class $ extends p{static elementName="popup-menu";__construct(e=[]){this.menuItems=e,this.opened=!1,window.addEventListener("click",(e=>{e&&e.menuOpened==this||this.close()}))}render(){this.classList.add("popup-menu"),this.$refs.list=this.createAndAttach("div",{class:"popup-menu__list"}),this.opened&&this.subRenderItems()}subRenderItems(){for(var e of this.menuItems)this.$refs.list.append(T.instantiate(this,e.title,e.helpText,e.icon,e.onClick))}open(e,t=0,s=0){var i,a,r,n;e.menuOpened=this,this.opened=!0,this.refresh(),r=this.$refs.list.offsetWidth,n=this.$refs.list.offsetHeight,i=t+r>window.innerWidth?window.innerWidth-r:t,a=s+n>window.innerHeight?window.innerHeight-n:s,this.style.left=i+"px",this.style.top=a+"px",this.fireEvent("popup-opened")}close(){this.false=!0,this.clear(),this.fireEvent("popup-closed")}addItem(e,t,s,i){return this.menuItems.push({title:e,helpText:t,icon:s,onClick:i}),this}}$.register();const E=$;class L extends p{static elementName="popup-button";__construct(e=[]){this.menuItems=e,this.menu=null}render(){this.classList.add("popup-button");var e,t="";1==this.menuItems.length?(e="fa "+this.menuItems[0].icon,t=this.menuItems[0].title):e="fa fa-ellipsis-v",this.$refs.button=this.createAndAttach("button",null,this.create("span",{title:t,class:e})),this.once("click","click",this.onClick.bind(this)),this.once("popup-closed","popup-closed",(()=>{this.$refs.popupMenu.remove(),this.$refs.popupMenu=null}))}onClick(e){var t=this.menuItems.length;0!=t&&(1!=t?this.$refs.popupMenu||(this.$refs.popupMenu=this.attach(E.instantiate(this.menuItems)),this.$refs.popupMenu.open(e,e.clientX,e.clientY)):this.menuItems[0].onClick(e))}addItem(e,t,s,i){return this.menuItems.push({title:e,helpText:t,icon:s,onClick:i}),this.refresh(),this}}L.register();const I=L;class S extends p{static elementName="playlist-item";__construct(e={},t={}){this.item=e,this.options=t,this.item.artist?this.item.artist=Array.isArray(this.item.artist)?this.item.artist:[this.item.artist]:this.item.artist=[],this.item.soundtrack?this.item.soundtrack=Array.isArray(this.item.soundtrack)?this.item.soundtrack:[this.item.soundtrack]:this.item.soundtrack=[]}render(){this.innerHTML="",this.classList.add("playlist-item"),this.subRenderHeader(),this.subRenderBody(),this.subRenderFooter()}subRenderHeader(){this.options.disablePlayButton||(this.$refs.header=this.createAndAttach("div",{class:"playlist-item__header"},[this.$refs.playButton=this.create("button",null,this.createAndAttach("span",{class:"fa fa-play"}))]),this.$refs.playButton.addEventListener("click",(()=>{this.fireEvent("item-selected",{item:this.item})})))}subRenderBody(){for(var e of(this.$refs.body=this.createAndAttach("div",{class:"playlist-item__body"}),this.item.title&&(this.$refs.title=this.$refs.body.createAndAttach("span",{class:"playlist-item__title"},[this.item.title])),this.item.artist))this.$refs.body.createAndAttach("span",{class:"playlist-item__artist playlist-item__info"},[this.create("a",{href:`#search?artist=${e}`},e)," ",this.create("a",{href:`#discover:releases?artist=${e}`},this.createAndAttach("span",{class:"fa fa-search"}))]);for(var t of this.item.soundtrack)this.$refs.body.createAndAttach("span",{class:"playlist-item__soundtrack playlist-item__info"},[this.create("a",{href:`#search?soundtrack=${t}`},t)])}subRenderFooter(){this.$refs.footer=this.createAndAttach("div",{class:"playlist-item__footer"});var e=[];e.push({title:"Add to playlist",helpText:"choose a playlist",icon:"fa-plus",onClick:()=>{this.fireEvent("item-to-add",{items:[this.item]})}}),this.item.uuid&&(e.push({title:"Edit item",helpText:"",icon:"fa-pencil",onClick:()=>{this.fireEvent("edit-item",{uuid:this.item.uuid})}}),e.push({title:"Remove item",helpText:"",icon:"fa-times",onClick:()=>{this.fireEvent("delete-item",{uuid:this.item.uuid})}})),this.$refs.popupButton=this.$refs.footer.attach(I.instantiate(e))}}S.register();const x=S;customElements.define("player-youtube",A),customElements.define("player-audio",class extends P{constructor(){super(),this.settings={src:null}}connectedCallback(){this.mediaP||this.setUp()}setUp(){this.mediaP=this.createMedia(),this.mediaP.src=this.settings.src,this.append(this.mediaP),this.mediaP.addEventListener("play",(e=>{this.state.isPaused=!1,this.state.isPlaying=!0,this.state.isWaiting=!1,this.fireEvent("player:play")})),this.mediaP.addEventListener("pause",(e=>{this.state.isPlaying=!1,this.state.isPaused=!0,this.state.isReproducing=!1,this.fireEvent("player:pause")})),this.mediaP.addEventListener("timeupdate",(e=>{this.state.isReproducing=!0,this.state.isEnded=!1,this.fireEvent("player:timeupdate")})),this.mediaP.addEventListener("ended",(e=>{this.state.isPlaying=!1,this.state.isPaused=!0,this.state.isReproducing=!1,this.state.isWaiting=!1,this.state.isEnded=!0,this.fireEvent("player:ended")})),this.mediaP.addEventListener("error",(e=>{this.fireEvent("player:error",{errorCode:0,errorMessage:"Resource could not be loaded"})})),this.mediaP.addEventListener("loadstart",(e=>{this.state.isBuffering=!0})),this.mediaP.addEventListener("progress",(e=>{this.state.isBuffering=!0})),this.mediaP.addEventListener("waiting",(e=>{this.state.isReproducing=!1,this.state.isBuffering=!0,this.state.isWaiting=!0,this.fireEvent("player:waiting")})),this.mediaP.addEventListener("playing",(e=>{this.state.isWaiting=!1,this.fireEvent("player:playing")})),this.mediaP.addEventListener("canplaythrough",(e=>{this.state.isBuffering=!1,this.state.isWaiting=!1})),this.mediaP.addEventListener("canplay",(e=>{this.state.isBuffering=!1,this.state.isWaiting=!1})),this.mediaP.addEventListener("suspend",(e=>{this.state.isBuffering=!1})),this.mediaP.addEventListener("abort",(e=>{this.state.isBuffering=!1})),this.mediaP.addEventListener("stalled",(e=>{this.state.isBuffering=!1}))}set src(e){this.settings.src=e}get currentTime(){return this.mediaP.currentTime}get duration(){return this.mediaP.duration}play(e=this.currentTime){return this.seek(e),this.mediaP.play()}pause(){this.mediaP.pause()}seek(e){var t=this.sanitizeGetSeconds(e);this.mediaP.currentTime=t}setVolume(e){this.state.volume=e;var t=e>0?e/100:e;this.mediaP.volume=t}createMedia(){return new Audio}});class k extends p{static elementName="reproduction-controls";__construct(e,t=null,s=null){this.api=e,this.item=t,this.resources=s,this.index=0,this.player=null,this.settings=new class{constructor(e,t=null){this.name=e,t?this.data=t:this.load()}get(e,t=null){return null==this.data[e]?t:this.data[e]}getInt(e,t=0){return parseInt(this.get(e,t))}set(e,t){this.data[e]=t,this.save()}save(){var e=JSON.stringify(this.data);localStorage.setItem(this.name,e)}load(){var e=localStorage.getItem(this.name);return this.data=e?JSON.parse(e):{}}}("controls.settings")}render(){this.classList.add("reproduction-controls"),this.subRenderItem(),this.subRenderClock(),this.subRenderButtons(),this.subRenderVolume(),this.subRenderQueueButton(),this.subRenderProgressBar(),this.$refs.playerFrame=this.createAndAttach("div",{class:"player-frame intangible"}),this.resources&&(this.addEventListener("player:timeupdate",this.onTimeUpdate.bind(this)),this.addEventListener("player:ended",(()=>{console.log("Reproduction: ended")})),this.addEventListener("player:pause",(()=>{console.log("Reproduction: paused")})),this.playResource())}subRenderItem(){this.item&&(this.$refs.playlistItem=this.attach(x.instantiate(this.item,{disablePlayButton:!0}))),this.resources&&this.resources.length&&(this.$refs.buttonNotIt=this.createAndAttach("button",{class:"reproduction-controls__not-it",title:"not it"},this.create("span",{class:"fa fa-refresh"})),this.$refs.buttonNotIt.addEventListener("click",this.notIt.bind(this)))}subRenderClock(){this.$refs.timer=this.createAndAttach("span",{class:"reproduction-controls__timer"},"--:--")}subRenderButtons(){this.createAndAttach("div",{class:"reproduction-controls__buttons button-group"},[this.$refs.buttonBackward=this.createAndAttach("button",{class:"reproduction-controls__button-next"},this.create("span",{class:"fa fa-backward"})),this.$refs.buttonPlay=this.createAndAttach("button",{class:"reproduction-controls__button-play"},this.create("span",{class:"fa fa-play"})),this.$refs.buttonNext=this.createAndAttach("button",{class:"reproduction-controls__button-next"},this.create("span",{class:"fa fa-forward"}))]),this.$refs.buttonPlay.addEventListener("click",this.toggle.bind(this)),this.$refs.buttonBackward.addEventListener("click",(()=>{this.fireEvent("controls:backward")})),this.$refs.buttonNext.addEventListener("click",(()=>{this.fireEvent("controls:forward")}))}subRenderVolume(){this.$refs.volumeControl=this.createAndAttach("input",{type:"range",min:0,max:100,step:1,class:"reproduction-controls__volume"}),this.$refs.volumeControl.value=this.settings.getInt("volume",15),this.$refs.volumeControl.addEventListener("change",this.dialVolume.bind(this))}subRenderQueueButton(){this.$refs.buttonQueue=this.createAndAttach("button",{class:"reproduction-controls__button-queue",title:"Queue"},this.create("span",{class:"fa fa-list"})),this.$refs.buttonQueue.addEventListener("click",(()=>{this.fireEvent("summon-queue")}))}subRenderProgressBar(){this.$refs.progress=this.createAndAttach("progress",{max:100,class:"reproduction-controls__progress"}),this.$refs.progress.addEventListener("click",this.seek.bind(this))}notIt(){this.resources[this.index+1]?(this.index++,this.destroyPlayer(),this.playResource(this.index)):alert("no more alternatives")}playResource(e=0){console.log("Reproduction: booting player"),window.player=this.player=this.createPlayer(this.resources[e]),this.player.appendTo(this.$refs.playerFrame).then((()=>{this.player.play(),this.player.setVolume(this.settings.getInt("volume",15)),console.log("Reproduction: reproducing audio")}))}destroyPlayer(){return this.player&&(this.player.pause(),this.player.remove()),this}createPlayer(e){switch(e.source){case"youtube":return this.createPlayerYouTube(e);case"sliderkz":return this.createPlayerSliderKz(e)}}createPlayerYouTube(e){var t=document.createElement("player-youtube");return t.videoId=e.id,t.width=390,t}createPlayerSliderKz(e){var t=document.createElement("player-audio");return t.src=e.src,t}toggle(){this.player&&this.player.toggle()}onTimeUpdate(){this.$refs.timer.innerHTML=this.player.currentTimeFormatted,this.$refs.progress.value=this.player.currentTimePercentage}dialVolume(e){var t=e.target.value;this.settings.set("volume",t),this.player&&this.player.setVolume(t)}seek(e){var t,s,i;this.player&&(t=e.clientX-this.$refs.progress.offsetLeft,s=this.$refs.progress.offsetWidth,i=Math.ceil(t/s*100)+"%",this.player.seek(i))}}k.register();const q=k,_=class extends p{static elementName="view-welcome";__construct(e,t){this.request=e,this.api=t}afterRender(){this.classList.add("view")}};class N extends _{static elementName="view-welcome";render(){var e=document.createElement("p");e.innerHTML="Welcome back",this.append(e)}}N.register();const C=N;var M=s(781),H=s.n(M),F=s(923),B=s.n(F);class O extends p{static elementName="view-search-header";__construct(e,t,s){this.request=e,this.title=t,this.fields=s}render(){var e;for(var t of(this.classList.add("search-header"),this.createAndAttach("h1",null,this.title),this.$refs.form=this.createAndAttach("form",{class:"search-header__form input-group input-group-horizontal"}),this.fields))t.value=this.request.queryParams.get(t.name)||"",e=this.$refs.form.createAndAttach("input",t),t.value.length&&(e.focus(),e.selectionStart=e.selectionEnd=e.value.length);this.$refs.form.createAndAttach("button",null,[this.create("span",{class:"fa fa-search"})]),this.$refs.form.addEventListener("submit",(e=>{e.preventDefault(),window.location.href=this.request.path+"?"+B().objectToSearchParams(H().toObject(this.$refs.form)).toString()}))}}O.register();const D=O;class U extends p{static elementName="view-pagination";__construct(e,t,s){this.api=e,this.request=t,this.response=s,this.response.meta&&this.response.meta.pages&&(this.max=10,this.halfMax=this.max/2,this.response.meta.pages<=this.max?(this.first=1,this.last=this.response.meta.pages):this.response.meta.page+this.halfMax>this.response.meta.pages?(this.last=this.response.meta.pages,this.first=this.last-this.max):this.response.meta.page>this.halfMax?(this.first=this.response.meta.page-this.halfMax,this.last=this.response.meta.page+this.halfMax):(this.first=1,this.last=this.first+this.max))}render(){this.classList.add("button-group"),this.classList.add("view-nav"),this.response.meta&&this.response.meta.pages&&(this.first>1&&this.subRenderAnchorToBeginning(),this.response.meta.page>1&&this.subRenderAnchorToPreviousPage(),this.response.meta.pages>this.max&&this.subRenderAnchorBetweenExtremes(),this.response.meta.page<this.last&&this.subRenderAnchorToNextPage(),this.response.meta.pages>this.last&&this.subRenderAnchorToLast())}subRenderAnchorToBeginning(){var e=this.request.queryParams.without("page");e.set("page",1),this.createAndAttach("a",{href:this.request.path+"?"+e.toString(),class:"btn view-nav-first"},["first"])}subRenderAnchorToPreviousPage(){var e=this.request.queryParams.without("page");e.set("page",this.response.meta.page-1),this.createAndAttach("a",{href:this.request.path+"?"+e.toString(),class:"btn view-nav-previous"},["prev"])}subRenderAnchorBetweenExtremes(){for(var e=this.first;e<=this.last;e++){var t=this.request.queryParams.without("page");t.set("page",e);var s=this.response.meta.page==e;this.createAndAttach("a",{href:this.request.path+"?"+t.toString(),class:s?"btn view-nav-current":"btn"},[e])}}subRenderAnchorToNextPage(){var e=this.request.queryParams.without("page");e.set("page",this.response.meta.page+1),this.createAndAttach("a",{href:this.request.path+"?"+e.toString(),class:"btn view-nav-next"},["next"])}subRenderAnchorToLast(){var e=this.request.queryParams.without("page");e.set("page",this.response.meta.pages),this.createAndAttach("a",{href:this.request.path+"?"+e.toString(),class:"btn view-nav-last"},["last"])}}U.register();const j=U;class V{static enableBottomReached(e){e.addEventListener("scroll",V.onScroll.bind(e))}static onScroll(e){this.scrollTop+this.offsetHeight>=this.scrollHeight&&this.dispatchEvent(new CustomEvent("scroll-bottom-reached",{bubbles:!1}))}}const Q=V,W=class{constructor(e){this.api=e,this.noMore=!1}progress(){}async fetchMore(e){return this.noMore?new Promise(((e,t)=>e({data:[]}))):(this.progress(),this.request(e).then((e=>(console.log(e),e.data&&0!=e.data.length||(this.noMore=!0),e))))}async request(e){}},G=class extends W{constructor(e,t){super(e),this.queryParams=t}progress(){var e=parseInt(this.queryParams.get("page")||1)+1;this.queryParams.set("page",e)}async request(e){return this.api.collection.playlistItems.search(this.queryParams)}},z=class extends G{constructor(e,t,s){super(e,t),this.playlistId=s}async request(e){return this.api.collection.playlists.get(this.playlistId).getItems(this.queryParams)}};class J extends Array{static instantiate(e=[],t){var s=new J;return s.enqueue(e),s.context=t,s.fetchingPromise=null,s.length<=1&&s.fetchMore(),s}enqueue(e){Array.isArray(e)?this.enqueueMultiple(e):this.enqueueSingle(e)}dequeue(){var e=this[0]||null;return this.splice(0,1),this.updatedCallback(),e}dropIn(e){this.splice(0,0,e),this.updatedCallback()}move(e,t=0){console.log(e,t);var s=this.splice(e,1)[0];return this.splice(t,0,s),this.updatedCallback(),s}get front(){return this[0]?this[0]:(console.log("Queue: end reached"),null)}get back(){return this.length?this[this.length-1]:null}async getNextInLine(){return this.length>=2?new Promise(((e,t)=>e(this[1]))):this.fetchMore().then((e=>this[1]||null))}async fetchMore(){return console.log("Queue: Searching for more content"),this.fetchingPromise?this.fetchingPromise:this.fetchingPromise=this.context.fetchMore(this).then((e=>(this.fetchingPromise=null,e.data&&e.data.length?this.enqueue(e.data):console.log("Queue: nothig more to add to the queue"),e)))}enqueueMultiple(e){this.push(...e),console.log("Queue: multiple items added"),this.updatedCallback()}enqueueSingle(e){this.push(e),console.log("Queue: single item added"),this.updatedCallback()}updatedCallback(){console.log("queue updated")}}const Y=J;class K extends _{static elementName="view-playlist";async render(){this.fetch().then((e=>{this.subRenderHeader(e),this.subRenderItems(e),this.subRenderNavigation(e),this.subRenderButtonGroup()})),Q.enableBottomReached(this),this.addEventListener("scroll-bottom-reached",this.bottomReached.bind(this)),this.addEventListener("item-selected",this.onItemSelected.bind(this))}bottomReached(e){console.log("Bottom of the page reached")}fetch(){return this.api.collection.playlists.get(this.request.attributes.playlistId).getItems(this.request.queryParams)}subRenderHeader(e){return this.append(D.instantiate(this.request,e.playlist?e.playlist.title:this.request.attributes.playlistId,[{type:"search",name:"title",placeholder:"Title",class:"main"},{type:"search",name:"artist",placeholder:"Artist"},{type:"search",name:"genre",placeholder:"Genre"}]))}async subRenderItems(e){if(e.data)for(var t of(this.$refs.playlist=this.createAndAttach("div",{class:"playlist"}),e.data))this.$refs.playlist.attach(x.instantiate(t))}subRenderNavigation(e){this.append(j.instantiate(this.api,this.request,e))}subRenderButtonGroup(){this.createAndAttach("div",{class:"input-group input-group-horizontal"},[this.$refs.buttonCreate=this.create("button",{class:"main"},"New Item"),this.$refs.buttonDelete=this.create("button",{class:"btn-danger"},"Delete playlist")]),this.$refs.buttonCreate.addEventListener("click",(()=>{this.fireEvent("add-item",{playlist:this.request.attributes.playlistId})})),this.$refs.buttonDelete.addEventListener("click",(()=>{this.fireEvent("delete-playlist",{playlist:this.request.attributes.playlistId})}))}onItemSelected(e){var t=[];for(var s of this.querySelectorAll(x.elementName))t.push(s.item);for(var i in t)if(t[i]==e.detail.item){t=t.slice(i);break}var a=new z(this.api,this.request.queryParams,this.request.attributes.playlistId),r=Y.instantiate(t,a);e.detail.queue=r}}K.register();const Z=K;class X extends _{static elementName="view-discography";async render(){this.api.discover.releases.search(this.request.queryParams).then((e=>{this.renderHeader(e),this.renderReleases(e),this.renderNavigation(e)}))}renderHeader(e){var t=D.instantiate(this.request,"Discover albums",[{type:"search",name:"artist",placeholder:"artist",class:"main"}]);this.append(t)}async renderReleases(e){var t=this.createAndAttach("div",{class:"grid releases"});for(var s of e.data)t.createAndAttach("a",{href:`#discover:release:${s.id}`,class:"col-6 col-sm-4 col-md-3 col-lg-2"},[this.create("span",{class:"card"},[this.create("img",{src:s.thumbnail||"dist/img/missing-cover-art.webp"}),this.create("h4",null,[s.title])])])}renderNavigation(e){this.append(j.instantiate(this.api,this.request,e))}}X.register();const ee=X,te=class extends W{constructor(e){super(e),this.noMore=!0}async fetchMore(e){return new Promise(((e,t)=>e({data:[]})))}};class se extends _{static elementName="view-release";async render(){this.api.discover.releases.get(this.request.attributes.releaseId).getTracks().then((e=>{this.subRenderHeader(e),this.renderTracks(e)})),this.addEventListener("item-selected",this.onItemSelected.bind(this)),this.classList.add("release-view")}subRenderHeader(e){this.createAndAttach("div",{class:"release-view-header"},[this.create("img",{src:e.data.thumbnail||"dist/img/missing-cover-art.webp"}),this.create("div",{class:"release-view-label"},[this.create("h1",null,e.data.title),this.create("h3",null,this.create("a",{href:"#discover:releases?artist="+e.data.artist},e.data.artist))]),this.$refs.addButton=this.create("button",null,this.createAndAttach("span",{class:"fa fa-plus"}))]),this.$refs.addButton.addEventListener("click",this.addEntireRelease.bind(this))}addEntireRelease(){var e=[];this.querySelectorAll(x.elementName).forEach((t=>{e.push(t.item)})),this.fireEvent("item-to-add",{items:e})}async renderTracks(e){if(e.data.tracks)for(var t of(this.$refs.playlist=this.createAndAttach("div",{class:"playlist"}),e.data.tracks))this.$refs.playlist.append(x.instantiate({title:t,artist:e.data.artist,album:e.data.title}))}onItemSelected(e){var t=[];for(var s of this.querySelectorAll(x.elementName))t.push(s.item);for(var i in t)if(t[i]==e.detail.item){t=t.slice(i);break}var a=new te(this.api),r=Y.instantiate(t,a);e.detail.queue=r}}se.register();const ie=se;class ae extends Z{static elementName="view-search";fetch(){return this.request.queryParams.isEmpty()?new Promise(((e,t)=>e({}))):this.api.collection.playlistItems.search(this.request.queryParams)}subRenderHeader(e){this.append(D.instantiate(this.request,"Search",[{type:"search",name:"title",placeholder:"Title",class:"main"},{type:"search",name:"artist",placeholder:"Artist"},{type:"search",name:"genre",placeholder:"Genre"}]))}subRenderButtonGroup(){}onItemSelected(e){var t=[];for(var s of this.querySelectorAll(x.elementName))t.push(s.item);for(var i in t)if(t[i]==e.detail.item){t=t.slice(i);break}var a=new G(this.api,this.request.queryParams),r=Y.instantiate(t,a);e.detail.queue=r}}ae.register();const re=ae;class ne extends _{static elementName="view-discover";async render(){this.fetch().then((e=>{this.renderHeader(e),this.renderArtists(e)}))}fetch(){return this.request.queryParams.isEmpty()?new Promise(((e,t)=>e({data:[]}))):this.api.discover.artists.search(this.request.queryParams)}renderHeader(e){var t=D.instantiate(this.request,"Discover artist",[{type:"search",name:"name",placeholder:"name",class:"main"}]);this.append(t)}async renderArtists(e){var t=this.createAndAttach("div",{class:"grid artists"});for(var s of e.data)t.createAndAttach("a",{href:`#discover:releases?artist=${s.name}`,class:"col-6 col-sm-4 col-md-3 col-lg-2"},[this.create("span",{class:"card"},[s.thumbnail?this.create("img",{src:s.thumbnail}):null,this.create("h4",null,[s.name])])])}}ne.register();const le=ne;class oe extends _{static elementName="not-found";async render(){this.createAndAttach("h1",null,"Not found"),this.createAndAttach("p",null,`Nothing found related to ${this.request.path}`)}}oe.register();const he=oe;var de=s(766),ce=s.n(de);class ue{constructor(e,t){this.path=e,this.queryParams=t,this.attributes={}}static createFromGlobals(){if(!location.hash)return new ue("",new URLSearchParams(""));var e=new URL(location.hash.replace("#","/"),"https://"+location.hostname);return new ue(e.pathname.replace(/^\//,"#"),new URLSearchParams(e.search))}}const pe=ue,me=class extends Array{add(e){Array.isArray(e)?this.addMultiple(e):this.addSingle(e)}get theMostRecent(){return this.length?this[0]:null}get theOldest(){return this.length?this[this.length-1]:null}rewind(e=1){return this.splice(0,e)}addMultiple(e){this.splice(0,0,...e),console.log("History: multiple items added"),this.updatedCallback()}addSingle(e){this.splice(0,0,e),console.log("History: single item added"),this.updatedCallback()}updatedCallback(){console.log("history updated")}};class fe extends p{static elementName="queue-display";constructor(){super(),this.isOpen=!1}open(){this.isOpen=!0,this.classList.add("open")}close(){this.isOpen=!1,this.classList.remove("open")}toggle(){this.isOpen?this.close():this.open()}render(){this.classList.add("queue-display"),this.createAndAttach("div",{class:"queue-display__drawer"},this.$refs.content=this.create("div",{class:"queue-display__content"},[this.$refs.history=this.create("ol",{reversed:"reversed"}),this.create("hr"),this.$refs.queued=this.create("ol")]))}showQueue(e,t){this.$refs.history.clear(),this.$refs.queued.clear();for(var s=t.length-1;s>=0;s--)this.$refs.history.createAndAttach("li",null,this.create("div",{class:"ellipsis"},t[s].title));for(s=0;s<e.length;s++)this.$refs.queued.createAndAttach("li",null,this.create("div",{class:"ellipsis"},e[s].title)).addEventListener("click",(e=>{var t=[...this.$refs.queued.children].indexOf(e.target);this.fireEvent("queue:jump",{from:t,to:0})}))}}fe.register();const ge=fe;class ye extends p{static elementName="modal-window";__construct(e){this.api=e}render(){this.subRenderModal()}subRenderModal(){this.classList.add("modal"),this.createAndAttach("div",{class:"modal-dialog"},[this.create("div",{class:"modal-content"},[this.$refs.header=this.create("div",{class:"modal-header"},["header"]),this.$refs.body=this.create("div",{class:"modal-body"}),this.$refs.footer=this.create("div",{class:"modal-footer"},[this.$refs.closeButton=this.create("button",{class:"btn-danger"},"Close")])])]),this.$refs.closeButton.addEventListener("click",(()=>{this.remove()}))}}ye.register();const ve=ye;class be extends ve{static elementName="modal-window-add-to-playlist";__construct(e,t){super.__construct(e),this.items=t}render(){super.render(),this.$refs.header.innerHTML="Add to playlist",this.api.collection.playlists.list().then((e=>{if(e.data)for(var t of(this.$refs.body.clear(),this.$refs.buttonGroup=this.$refs.body.createAndAttach("div",{class:"input-group input-group-vertical"}),e.data))this.$refs.buttonGroup.createAndAttach("button",{"data-playlist":t.id},t.title).addEventListener("click",this.onPlaylistChoosen.bind(this))}))}onPlaylistChoosen(e){var t,s=e.target.getAttribute("data-playlist"),i=[];for(var a of this.items)t=a.uuid?this.api.collection.playlistItems.create({playlist:s,uuid:a.uuid}):this.api.collection.playlistItems.create({playlist:s,title:a.title,artist:a.artist}),i.push(t);Promise.all(i).then((()=>{alert("Item added!!"),this.remove()}))}}be.register();const Ae=be;class we extends p{static elementName="messages-container";render(){this.classList.add("messages"),this.successes=this.createAndAttach("ul",{class:"successes hidden"}),this.warnings=this.createAndAttach("ul",{class:"warnings hidden"}),this.errors=this.createAndAttach("ul",{class:"errors hidden"})}messages(e){if(this.successes.clear().classList.add("hidden"),this.warnings.clear().classList.add("hidden"),this.errors.clear().classList.add("hidden"),e.successes)for(var t of(this.successes.classList.remove("hidden"),e.successes))this.successes.createAndAttach("li",null,t.title);if(e.errors)for(var t of(this.errors.classList.remove("hidden"),e.errors))this.errors.createAndAttach("li",null,t.title);if(e.warnings)for(var t of(this.warnings.classList.remove("hidden"),e.warnings))this.warnings.createAndAttach("li",null,t.title)}}we.register();const Pe=we;class Re extends p{static elementName="text-field";__construct(e,t,s,i=""){this.name=e,this.label=t,this.value=s,this.placeholder=i}render(){var e=Math.floor(1e4*Math.random());this.classList.add("form-group"),this.createAndAttach("label",{class:"label col-sm-2",for:e},this.label),this.$refs.input=this.createAndAttach("input",{type:"text",class:"col-sm-10",id:e,name:this.name,value:this.value,placeholder:this.placeholder})}setValue(e){this.$refs.input.value=e}}Re.register();const Te=Re;class $e extends p{static elementName="text-area-field";__construct(e,t,s,i=""){this.name=e,this.label=t,this.value=s,this.placeholder=i}render(){var e=Math.floor(1e4*Math.random());this.classList.add("form-group"),this.createAndAttach("label",{class:"label col-sm-2",for:e},this.label),this.$refs.input=this.createAndAttach("textarea",{class:"col-sm-10",id:e,name:this.name,placeholder:this.placeholder}),this.$refs.input.value=this.value}setValue(e){this.$refs.input.value=e}}$e.register();const Ee=$e;class Le extends p{static elementName="multiple-text-field";__construct(e,t,s,i="",a="Add +"){this.name=e,this.label=t,this.value=s,this.placeholder=i,this.addButton=a}render(){this.classList.add("form-group"),this.createAndAttach("span",{class:"label col-sm-2"},this.label),this.createAndAttach("div",{class:"col-sm-10"},[this.$refs.body=this.create("div",{class:"input-group input-group-vertical"}),this.$refs.plusButton=this.create("small",{},this.addButton)]),this.$refs.plusButton.addEventListener("click",this.addBlank.bind(this)),this.setValue(this.value)}setValue(e){this.$refs.body.clear(),this.addValues(e)}addValues(e){for(var t of e=Array.isArray(e)?e:[e])this.add(t)}add(e=""){this.$refs.body.createAndAttach("input",{type:"text",placeholder:this.placeholder,class:"col-sm-12",name:this.name,value:e})}addBlank(){this.add("")}}Le.register();const Ie=Le;class Se extends p{static elementName="form-element";render(){this.$refs.form=this.createAndAttach("form",{class:"vertical",method:"post",enctype:"multipart/form-data"})}setValue(e,t){return this.$refs[e]||console.error("No input named "+e),this.$refs[e].setValue(t),this}getForm(){return this.$refs.form}addHidden(e,t){return this.$refs[e]=this.$refs.form.createAndAttach("input",{type:"hidden",name:e,value:t})}addTextField(e,t,s,i=""){return this.$refs[e]=this.$refs.form.attach(Te.instantiate(e,t,s,i))}addTextArea(e,t,s,i=""){return this.$refs[e]=this.$refs.form.attach(Ee.instantiate(e,t,s,i))}addMultiTextField(e,t,s,i="",a="Add +"){return this.$refs[e]=this.$refs.form.attach(Ie.instantiate(e,t,s,i,a))}addSubmitButton(e="submit",t="Submit"){return this.$refs[e]=this.$refs.form.createAndAttach("div",{class:"form-group"},[this.create("input",{type:"submit",name:e,value:t,class:"col-12 btn-main"})])}}Se.register();const xe=Se;class ke extends ve{static elementName="modal-form";__construct(){}render(){super.subRenderModal(),this.subRenderHeader(),this.subRenderForm(),this.subRenderSubmitListener()}subRenderHeader(){this.$refs.messages=this.$refs.body.attach(Pe.instantiate())}subRenderForm(){this.$refs.form=this.$refs.body.attach(xe.instantiate()),this.$refs.form.addTextField("title","Title",""),this.$refs.form.addSubmitButton("save","Save")}subRenderSubmitListener(){this.$refs.form.addEventListener("submit",(e=>{console.log("FORM SUBMITTED")}))}onResponse(e){this.$refs.messages.messages(e),e.successes&&e.successes.length&&(alert("FINISHED!"),this.remove())}}ke.register();const qe=ke;class _e extends qe{static elementName="modal-add-item";__construct(e,t){this.api=e,this.playlistId=t}subRenderHeader(){super.subRenderHeader(),this.$refs.header.innerHTML="Add item"}subRenderForm(){this.$refs.form=this.$refs.body.attach(xe.instantiate()),this.$refs.form.addTextField("title","Title",""),this.$refs.form.addTextField("album","Album",""),this.$refs.form.addMultiTextField("artist[]","Artist",[""],"Artist","Add artist"),this.$refs.form.addMultiTextField("featuring[]","Artist",[""],"Featuring","Add featured artist"),this.$refs.form.addTextField("cover","Cover",""),this.$refs.form.addMultiTextField("soundtrack[]","Soundtrack",[""],"Soundtrack","Add soundtrack"),this.$refs.form.addMultiTextField("genre[]","Genre",[""],"Genre","Add genre"),this.playlistId&&this.$refs.form.addHidden("playlist",this.playlistId||""),this.$refs.form.addSubmitButton("save","Save")}subRenderSubmitListener(){this.$refs.form.addEventListener("submit",(e=>{e.preventDefault(),this.api.collection.playlistItems.create(this.$refs.form.getForm()).then(this.onResponse.bind(this),this.onResponse.bind(this))}))}onResponse(e){this.$refs.messages.messages(e),e.successes&&e.successes.length&&(alert("Added!"),this.fireEvent("item-added"),this.remove())}}_e.register();const Ne=_e;class Ce extends Ne{static elementName="modal-edit-item";__construct(e,t){this.api=e,this.uuid=t}render(){super.subRenderModal(),this.api.collection.playlistItems.get(this.uuid).read().then((e=>{this.subRenderHeader(),this.subRenderForm(e),this.subRenderSubmitListener()}))}subRenderHeader(){super.subRenderHeader(),this.$refs.header.innerHTML="Edit item"}subRenderForm(e){super.subRenderForm(),this.$refs.form.setValue("title",e.data.title||"").setValue("artist[]",e.data.artist||[""]).setValue("featuring[]",e.data.featuring||[""]).setValue("cover",e.data.cover||"").setValue("album",e.data.album||"").setValue("soundtrack[]",e.data.soundtrack||[""]).setValue("genre[]",e.data.genre||[""])}subRenderSubmitListener(){this.$refs.form.addEventListener("submit",(e=>{e.preventDefault(),this.api.collection.playlistItems.get(this.uuid).update(this.$refs.form.getForm()).then(this.onResponse.bind(this),this.onResponse.bind(this))}))}onResponse(e){this.$refs.messages.messages(e),e.successes&&e.successes.length&&(alert("Edited!"),this.fireEvent("item-updated"),this.remove())}}Ce.register();const Me=Ce;class He extends Ne{static elementName="modal-add-playlist";__construct(e){this.api=e}subRenderHeader(){super.subRenderHeader(),this.$refs.header.innerHTML="Edit playlist"}subRenderForm(){this.$refs.form=this.$refs.body.attach(xe.instantiate()),this.$refs.form.addTextField("title","Title",""),this.$refs.form.addTextArea("description","Descrio",""),this.$refs.form.addSubmitButton("save","Save")}subRenderSubmitListener(){this.$refs.form.addEventListener("submit",(e=>{e.preventDefault(),this.api.collection.playlists.create(this.$refs.form.getForm()).then(this.onResponse.bind(this),this.onResponse.bind(this))}))}onResponse(e){this.$refs.messages.messages(e),e.successes&&e.successes.length&&(alert("Added!"),this.fireEvent("playlist-added"),this.remove())}}He.register();const Fe=He;class Be extends Fe{static elementName="modal-edit-playlist";__construct(e,t){this.api=e,this.playlistId=t}subRenderHeader(){super.subRenderHeader(),this.$refs.header.innerHTML="Edit playlist"}render(){super.subRenderModal(),this.api.collection.playlists.get(this.playlistId).read().then((e=>{this.subRenderHeader(),this.subRenderForm(e),this.subRenderSubmitListener()}))}subRenderForm(e){super.subRenderForm(),this.$refs.form.setValue("title",e.data.title||"").setValue("description",e.data.description||"")}subRenderSubmitListener(){this.$refs.form.addEventListener("submit",(e=>{e.preventDefault(),this.api.collection.playlists.get(this.playlistId).update(this.$refs.form.getForm()).then(this.onResponse.bind(this),this.onResponse.bind(this))}))}onResponse(e){this.$refs.messages.messages(e),e.successes&&e.successes.length&&(alert("Edited!"),this.fireEvent("item-updated"),this.remove())}}Be.register();const Oe=Be;class De extends p{static elementName="the-app";__construct(e){this.api=e,this.router=this.setUpRouter(e),this.showRunner=new class{constructor(e,t,s=null,i=null){this.app=e,this.api=t,this.history=i||new me,this.setQueue(s||new Y),this.app.addEventListener("item-selected",this.onItemSelected.bind(this)),this.app.addEventListener("player:ended",this.onPlayerEnded.bind(this)),this.app.addEventListener("controls:forward",this.forwardTheQueue.bind(this)),this.app.addEventListener("controls:backward",this.rewindTheQueue.bind(this)),this.app.addEventListener("queue:jump",this.onJumpLine.bind(this))}async onJumpLine(e){var{from:t,to:s}=e.detail,i=this.queue.move(t,s);0==s&&this.playItem(i)}async onItemSelected(e){var{item:t,queue:s}=e.detail;return console.log("-------------------------------"),console.log("Show runner: New item selected"),s?this.playNewQueue(s):this.jumpTheQueue(t)}async jumpTheQueue(e){return this.playItem(e)}async playNewQueue(e){var t=this.queue;return t.front&&this.addToHistory(t.front),this.setQueue(e),this.playItem(this.queue.front)}setQueue(e){this.queue=e,this.queue.updatedCallback=()=>{this.app.$refs.queueDisplay&&this.app.$refs.queueDisplay.showQueue(this.queue,this.history)},this.queue.updatedCallback()}async onPlayerEnded(e){return console.log("-------------------------------"),console.log("Show runner: song ended, next."),this.advanceTheQueue()}async rewindTheQueue(e){if(this.history.length){console.log("-------------------------------"),console.log("Show runner: rewinding queue.");var t=this.history.rewind(1)[0];return this.queue.dropIn(t),this.playItem(t)}}async forwardTheQueue(e){return console.log("-------------------------------"),console.log("Show runner: song skipped, next."),this.advanceTheQueue()}async advanceTheQueue(){return this.queue.getNextInLine().then((e=>{if(this.addToHistory(this.queue.front),this.queue.dequeue(),e)return this.playItem(e);console.log("Showrunner: Nothing else to play")}))}addToHistory(e){this.history.add(e)}async playItem(e){return this.findResourcesForMusicalItem(e).then((t=>{if(t.data.length)return this.app.playItem(e,t.data),t;alert("Show runner: Nothing found to play")}))}async findResourcesForMusicalItem(e){console.log("Show runner: searching for source to play");var t={};return e.title&&(t.title=e.title),e.soundtrack&&e.soundtrack.length?t.soundtrack=e.soundtrack:e.artist&&e.artist.length&&(t.artist=e.artist),this.api.discover.resources(t)}}(this,e)}render(){this.classList.add("app"),this.$refs.middle=this.createAndAttach("div",{class:"app-middle"},[this.$refs.navMenu=f.instantiate(this.api),this.$refs.stage=this.create("div",{class:"app-stage",id:"stage"}),this.$refs.queueDisplay=ge.instantiate()]),this.$refs.footer=this.createAndAttach("div",{class:"app-footer"},[this.$refs.controls=q.instantiate(this.api)]),this.router.setStage(this.$refs.stage),this.router.listenToChanges(),this.addEventListener("playlist-added",(()=>{this.$refs.navMenu.render()})),this.addEventListener("playlist-updated",(()=>{this.$refs.navMenu.render()})),this.addEventListener("item-to-add",(e=>{var t=Ae.instantiate(this.api,e.detail.items);this.append(t)})),this.addEventListener("add-item",(e=>{var t=Ne.instantiate(this.api,e.detail.playlist);this.append(t)})),this.addEventListener("edit-item",(e=>{var t=Me.instantiate(this.api,e.detail.uuid);this.append(t)})),this.addEventListener("delete-item",(e=>{confirm("Are you sure you want to remove it ?")&&(this.api.collection.playlistItems.get(e.detail.uuid).delete(),e.target.remove())})),this.addEventListener("download-playlists",(e=>{this.api.collection.playlists.downloadAll()})),this.addEventListener("add-playlist",(e=>{var t=Fe.instantiate(this.api);this.append(t)})),this.addEventListener("edit-playlist",(e=>{var t=Oe.instantiate(this.api,e.detail.playlistId);this.append(t)})),this.addEventListener("delete-playlist",(e=>{confirm("Are you sure you want to delete the playlist ?")&&(this.api.collection.playlists.get(e.detail.playlist).delete().then((()=>{this.$refs.navMenu.render()})),window.location.hash="#home")})),this.addEventListener("summon-queue",(()=>{this.$refs.queueDisplay.toggle()}))}playItem(e,t){this.$refs.controls.destroyPlayer().remove(),this.$refs.controls=q.instantiate(this.api,e,t),this.$refs.footer.append(this.$refs.controls)}setUpRouter(e){var t=new class{constructor(e=null){this.stage=e,this.routes=[]}setStage(e){this.stage=e}listenToChanges(){window.addEventListener("hashchange",this.hashChanged.bind(this)),this.hashChanged()}hashChanged(e=null){var t,s=pe.createFromGlobals(),i=this.getMatchingRoute(s);i?(this.clearStage(),t=this.call(i,s),this.stageIt(t)):this.notFoundCallback&&(this.clearStage(),t=this.notFoundCallback(i,s),this.stageIt(t))}clearStage(){this.stage.querySelectorAll(":scope > *").forEach((e=>{e.remove()}))}stageIt(e){this.stage.append(e)}call(e,t){return e.callIt(t)}getMatchingRoute(e){for(var t of this.routes)if(t.doesItMatcheRequest(e))return t;return null}addRouter(e,t){return this.routes.push(new class{constructor(e,t){this.patterns=Array.isArray(e)?e:[e],this.callback=t}callIt(e){var t,s=this.getMatchingPattern(e.path).exec(e.path).groups;return e.attributes=s||{},"string"==typeof this.callback?t=document.createElement(this.callback):ce().isA(this.callback,p)?t=this.callback.instantiate.apply(this.callback,s??[]):"function"==typeof this.callback&&(t=this.callback.apply(this,[e])),t}doesItMatcheRequest(e){return!!this.getMatchingPattern(e.path)}getMatchingPattern(e){for(var t of this.patterns)if(e.match(t))return t;return null}}(e,t)),this}};return t.addRouter([/^$/,/home$/],(function(t){return C.instantiate(t,e)})).addRouter(/playlist:(?<playlistId>[\w\d\-]+)$/,(function(t){return Z.instantiate(t,e)})).addRouter(/playlist:(?<playlistId>[\w\d\-]+)\/edit/,(function(t){return ViewEditPlaylist.instantiate(t,e)})).addRouter(/search/,(function(t){return re.instantiate(t,e)})).addRouter(/discover:artist/,(function(t){return le.instantiate(t,e)})).addRouter(/discover:releases$/,(function(t){return ee.instantiate(t,e)})).addRouter(/discover:release:(?<releaseId>.+)/,(function(t){return ie.instantiate(t,e)})).addRouter(/playlist\/create/,(function(t){return ViewAddPlaylist.instantiate(t,e)})).notFoundCallback=function(t,s){return he.instantiate(s,e)},t}}De.register();const Ue=De;class je{constructor(e,t=null,s=[]){this.elementName=e,this.attributes=t,this.children=Array.isArray(s)?s:[s]}create(){var e=document.createElement(this.elementName);for(var t in this.attributes)e.setAttribute(t,this.attributes[t]);for(var s of this.children)null!=s&&("string"==typeof s?s=document.createTextNode(s):"object"==typeof s&&s.elementName&&(s=je.createFromObject(s)),e.append(s));return e}static createFromObject(e){var{elementName:t,attributes:s,children:i}=e;return new je(t,s,i).create()}}const Ve=je;HTMLElement.prototype.attach=function(e){return this.append(e),e},HTMLElement.prototype.create=function(e,t=null,s=[]){return new Ve(e,t,s).create()},HTMLElement.prototype.createAndAttach=function(e,t=null,s=[]){return this.attach(this.create(e,t,s))},HTMLElement.prototype.clear=function(){var e=Array.from(this.children);for(var t of e)t.remove();return this},URLSearchParams.prototype.without=function(e){var t=new URLSearchParams(this.toString());return t.delete(e),t},URLSearchParams.prototype.withAdded=function(e,t){var s=new URLSearchParams(this.toString());return s.append(e,t),s},URLSearchParams.prototype.isEmpty=function(){return 0==this.toString().length};const Qe=new class{constructor(e){var s=new c({baseHref:e,headers:{"Content-Type":"application/json"}});this.collection=new class{constructor(e){this.artists=new t(e),this.playlists=new a(e),this.playlistItems=new n(e)}}(s),this.discover=new d(s)}}(window.playerSettings.backEndBaseUrl);window.app=Ue.instantiate(Qe),window.api=Qe,document.addEventListener("DOMContentLoaded",(()=>{document.body.append(window.app)}))})()})();