(()=>{var t={978:(t,e,s)=>{t.exports=s(411)},781:(t,e,s)=>{const a=s(923);class r{static toObject(t){var e,s,i;return"Object"==t.constructor.name?t:t instanceof FormData?a.formDataToObject(t):t instanceof HTMLFormElement?(e=new FormData(t),a.formDataToObject(e)):t instanceof URL?a.queryStringToObject(t.search):t instanceof URLSearchParams?a.searchParamsToObject(t):a.isValidJson(t)?JSON.parse(t):(i=(s=a.stringToUrl(t))&&s.search?new URLSearchParams(s.search):new URLSearchParams(t),r.emptySearchParams(i)?null:a.searchParamsToObject(i))}static toJson(t){var e;return a.isValidJson(t)?t:(e=r.toObject(t),JSON.stringify(e))}static toFormData(t){var e;return t instanceof FormData?t:t instanceof HTMLFormElement?new FormData(t):(e=r.toObject(t),a.objectToFormData(e))}static emptySearchParams(t){for(var e of t.values())if(e)return!1;return!0}}t.exports=r},923:(t,e,s)=>{const a=s(26),r=s(15);class i{static stringToUrl(t){if(r.isAbsolute(t))return new URL(t);var e;const s="/"==t.slice(0,1),i=r.getBaseHref();return s?((e=new URL(i)).pathname=t,e.placeholder=e.toString().replace(t,"")):(e=new URL(i+a.ltrim(t,"/"))).placeholder=i,e}static urlToString(t){var e=t.toString();return t.placeholder&&(e=e.replace(t.placeholder,"")),e}static searchParamsToObject(t){var e={};for(var[s,r]of t.entries()){var n=-1==s.indexOf("[")?[s]:a.rtrim(s,"]").split(/\]?\[/);i.addPropertyToObject(e,n,r)}return e}static addPropertyToObject(t,e,s){var a=e.pop();for(var r of e)void 0===t[r]&&(t[r]=isNaN(r)?{}:[]),t=t[r];t[a]=s}static objectToSearchParams(t){var e=new URLSearchParams;for(var s in t)i.addToSearchparam(e,s,t[s]);return e}static addToSearchparam(t,e,s){if(Array.isArray(s)||"object"==typeof s)for(var a in s)i.addToSearchparam(t,e+"["+a+"]",s[a]);else t.set(e,s)}static objectToFormData(t){var e=new FormData;for(var s in t)i.addToSearchparam(e,s,t[s]);return e}static formDataToObject(t){return i.searchParamsToObject(t)}static objectToQueryString(t){return i.objectToSearchParams(t).toString()}static queryStringToObject(t){var e=new URLSearchParams(t);return i.searchParamsToObject(e)}static isValidJson(t){if("string"!=typeof t)return!1;try{JSON.parse(t)}catch(t){return!1}return!0}}t.exports=i},26:t=>{class e{static ltrim(t,e=null){e=e||"[ \t\n\r\0\v]";var s=new RegExp("^"+e+"+");return t.replace(s,"")}static rtrim(t,e=null){e=e||"[ \t\n\r\0\v]";var s=new RegExp(e+"+$");return t.replace(s,"")}static trim(t,s=" "){return t=e.ltrim(t,s),e.rtrim(t,s)}}t.exports=e},15:(t,e,s)=>{const a=s(26);class r{static getBaseHref(){return r.getDocumentBaseHref()??r.getWindowLocationBaseHref()}static getWindowLocationBaseHref(){const t=window.location;var e;return e="/"==t.pathname.slice(-1)?t.protocol+"//"+t.host+t.pathname:t.pathname.match(/\.[\w]{2,4}$/)?t.protocol+"//"+t.host+t.pathname.replace(/\/[^\/]+$/,""):t.protocol+"//"+t.host+t.pathname,a.rtrim(e,"/")+"/"}static getDocumentBaseHref(){const t=document.querySelector("base");if(!t)return null;const e=t.getAttribute("href");return e?a.rtrim(e,"/")+"/":null}static isAbsolute(t){return t instanceof URL||"http"==t.substr(0,4)}static isRelative(t){return!r.isAbsolute(t)}}t.exports=r},411:(t,e,s)=>{const a=s(923),r=s(781),i=s(15),n=s(26);class c{defaultOptions={};constructor(t={}){null!=t.baseHref&&(t.baseHref=n.rtrim(t.baseHref,"/")+"/"),this.defaultOptions=t}async fetch(t,e={}){return e.method||(e.method="get"),this.request(t,e)}async get(t,e={}){return e.method="get",this.request(t,e)}async post(t,e={}){return e.method="post",this.request(t,e)}async put(t,e={}){return e.method="put",this.request(t,e)}async delete(t,e={}){return e.method="delete",this.request(t,e)}async options(t,e={}){return e.method="options",this.request(t,e)}async patch(t,e={}){return e.method="patch",this.request(t,e)}static createRequest(t,e){return"string"==typeof t&&(t=i.isRelative(t)?new URL(t,e.baseHref||i.getBaseHref()):new URL(t)),null==e.headers&&(e.headers={}),e.queryParams&&(t=c.addToQueryString(t,e.queryParams),e.queryParams=void 0),"get"==e.method&&e.body?(t=c.addToQueryString(t,e.body),e.body=void 0):e.body&&(e.body="application/json"==c.getHeader(e.headers,"Content-Type")?r.toJson(e.body):r.toFormData(e.body)),c.clearUpOptions(e),new Request(t,e)}static clearUpOptions(t){for(var e in t)void 0===t[e]&&delete t[e];if(t.headers)for(var s in t.headers)void 0===t.headers[s]&&delete t.headers[s]}async request(t,e={}){e={...this.defaultOptions,...e};var s=c.createRequest(t,e);return fetch(s)}static addToQueryString(t,e){var s;e=r.toObject(e);var i=t instanceof URL;for(var n in s=(t=i?t:a.stringToUrl(t)).search?new URLSearchParams(t.search):new URLSearchParams,e)a.addToSearchparam(s,n,e[n]);return t.search=s.toString(),i?t:a.urlToString(t)}static getHeader(t,e){e=e.toLowerCase();for(let s in t)if(s.toLocaleLowerCase()==e)return t[s];return null}}t.exports=c},766:t=>{t.exports=class{static isA(t,e){for(var s=t.__proto__;s;){if("string"==typeof e&&s.name==e)return!0;if("function"==typeof e&&s.name==e.name)return!0;s=s.__proto__}return!1}}}},e={};function s(a){var r=e[a];if(void 0!==r)return r.exports;var i=e[a]={exports:{}};return t[a](i,i.exports,s),i.exports}s.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},s.d=(t,e)=>{for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";const t=class{constructor(t){this.httpClient=t}async apiCall(t,e,s=void 0,a=void 0,r=void 0){return new Promise(((i,n)=>{this.request(t,e,s,a,r).then((t=>t.json().then((e=>{t.status<400?i(e):n(e)}))))}))}request(t,e,s=void 0,a=void 0,r=void 0){var i,n={body:s,queryParams:a};switch(r&&(n={...n,...r}),t){case"post":i=this.httpClient.post(e,n);break;case"put":i=this.httpClient.put(e,n);break;case"delete":i=this.httpClient.delete(e,n);break;case"get":i=this.httpClient.get(e,n)}return i}},e=class extends t{list(){return this.apiCall("get","/api/v1/collection/artists")}},a=class extends t{constructor(t,e){super(t),this.playlistId=e}read(){return this.apiCall("get","/api/v1/collection/playlists/"+this.playlistId)}getItems(t=null){return this.apiCall("get","/api/v1/collection/playlists/"+this.playlistId+"/items",null,t)}update(t){return this.apiCall("put","/api/v1/collection/playlists/"+this.playlistId,t,null,{headers:{"Content-Type":void 0}})}delete(){return this.apiCall("delete","/api/v1/collection/playlists/"+this.playlistId)}},r=class extends t{list(){return this.apiCall("get","/api/v1/collection/playlists")}create(t){return this.apiCall("post","/api/v1/collection/playlists",t,null,{headers:{"Content-Type":void 0}})}get(t){return new a(this.httpClient,t)}},i=class extends t{constructor(t,e){super(t),this.uuid=e}read(){return this.apiCall("get","/api/v1/collection/items/"+this.uuid)}update(t){return this.apiCall("put","/api/v1/collection/items/"+this.uuid,t,null,{headers:{"Content-Type":void 0}})}delete(){return this.apiCall("delete","/api/v1/collection/items/"+this.uuid)}},n=class extends t{search(t){return this.apiCall("get","/api/v1/collection/items",null,t)}create(t){return this.apiCall("post","/api/v1/collection/items",t,null,{headers:{"Content-Type":void 0}})}get(t){return new i(this.httpClient,t)}},c=class extends t{constructor(t,e){super(t),this.releaseId=e}getTracks(t=null){return this.apiCall("get","/api/v1/discover/releases/"+this.releaseId,null,t)}},l=class extends t{search(t){return this.apiCall("get","/api/v1/discover/releases",null,t)}get(t){return new c(this.httpClient,t)}},h=class extends t{search(t){return this.apiCall("get","/api/v1/discover/artists",null,t)}},o=class extends t{constructor(t){super(t),this.releases=new l(t),this.artists=new h(t)}sources(t){return this.apiCall("get","/api/v1/discover/sources",null,t)}},d=s(978);class u extends HTMLElement{__construct(t=null,e=null){}beforeRender(){}render(){this.innerHTML="inner html"}afterRender(){}connectedCallback(){this.beforeRender(),this.render(),this.afterRender()}static elementName="base-element";static register(){customElements.get(this.elementName)||customElements.define(this.elementName,this)}static instantiate(...t){if(!customElements.get(this.elementName))throw`Register this garbage <${this.elementName}> damn you, you forgot to register it! Call .register() !!`;var e=document.createElement(this.elementName);return e.__construct(...t),e}constructor(){super(),this.$refs={}}}const p=u;class m extends p{static elementName="nav-menu";__construct(t){this.api=t}render(){this.clear(),this.classList.add("app-nav"),this.addGenericNavItem("#home","Home","fa-chevron-right"),this.addGenericNavItem("#search","Search","fa-chevron-right"),this.addGenericNavItem("#discover:artist","Discover","fa-chevron-right"),this.createAndAttach("hr"),this.$refs.playlists=this.createAndAttach("div",{class:"app-nav__playlists"}),this.createAndAttach("hr"),this.$refs.artists=this.createAndAttach("div",{class:"app-nav__artists"}),this.updatePlaylists(),this.updateArtists()}updatePlaylists(){this.api.collection.playlists.list().then((t=>{if(t.data)for(var e of t.data)this.addPlaylistNavItem(e.id,e.title);this.$refs.playlists.append(this.createGenericNavItem("#playlist/create","Create playlist","fa-plus-circle"))}))}updateArtists(){this.api.collection.artists.list().then((t=>{for(var e of t.data)this.addArtistNavItem(e)}))}addArtistNavItem(t){this.$refs.artists.createAndAttach("div",{class:"app-nav__item"},this.create("a",{href:"#search?artist="+t},t))}addPlaylistNavItem(t,e){this.$refs.playlists.createAndAttach("div",{class:"app-nav__item"},[this.create("a",{href:`#playlist:${t}`,class:"ellipsis"},e),this.create("a",{href:`#playlist:${t}/edit`,class:"editing"},this.create("span",{class:"fa fa-pencil"}))])}addGenericNavItem(t,e,s=null){var a=this.createGenericNavItem(t,e,s);return this.append(a),a}createGenericNavItem(t,e,s=null){var a,r;return a=this.createAndAttach("div",{class:"app-nav__item"},r=this.create("a",{href:t})),s&&r.createAndAttach("span",{class:"fa "+s}),r.append(e),a}}m.register();const f=m;class v extends p{static elementName="reproduction-controls";__construct(t){this.api=t}connectedCallback(){this.$refs.playButton=this.createAndAttach("button",{class:"button-play"},this.create("span",{class:"fa fa-play"})),this.$refs.playButton.addEventListener("click",this.playPause.bind(this)),this.$refs.playerFrame=this.createAndAttach("div",{class:"player-frame"})}async select(t){var e=await this.api.discover.sources({title:t.title,artist:t.artist});this.setUpPlayer(e.data[0].id)}playPause(){this.isPaused()?this.play():this.pause()}isPaused(){return 2==this.controls.getPlayerState()}play(){this.controls.playVideo()}pause(){this.controls.pauseVideo()}setUpPlayer(t){this.destroyPlayer(),this.controls=this.createPlayer(t)}destroyPlayer(){this.$refs.playerFrame.clear()}createPlayer(t){var e="youtube-"+t,s=this.create("div",{id:e});return this.$refs.playerFrame.append(s),new YT.Player(e,{height:"390",width:"640",videoId:t,playerVars:{playsinline:1,autoplay:1}})}}v.register();const g=v,y=class extends p{static elementName="view-welcome";__construct(t,e){this.request=t,this.api=e}afterRender(){this.classList.add("view")}};class b extends y{static elementName="view-welcome";render(){var t=document.createElement("p");t.innerHTML="Welcome back",this.append(t)}}b.register();const A=b;class w extends p{static elementName="playlist-item";__construct(t={}){this.item=t}render(){if(this.innerHTML="",this.classList.add("playlist-item"),this.item.title)var t=this.createAndAttach("span",{class:"title"},[this.item.title]);if(this.item.artist){var e=Array.isArray(this.item.artist)?this.item.artist:[this.item.artist];for(var s of e)this.createAndAttach("span",{class:"playlist-item__artist"},[this.create("a",{href:`#search?artist=${s}`},s)," ",this.create("a",{href:`#discover:releases?artist=${s}`},[this.createAndAttach("span",{class:"fa fa-search"})])])}if(this.item.soundtrack){var a=Array.isArray(this.item.soundtrack)?this.item.soundtrack:[this.item.soundtrack];for(var r of a)this.createAndAttach("span",{class:"playlist-item__soundtrack"},[this.create("a",{href:`#search?soundtrack=${r}`},r)])}if(this.item.genre){var i=Array.isArray(this.item.genre)?this.item.genre:[this.item.genre];for(var n of i)this.createAndAttach("span",{class:"playlist-item__genre"},[this.create("a",{href:`#search?genre=${n}`},n)])}this.item.uuid&&this.createAndAttach("a",{href:`#item:${this.item.uuid}/edit`,title:"Edit"},this.createAndAttach("span",{class:"fa fa-pencil"})),t.addEventListener("click",(()=>{this.dispatchEvent(new CustomEvent("item-selected",{bubbles:!0,detail:this.item}))}))}}w.register();const $=w;var S=s(781),T=s.n(S),q=s(923),x=s.n(q);class L extends p{static elementName="view-search-header";__construct(t,e,s){this.request=t,this.title=e,this.fields=s}render(){var t;for(var e of(this.classList.add("search-header"),this.createAndAttach("h1",null,this.title),this.$refs.form=this.createAndAttach("form",{class:"search-header__form input-group"}),this.fields))e.value=this.request.queryParams.get(e.name)||"",t=this.$refs.form.createAndAttach("input",e),e.value.length&&(t.focus(),t.selectionStart=t.selectionEnd=t.value.length);this.$refs.form.createAndAttach("button",null,[this.create("span",{class:"fa fa-search"})]),this.$refs.form.addEventListener("submit",(t=>{t.preventDefault(),window.location.href=this.request.path+"?"+x().objectToSearchParams(T().toObject(this.$refs.form)).toString()}))}}L.register();const P=L;class R extends p{static elementName="view-pagination";__construct(t,e,s){this.api=t,this.request=e,this.response=s}render(){var t;this.classList.add("button-group"),this.classList.add("view-nav"),this.response.meta.pages>1&&((t=this.request.queryParams.without("page")).set("page",1),this.createAndAttach("a",{href:this.request.path+"?"+t.toString(),class:"btn view-nav-first"},["first"])),this.response.meta.page>1&&((t=this.request.queryParams.without("page")).set("page",this.response.meta.page-1),this.createAndAttach("a",{href:this.request.path+"?"+t.toString(),class:"btn"},["prev"])),this.response.meta.pages>this.response.meta.page&&((t=this.request.queryParams.without("page")).set("page",this.response.meta.page+1),this.createAndAttach("a",{href:this.request.path+"?"+t.toString(),class:"btn"},["next"])),this.response.meta.pages>1&&((t=this.request.queryParams.without("page")).set("page",this.response.meta.pages),this.createAndAttach("a",{href:this.request.path+"?"+t.toString(),class:"btn view-nav-last"},["last"]))}}R.register();const N=R;class C{static enableBottomReached(t){t.addEventListener("scroll",C.onScroll.bind(t))}static onScroll(t){this.scrollTop+this.offsetHeight>=this.scrollHeight&&this.dispatchEvent(new CustomEvent("scroll-bottom-reached",{bubbles:!1}))}}const E=C;class I extends y{static elementName="view-playlist";async render(){this.fetch().then((t=>{this.renderHeader(t),this.renderItems(t),this.renderNavigation(t),this.renderNewItem()})),E.enableBottomReached(this),this.addEventListener("scroll-bottom-reached",this.bottomReached.bind(this))}bottomReached(t){console.log("end of the line")}fetch(){return this.request.queryParams.without("page").isEmpty()?this.api.collection.playlists.get(this.request.attributes.playlistId).getItems(this.request.queryParams):this.api.collection.playlistItems.search(this.request.queryParams.withAdded("playlist",this.request.attributes.playlistId))}renderHeader(t){return this.append(P.instantiate(this.request,t.playlist?t.playlist.title:this.request.attributes.playlistId,[{type:"search",name:"title",placeholder:"Title",class:"main"},{type:"search",name:"artist",placeholder:"Artist"},{type:"search",name:"genre",placeholder:"Genre"}]))}async renderItems(t){if(t.data)for(var e of t.data)this.attach($.instantiate(e))}renderNavigation(t){this.append(N.instantiate(this.api,this.request,t))}renderNewItem(){this.createAndAttach("a",{href:"#playlist:"+this.request.attributes.playlistId+"/create-item"},"New Item")}}I.register();const F=I;class _ extends p{static elementName="messages-container";render(){this.classList.add("messages"),this.successes=this.createAndAttach("ul",{class:"successes hidden"}),this.warnings=this.createAndAttach("ul",{class:"warnings hidden"}),this.errors=this.createAndAttach("ul",{class:"errors hidden"})}messages(t){if(this.successes.clear().classList.add("hidden"),this.warnings.clear().classList.add("hidden"),this.errors.clear().classList.add("hidden"),t.successes)for(var e of(this.successes.classList.remove("hidden"),t.successes))this.successes.createAndAttach("li",null,e.title);if(t.errors)for(var e of(this.errors.classList.remove("hidden"),t.errors))this.errors.createAndAttach("li",null,e.title);if(t.warnings)for(var e of(this.warnings.classList.remove("hidden"),t.warnings))this.warnings.createAndAttach("li",null,e.title)}}_.register();const H=_;class k extends y{static elementName="view-edit-playlist";async render(){this.fetch().then((t=>{this.renderHeader(t),this.renderForm(t)}))}fetch(){return this.api.collection.playlists.get(this.request.attributes.playlistId).read()}renderHeader(t){this.createAndAttach("h1",null,"Editing playlist"),this.$refs.messages=this.attach(H.instantiate())}renderForm(t){var e=this.createAndAttach("form",{class:"horizontal",method:"post",enctype:"multipart/form-data"},[this.create("label",{class:"form-group"},[this.create("span",{class:"label col-sm-2"},"Title"),this.create("input",{type:"text",class:"col-sm-10",name:"title",value:t.data.title})]),this.create("label",{class:"form-group"},[this.create("span",{class:"label col-sm-2"},"Description"),this.create("textarea",{type:"text",class:"col-sm-10",name:"description"},t.data.description||"")]),this.create("div",{class:"form-group"},[this.create("input",{type:"submit",value:"Save",class:"col-12 btn-main"})])]);e.addEventListener("submit",(t=>{t.preventDefault(),this.api.collection.playlists.get(this.request.attributes.playlistId).update(e).then(this.formSubmitted.bind(this),this.formSubmitted.bind(this))}))}formSubmitted(t){this.$refs.messages.messages(t),t.successes.length&&this.dispatchEvent(new CustomEvent("playlist-updated",{bubbles:!0}))}}k.register();const U=k;class j extends y{static elementName="view-add-playlist";async render(){this.renderHeader(),this.renderForm()}renderHeader(){this.createAndAttach("h1",null,"Adding new playlist"),this.$refs.messages=this.attach(H.instantiate())}renderForm(){var t=this.createAndAttach("form",{class:"horizontal",method:"post",enctype:"multipart/form-data"},[this.create("label",{class:"form-group"},[this.create("span",{class:"label col-sm-2"},"Title"),this.create("input",{type:"text",class:"col-sm-10",name:"title"})]),this.create("label",{class:"form-group"},[this.create("span",{class:"label col-sm-2"},"Description"),this.create("textarea",{type:"text",class:"col-sm-10",name:"description"})]),this.create("div",{class:"form-group"},[this.create("input",{type:"submit",value:"Save",class:"col-12 btn-main"})])]);t.addEventListener("submit",(e=>{e.preventDefault(),this.api.collection.playlists.create(t).then(this.formSubmitted.bind(this),this.formSubmitted.bind(this))}))}formSubmitted(t){this.$refs.messages.messages(t),t.successes.length&&this.dispatchEvent(new CustomEvent("playlist-updated",{bubbles:!0}))}}j.register();const O=j;class M extends p{static elementName="text-field";__construct(t,e,s,a=""){this.name=t,this.label=e,this.value=s,this.placeholder=a}render(){var t=Math.floor(1e4*Math.random());this.classList.add("form-group"),this.createAndAttach("label",{class:"label col-sm-2",for:t},this.label),this.$refs.input=this.createAndAttach("input",{type:"text",class:"col-sm-10",id:t,name:this.name,value:this.value,placeholder:this.placeholder})}setValue(t){this.$refs.input.value=t}}M.register();const D=M;class B extends p{static elementName="multiple-text-field";__construct(t,e,s,a="",r="Add +"){this.name=t,this.label=e,this.value=s,this.placeholder=a,this.addButton=r}render(){this.classList.add("form-group"),this.createAndAttach("span",{class:"label col-sm-2"},this.label),this.createAndAttach("div",{class:"col-sm-10"},[this.$refs.body=this.create("div",{class:"grid"}),this.$refs.plusButton=this.create("a",{},this.addButton)]),this.$refs.plusButton.addEventListener("click",this.addBlank.bind(this)),this.setValue(this.value)}setValue(t){this.$refs.body.clear(),this.addValues(t)}addValues(t){for(var e of t=Array.isArray(t)?t:[t])this.add(e)}add(t=""){this.$refs.body.createAndAttach("input",{type:"text",placeholder:this.placeholder,class:"col-sm-12",name:this.name,value:t})}addBlank(){this.add("")}}B.register();const G=B;class V extends p{static elementName="form-element";render(){this.$refs.form=this.createAndAttach("form",{class:"horizontal",method:"post",enctype:"multipart/form-data"})}getForm(){return this.$refs.form}addHidden(t,e){return this.$refs[t]=this.$refs.form.createAndAttach("input",{type:"hidden",name:t,value:e})}addTextField(t,e,s,a=""){return this.$refs[t]=this.$refs.form.attach(D.instantiate(t,e,s,a))}addMultiTextField(t,e,s,a="",r="Add +"){return this.$refs[t]=this.$refs.form.attach(G.instantiate(t,e,s,a,r))}addSubmitButton(t,e){return this.$refs[t]=this.$refs.form.createAndAttach("div",{class:"form-group"},[this.create("input",{type:"submit",name:t,value:e,class:"col-12 btn-main"})])}}V.register();const J=V;class Q extends y{static elementName="view-edit-item";async render(){this.fetch().then((t=>{this.renderHeader(t),this.renderForm(t)}))}fetch(){return this.api.collection.playlistItems.get(this.request.attributes.itemUuid).read()}renderHeader(t){this.createAndAttach("h1",null,"Editing item"),this.$refs.messages=this.attach(H.instantiate())}renderForm(t){var e=t.data.title||"",s=this.getArray(t.data,"artist"),a=this.getArray(t.data,"featuring"),r=t.data.cover||"",i=t.data.album||"",n=this.getArray(t.data,"soundtrack"),c=this.getArray(t.data,"genre");this.$refs.form=this.attach(J.instantiate()),this.$refs.form.addTextField("title","Title",e),this.$refs.form.addTextField("album","Album",i),this.$refs.form.addMultiTextField("artist[]","Artist",s,"Artist","Add artist"),this.$refs.form.addMultiTextField("featuring[]","Artist",a,"Featuring","Add featured artist"),this.$refs.form.addTextField("cover","Cover",r),this.$refs.form.addMultiTextField("soundtrack[]","Soundtrack",n,"Soundtrack","Add soundtrack"),this.$refs.form.addMultiTextField("genre[]","Genre",c,"Genre","Add genre"),this.$refs.form.addSubmitButton("save","Save"),this.$refs.form.addEventListener("submit",(t=>{t.preventDefault(),this.api.collection.playlistItems.get(this.request.attributes.itemUuid).update(this.$refs.form.getForm()).then(this.formSubmitted.bind(this),this.formSubmitted.bind(this))}))}getArray(t,e){return t[e]?Array.isArray(t[e])?t[e]:[t[e]]:[""]}formSubmitted(t){this.$refs.messages.messages(t),t.successes.length&&this.dispatchEvent(new CustomEvent("item-updated",{bubbles:!0}))}}Q.register();const z=Q;class W extends y{static elementName="view-add-item";render(){this.renderHeader(),this.renderForm()}renderHeader(){this.createAndAttach("h1",null,"Adding item"),this.$refs.messages=this.attach(H.instantiate())}renderForm(){this.$refs.form=this.attach(J.instantiate()),this.$refs.form.addTextField("title","Title",""),this.$refs.form.addTextField("album","Album",""),this.$refs.form.addMultiTextField("artist[]","Artist",[""],"Artist","Add artist"),this.$refs.form.addMultiTextField("featuring[]","Artist",[""],"Featuring","Add featured artist"),this.$refs.form.addTextField("cover","Cover",""),this.$refs.form.addMultiTextField("soundtrack[]","Soundtrack",[""],"Soundtrack","Add soundtrack"),this.$refs.form.addMultiTextField("genre[]","Genre",[""],"Genre","Add genre"),this.$refs.form.addHidden("playlist",this.request.attributes.playlistId),this.$refs.form.addSubmitButton("save","Save"),this.$refs.form.addEventListener("submit",(t=>{t.preventDefault(),this.api.collection.playlistItems.create(this.$refs.form.getForm()).then(this.formSubmitted.bind(this),this.formSubmitted.bind(this))}))}formSubmitted(t){this.$refs.messages.messages(t),t.successes.length&&this.dispatchEvent(new CustomEvent("item-updated",{bubbles:!0}))}}W.register();const Y=W;class K extends y{static elementName="view-discography";async render(){this.api.discover.releases.search(this.request.queryParams).then((t=>{this.renderHeader(t),this.renderReleases(t),this.renderNavigation(t)}))}renderHeader(t){var e=P.instantiate(this.request,"Discover albums",[{type:"search",name:"artist",placeholder:"artist",class:"main"}]);this.append(e)}async renderReleases(t){var e=this.createAndAttach("div",{class:"grid releases"});for(var s of t.data)e.createAndAttach("a",{href:`#discover:release:${s.id}`,class:"col-6 col-sm-4 col-md-3 col-lg-2"},[this.create("span",{class:"card"},[s.thumb?this.create("img",{src:s.thumb}):null,this.create("h4",null,[s.name])])])}renderNavigation(t){this.append(N.instantiate(this.api,this.request,t))}}K.register();const X=K;class Z extends y{static elementName="view-release";async render(){this.api.discover.releases.get(this.request.attributes.releaseId).getTracks().then((t=>{this.renderHeader(t),this.renderTracks(t)}))}renderHeader(t){this.createAndAttach("h1",null,[t.data.artist.name," ",t.data.title])}async renderTracks(t){for(var e of t.data.tracks)this.append($.instantiate({title:e,artist:t.data.artist.name}))}}Z.register();const tt=Z;class et extends F{static elementName="view-search";fetch(){return this.request.queryParams.isEmpty()?new Promise(((t,e)=>t({}))):this.api.collection.playlistItems.search(this.request.queryParams)}renderHeader(t){this.append(P.instantiate(this.request,"Search",[{type:"search",name:"title",placeholder:"Title",class:"main"},{type:"search",name:"artist",placeholder:"Artist"},{type:"search",name:"genre",placeholder:"Genre"}]))}}et.register();const st=et;class at extends y{static elementName="view-discover";async render(){this.fetch().then((t=>{this.renderHeader(t),this.renderArtists(t)}))}fetch(){return this.request.queryParams.isEmpty()?new Promise(((t,e)=>t({data:[]}))):this.api.discover.artists.search(this.request.queryParams)}renderHeader(t){var e=P.instantiate(this.request,"Discover artist",[{type:"search",name:"name",placeholder:"name",class:"main"}]);this.append(e)}async renderArtists(t){var e=this.createAndAttach("div",{class:"grid artists"});for(var s of t.data)e.createAndAttach("a",{href:`#discover:releases?artist=${s.name}`,class:"col-6 col-sm-4 col-md-3 col-lg-2"},[this.create("span",{class:"card"},[s.thumb?this.create("img",{src:s.thumb}):null,this.create("h4",null,[s.name])])])}}at.register();const rt=at;class it extends y{static elementName="not-found";async render(){this.createAndAttach("h1",null,"Not found"),this.createAndAttach("p",null,`Nothing found related to ${this.request.path}`)}}it.register();const nt=it;var ct=s(766),lt=s.n(ct);class ht{constructor(t,e){this.path=t,this.queryParams=e,this.attributes={}}static createFromGlobals(){if(!location.hash)return new ht("",new URLSearchParams(""));var t=new URL(location.hash.replace("#","/"),"https://"+location.hostname);return new ht(t.pathname.replace(/^\//,"#"),new URLSearchParams(t.search))}}const ot=ht;class dt extends p{static elementName="the-app";__construct(t){this.api=t,this.router=this.setUpRouter(t)}render(){this.$refs.middle=this.createAndAttach("div",{class:"app-middle"},[this.$refs.navMenu=f.instantiate(this.api),this.$refs.stage=this.create("div",{class:"app-stage",id:"stage"})]),this.$refs.footer=this.createAndAttach("div",{class:"app-footer"},[this.$refs.controls=g.instantiate(this.api)]),this.router.setStage(this.$refs.stage),this.router.listenToChanges(),this.addEventListener("item-selected",(t=>{this.$refs.controls.select(t.detail)})),this.addEventListener("playlist-updated",(()=>{this.$refs.navMenu.render()})),this.classList.add("app")}setUpRouter(t){var e=new class{constructor(t=null){this.stage=t,this.routes=[]}setStage(t){this.stage=t}listenToChanges(){window.addEventListener("hashchange",this.hashChanged.bind(this)),this.hashChanged()}hashChanged(t=null){var e,s=ot.createFromGlobals(),a=this.getMatchingRoute(s);a?(this.clearStage(),e=this.call(a,s),this.stageIt(e)):this.notFoundCallback&&(this.clearStage(),e=this.notFoundCallback(a,s),this.stageIt(e))}clearStage(){this.stage.querySelectorAll(":scope > *").forEach((t=>{t.remove()}))}stageIt(t){this.stage.append(t)}call(t,e){return t.callIt(e)}getMatchingRoute(t){for(var e of this.routes)if(e.doesItMatcheRequest(t))return e;return null}addRouter(t,e){return this.routes.push(new class{constructor(t,e){this.patterns=Array.isArray(t)?t:[t],this.callback=e}callIt(t){var e,s=this.getMatchingPattern(t.path).exec(t.path).groups;return t.attributes=s||{},"string"==typeof this.callback?e=document.createElement(this.callback):lt().isA(this.callback,p)?e=this.callback.instantiate.apply(this.callback,s??[]):"function"==typeof this.callback&&(e=this.callback.apply(this,[t])),e}doesItMatcheRequest(t){return!!this.getMatchingPattern(t.path)}getMatchingPattern(t){for(var e of this.patterns)if(t.match(e))return e;return null}}(t,e)),this}};return e.addRouter([/^$/,/home$/],(function(e){return A.instantiate(e,t)})).addRouter(/playlist:(?<playlistId>[\w\d\-]+)$/,(function(e){return F.instantiate(e,t)})).addRouter(/playlist:(?<playlistId>[\w\d\-]+)\/edit/,(function(e){return U.instantiate(e,t)})).addRouter(/search/,(function(e){return st.instantiate(e,t)})).addRouter(/discover:artist/,(function(e){return rt.instantiate(e,t)})).addRouter(/discover:releases$/,(function(e){return X.instantiate(e,t)})).addRouter(/discover:release:(?<releaseId>[\d]+)/,(function(e){return tt.instantiate(e,t)})).addRouter(/playlist\/create/,(function(e){return O.instantiate(e,t)})).addRouter(/item:(?<itemUuid>[\w\d\-]+)\/edit/,(function(e){return z.instantiate(e,t)})).addRouter(/playlist:(?<playlistId>[\w\d\-]+)\/create-item/,(function(e){return Y.instantiate(e,t)})).notFoundCallback=function(e,s){return nt.instantiate(s,t)},e}}dt.register();const ut=dt;class pt{constructor(t,e=null,s=[]){this.elementName=t,this.attributes=e,this.children=Array.isArray(s)?s:[s]}create(){var t=document.createElement(this.elementName);for(var e in this.attributes)t.setAttribute(e,this.attributes[e]);for(var s of this.children)null!=s&&("string"==typeof s?s=document.createTextNode(s):"object"==typeof s&&s.elementName&&(s=pt.createFromObject(s)),t.append(s));return t}static createFromObject(t){var{elementName:e,attributes:s,children:a}=t;return new pt(e,s,a).create()}}const mt=pt;HTMLElement.prototype.attach=function(t){return this.append(t),t},HTMLElement.prototype.create=function(t,e=null,s=[]){return new mt(t,e,s).create()},HTMLElement.prototype.createAndAttach=function(t,e=null,s=[]){return this.attach(this.create(t,e,s))},HTMLElement.prototype.clear=function(){var t=Array.from(this.children);for(var e of t)e.remove();return this},URLSearchParams.prototype.without=function(t){var e=new URLSearchParams(this.toString());return e.delete(t),e},URLSearchParams.prototype.withAdded=function(t,e){var s=new URLSearchParams(this.toString());return s.append(t,e),s},URLSearchParams.prototype.isEmpty=function(){return 0==this.toString().length};const ft=new class{constructor(t){var s=new d({baseHref:t,headers:{"Content-Type":"application/json"}});this.collection=new class{constructor(t){this.artists=new e(t),this.playlists=new r(t),this.playlistItems=new n(t)}}(s),this.discover=new o(s)}}("http://player-backend.lndo.site"),vt=ut.instantiate(ft);window.api=ft,document.addEventListener("DOMContentLoaded",(()=>{document.body.append(vt)}))})()})();